### YamlMime:Tutorial
title: Bot de llamadas y reuniones de Teams
metadata:
  title: Bot de Teams con llamadas y reuniones
  description: Con este módulo de aprendizaje, aprenderá a configurar la funcionalidad de llamadas y reuniones en un bot para Teams.
  audience: Developer
  level: Beginner
  ms.date: 02/08/2021
  ms.topic: interactive-tutorial
  nextTutorialHref: bots/calls-and-meetings/registering-calling-bot.md
  nextTutorialTitle: Registrar un bot de llamadas
  ms.custom: mvc
  ms.localizationpriority: none
  ms.openlocfilehash: cd6b8664372dd19bdd9a96bb84529d65b0839405
  ms.sourcegitcommit: ac59d469b823b80e65ee6f7be11ec5c365977a1c
  ms.translationtype: MT
  ms.contentlocale: es-ES
  ms.lasthandoff: 10/06/2022
  ms.locfileid: "68490783"
items:
- durationInMinutes: 1
  content: >
    El bot de llamadas y reuniones proporciona funcionalidades básicas, como crear una llamada, unirse a una llamada, transferir o redirigir una llamada, unirse a una reunión programada e invitar a los participantes mediante la integración de la API de comunicaciones en la nube Graph API.


    Los bots pueden interactuar con las llamadas y reuniones de Teams mediante el uso compartido de voz, vídeo y pantalla en tiempo real. Con Microsoft Graph API para llamadas y reuniones en línea, las aplicaciones de Microsoft Teams ya pueden interactuar con los usuarios mediante voz y vídeo para mejorar la experiencia. Estas API le permitirán añadir las siguientes características nuevas:


    * Respuesta de voz interactiva (IVR).

    * Control de llamadas.

    * Acceso a secuencias de audio y vídeo en tiempo real, incluido el uso compartido de aplicaciones y escritorio.


    Cree un bot y especifique información adicional y permisos para usar estas API de Graph en una aplicación de Teams.


    Esta guía paso a paso le ayuda a crear un bot con funcionalidad de llamadas y reuniones. Al final de este tutorial, puede lograr la siguiente salida:


    ![Salida final](~/assets/images/calls-and-meetings/final-output.png)
- title: Requisitos previos
  durationInMinutes: 1
  content: "Asegúrese de instalar las herramientas siguientes y de configurar el entorno de desarrollo:  \n\n | &nbsp; | Instalar | Para usar... |\n | --- | --- | --- |\n | **Required** | &nbsp; | &nbsp; |\n | &nbsp; | [Cuenta de desarrollador de Microsoft 365](/microsoftteams/platform/concepts/build-and-test/prepare-your-o365-tenant) | Acceso a la cuenta de Teams con los permisos adecuados para instalar una aplicación. |\n | &nbsp; | [Ngrok](https://ngrok.com/download) | Las características de aplicaciones de Teams (bots conversacionales, extensiones de mensajes y webhooks entrantes) requieren conexiones entrantes. Un túnel conecta el sistema de desarrollo a Teams. No es necesario para las aplicaciones que solo incluyen pestañas. Este paquete se instala en el directorio del proyecto (mediante npm `devDependencies`). |\n | &nbsp; | [Visual Studio 2022, versión 17.3](https://visualstudio.microsoft.com)<br> Instale una de las dos cargas de trabajo siguientes:<br> • **desarrollo web y ASP.NET** <br> • **Desarrollo multiplataforma de .NET Core** | Puede instalar la versión de empresa en Visual Studio 2022 e instalar las cargas de trabajo. |   \n | &nbsp; | [SDK de .NET Core versión 3.1 (no una cuenta de invitado) ](https://dotnet.microsoft.com/en-us/download) | Enlaces personalizados para la depuración local y las implementaciones de aplicaciones de Azure Functions. Si no ha instalado el SDK de .NET 3.1 (o posterior) globalmente, se puede instalar la versión portátil. |\n | &nbsp; | [Microsoft Teams y una cuenta de Teams](https://www.microsoft.com/microsoft-teams/download-app) | Microsoft Teams para colaborar con todos los usuarios con los que trabaja a través de aplicaciones para chat, reuniones, llamadas y todo en un solo lugar. |\n | &nbsp; | [Windows PowerShell](/microsoftteams/teams-powershell-install) | Instale ejecutando todos los comandos. |\n"
- title: Configuración de llamadas y bot de reunión
  durationInMinutes: 5
  content: "Registre una aplicación mediante el registro de aplicaciones en microsoft Azure Portal para que la aplicación se integre con el Plataforma de identidad de Microsoft y llame a Microsoft Graph. Realice lo siguiente:\n\n1. Use ngrok para crear un túnel a los puntos de conexión del servidor web.\n1. Cree un recurso de Bot de Azure para registrar el bot con Azure Bot Service.\n1. Cree un secreto de cliente que habilite la autenticación sso del bot.\n1. Cree una directiva para un usuario de inquilino de demostración para crear las reuniones en línea mediante PowerShell.\n1. Agregue permisos de API para las llamadas de nivel inferior.\n1. Cree el registro de canal de bot en la cuenta de Azure.\n1. Agregue el canal de Microsoft Teams para implementar el bot en un canal de Teams.\n1. Agregue el punto de conexión de mensajería al túnel ngrok que ha creado.\n\n**Creación de un túnel de ngrok:**\n\nUse ngrok para crear un túnel para los puntos de conexión HTTPS disponibles públicamente del servidor web en ejecución local. Ejecute el siguiente comando en ngrok:\n\n```bash\nngrok http --host-header=rewrite 3978\n```\n\n**Registro de una aplicación en Azure:**\n\n1. Inicie sesión en el [Azure Portal](https://portal.azure.com/) con su cuenta microsoft personal.\n1. Seleccione el servicio **Azure Active Directory** y, a continuación, seleccione **Registros de aplicaciones** en el panel izquierdo y, a continuación, seleccione **Nuevo registro**.\n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/azure-active-directory.png\" alt-text=\"Azure Active Directory.\":::\n\n1. **Se abre la página Registrar una aplicación** . Escriba la información de registro de la aplicación.\n1. Escriba un **nombre** de aplicación significativo que se muestre a los usuarios de la aplicación.\n1. En **Tipos de cuenta admitidos**, seleccione las cuentas que desea que admita la aplicación.\n1. En el campo **URI de redirección** (opcional), seleccione el tipo de **cliente web o público de la aplicación (escritorio de & móvil)** y, a continuación, escriba el URI de redirección de la aplicación.\n\n    > [!NOTE]\n    > Para las aplicaciones web, proporcione el URI base como `http://localhost:31544`. En el caso de las aplicaciones cliente públicas, proporcione el URI que usa Azure AD para devolver respuestas de token como `myapp://auth`.\n\n1. Seleccione **Registrar**.\n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/reg-app.png\" alt-text=\"Captura de pantalla que muestra la selección del registro.\":::\n\n**Para crear el secreto de cliente:**\n\n1. En **la página Información general** del bot, seleccione **Essentials** y guarde el **identificador de cliente de la aplicación** (Id. de aplicación de Microsoft) para futuras referencias.\n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/microsoft-app-id-new.png\" alt-text=\"Captura de pantalla que muestra el identificador de aplicación de Microsoft.\":::\n\n1. En **Administrar**, seleccione **Certificados & sección secretos** , seleccione **Secretos de cliente** y **nuevo secreto de cliente**. Aparece **la ventana Agregar un secreto de cliente** .  \n\n1. Escriba **Descripción** y seleccione **Agregar**.\n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/add-client.png\" alt-text=\"Captura de pantalla que muestra el secreto de cliente que se va a agregar.\":::\n\n1. En la columna **Valor**, seleccione **Copiar en el Portapapeles** y guarde el identificador de secreto de cliente para futuras referencias.\n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/client-secret.png\" alt-text=\"Camiseta que muestra el valor que se va a copiar en el Portapapeles.\":::\n\n**Ejecute el script de PowerShell para crear una directiva:**\n\n1. Cree una directiva para un usuario de inquilino de demostración para crear las reuniones en línea mediante el siguiente script de PowerShell:\n\n    > [!NOTE]\n    > Ejecute Windows PowerShell PSI como administrador y ejecute el script.\n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/powershell-script.png\" alt-text=\"Captura de pantalla que muestra el script de PowerShell.\":::\n\n1. Reemplace por `azure-client-id` el **identificador** de la aplicación de Microsoft del bot y `object-id` por el **identificador de inquilino** de su cuenta que se usa para iniciar sesión en Teams (copie el vínculo como se muestra en la siguiente imagen y puede encontrar el identificador de inquilino de su cuenta de Teams en el vínculo obtenido).\n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/teams-link-new.png\" alt-text=\"Captura de pantalla que muestra el reemplazo del identificador de Microsoft-App.\":::\n\n1. Agregue `PolicyName`, `azure-client-id`, `policy-description`y `object-id` en el script de PowerShell. Inicie sesión con su cuenta de Teams cuando PowerShell lo solicite.\n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/powershell.png\" alt-text=\"Captura de pantalla que muestra PowerShell.\":::\n\n1. Ejecute el siguiente comando en PowerShell para comprobar si la directiva se ha creado correctamente o no. Reemplace el nombre de la directiva por el nombre de directiva definido.\n\n    ```powershell\n    Get-CsApplicationAccessPolicy -Identity “<<policy-identity/policy-name>>”\n    ```\n\n**Para agregar permisos de API para llamadas de nivel inferior:**\n\n> [!NOTE]\n> Asegúrese de que su cuenta puede conceder el consentimiento del administrador a Microsoft. Después de agregar permisos, seleccione `Grant admin consent for Microsoft` para conocer el estado del consentimiento.\n\n1. En **el panel Administrar** del bot, seleccione **Permisos de API**.\n1. Seleccione **Agregar un permiso** Aparece la ventana **Solicitar permisos de API**.\n1. Seleccione **API de Microsoft** y **seleccione Microsoft Graph**.\n1. Seleccione **Permisos de aplicación** y, a continuación, permisos.\n1. Agregue los siguientes permisos de aplicaciones de Graph API a la App de Azure y conceda el consentimiento del administrador.\n    * `Calls.AccessMedia.All`\n    * `Calls.Initiate.All`\n    * `Calls.InitiateGroupCall.All`\n    * `Calls.JoinGroupCall.All`\n    * `Calls.JoinGroupCallAsGuest.All`\n    * `OnlineMeetings.ReadWrite.All`\n1. Seleccione **Agregar permisos**.\n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/add-api-permissions.png\" alt-text=\"Captura de pantalla que muestra los permisos de agregar API.\":::\n\n**Creación del registro de canal de bot en la cuenta de Azure:**\n\n1. Abra [Azure Portal](https://portal.azure.com/).\n1. Elija **Crear un recurso**.\n1. Busque **Azure Bot** en el cuadro de búsqueda.\n1. Seleccione **Bot de Azure**.\n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/azure-bot-homepage.png\" alt-text=\"Captura de pantalla que muestra la página principal del bot de Azure.\":::\n\n1. Seleccione **Crear**.\n1. Escriba el nombre del identificador del bot en el campo **Identificador de bot**.\n1. Seleccione su **Suscripción** en la lista desplegable.\n1. Seleccione el **grupo de recursos** existente en la lista desplegable o cree un nuevo grupo de recursos, seleccione **Crear nuevo**, escriba el nombre del recurso, seleccione **Aceptar** y seleccione Ubicación necesaria en la lista desplegable **Nueva ubicación del grupo de recursos** .\n    \n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/create-azure-bot.png\" alt-text=\"Captura de pantalla que muestra la creación del bot de Azure.\":::\n\n1. Seleccione **Tipo de aplicación** como **Multiinquilino** para el **Identificador de aplicación de Microsoft**.\n\n    > [!NOTE]\n    > En `Creation type` la sección Id. de aplicación de Microsoft, `Create new Microsoft App ID` ya está seleccionado para crear un nuevo bot. También puede seleccionar `Use existing app registration`, si ya ha registrado un bot. Escriba el identificador de aplicación de Microsoft en el `Existing app ID` campo y escriba el valor en el `Existing app password` campo .\n\n1. Seleccione **Usar registro de aplicación existente** y escriba **Id. de aplicación** y **Secreto** de aplicación de la aplicación de Azure registradas en el inquilino de demostración.\n1. Seleccione **Revisar y crear**.\n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/review-create.png\" alt-text=\"Captura de pantalla que muestra la selección de varios inquilinos.\":::\n\n1. Si se supera la validación, seleccione **Crear**.\n\n   El servicio de bot tarda unos minutos en aprovisionarse.\n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/validation.png\" alt-text=\"Captura de pantalla que muestra el paso de validación.\":::\n\n1. Seleccione **Ir a recursos**. El bot y los recursos relacionados aparecen en el grupo de recursos.\n\n    Ahora se ha creado el bot de Azure.\n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/go-to-resource.png\" alt-text=\"Captura de pantalla que muestra la navegación para ir al recurso.\":::\n\n**Para agregar el canal de Microsoft Teams:**\n\n1. Ve a **Inicio**.\n1. Abra el bot, que aparece en la sección **Recursos recientes**.\n1. Seleccione **Canales** en el panel izquierdo y seleccione **Microsoft Teams**. <img src=\"~/assets/images/bots/teamsicon.png\" alt=\"Teams icon\" width=\"20\"/> de la lista de canales disponibles.    \n    \n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/channels-teams.png\" alt-text=\"Captura de pantalla que muestra los canales de Teams.\":::\n\n1. Active la casilla para aceptar los términos de servicio y seleccione **Aceptar**.\n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/terms-of-service.png\" alt-text=\"Captura de pantalla que muestra los términos de servicio.\":::\n\n1. Seleccione **Guardar**.\n1. Seleccione **Microsoft Teams** y seleccione **la pestaña Llamadas** en la página del canal de Teams.\n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/configure-teams.png\" alt-text=\"Configurar Teams.\":::\n\n1. Seleccione **Habilitar llamada** y, a continuación, actualice **Webhook** con la dirección URL de ngrok HTTPS (https://yourNgrok/api/callback) y agregue `/api/callback` al final.\n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/enable-calling.png\" alt-text=\"Habilite la llamada.\":::\n\n1. Seleccione **Guardar**.\n\n**Para agregar un punto de conexión de mensajería:**\n\n1. Vaya a la página **Inicio** del bot y seleccione **Configuración** en **Configuración** en el panel izquierdo.\n1. Ve a ngrok.\n1. Copie la dirección URL HTTPS (https a io) como se muestra en la siguiente imagen:\n    \n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/ngrok.png\" alt-text=\"Captura de pantalla que muestra la ventana de Ngrok.\":::\n\n1. En **Punto de conexión de mensajería**, agregue la dirección URL HTTPS disponible desde ngrok y, al final de la dirección URL, agregue **/api/messages**.\n    \n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/messaging-endpoint.png\" alt-text=\"Captura de pantalla que muestra el punto de conexión de mensajería.\":::\n\n1. Seleccione **Aplicar**.\n\n    Ha configurado correctamente un bot en Azure Bot Service y ahora debe configurar la conexión de bot service.\n"
- title: Actualización y creación de un paquete de aplicaciones de Teams
  durationInMinutes: 1
  content: "Configure el ejemplo de bot para comprender cómo autenticar el bot conversacional en Microsoft Teams y crear el paquete de aplicaciones de Teams y cargarlo en la organización.\n\n1. Actualice appsettings.json en Visual Studio.\n1. Actualice manifest.json en Visual Studio y comprima el archivo zip en el Explorador de archivos.\n\n**Actualice appsettings para llamar a Bot:**\n\n1. Vaya al repositorio https://github.com/OfficeDev/Microsoft-Teams-Samples.git.\n1. Seleccione **Código** y seleccione la lista desplegable.\n1. Seleccione **Descargar ZIP**.\n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/repo-download.png\" alt-text=\"Captura de pantalla que muestra la descarga del repositorio.\":::\n\n1. Asegúrese de tener en cuenta la ruta de acceso del repositorio que se descarga.\n1. En la **Explorador de archivos**, vaya a la carpeta **csharp** **Microsoft-Teams-Samples-main** > **samples** > **bot-calling-meeting** > .\n1. Abra el archivo **appsettings.json** en Visual Studio y actualice la configuración del bot.\n\n    * Puede obtenerlo en la `MicrosoftAppId` página de configuración del bot. `MicrosoftAppPassword` es el valor del identificador de secreto de cliente que guardó anteriormente.\n    * Puede obtener o `Tenant ID` `UserId` desde el vínculo de la cuenta usada para iniciar sesión en Teams. Siga la ruta de acceso de la imagen para obtener el vínculo para `tenant ID`.\n    \n        :::image type=\"content\" source=\"./assets/images/calls-and-meetings/teams-link-new.png\" alt-text=\"Captura de pantalla que muestra el vínculo de Teams.\":::\n    \n    * Puede obtener y `UserId` desde el `DisplayName` sitio del [Explorador de Microsoft Graph](https://developer.microsoft.com/graph/graph-explorer).\n        * Inicie sesión en la página con su cuenta de Teams y agréguela `Users` al final de la instancia de URl en el cuadro de búsqueda y seleccione **Ejecutar consulta**.\n        * Se generan nombres para mostrar e identificadores de usuario vinculados a la cuenta.\n        * Elija tres cuentas y agréguelas a `DisplayName` y `UserId` en appsettings.json.\n\n        :::image type=\"content\" source=\"./assets/images/calls-and-meetings/graph-explorer.png\" alt-text=\"Explorador de Graph.\":::\n\n    > [!NOTE]\n    > `Tenant ID` o `UserId` de la cuenta de Teams indica desde dónde desea iniciar la llamada y `DisplayName` `UserId` de los usuarios denota a quién desea redirigir o transferir la llamada.\n\n1. Reemplace `MicrosoftAppId`, `ClientId`, `AppId` por el **identificador de la aplicación (cliente)** y `MicrosoftAppPassword`, `ClientSecret`y `AppSecret` por **el valor**.\n1. Actualice `BotBaseUrl` con la `ngrok` dirección URL.\n1. Actualice `Tenant ID` y `UserId`.\n1. Actualice `DisplayName` y `UserId`.\n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/appsettings.png\" alt-text=\"Captura de pantalla que muestra el archivo Json de Appsettings.\":::\n\n1. Seleccione **Guardar**.\n\n**Para actualizar el manifiesto:**\n\n1. En la **Explorador de archivos**, vaya a la carpeta **Microsoft-Teams-Samples-main** > **samples** > **bot-calling-meeting** > **csharp** > **Manifest** .\n1. Abra el archivo `manifest.json` en Visual Studio.\n1. En el `manifest.json` archivo, busque **{id}, {BotId}** y agregue el identificador de aplicación de Microsoft.\n1. Agregue la dirección URL de ngrok en **validDomains** excepto https:// y guarde.\n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/manifest.png\" alt-text=\"Captura de pantalla que muestra el manifiesto.\":::\n\n1. Comprima el contenido de la carpeta **Manifiesto** para crear `manifest.zip`.\n\n    > [!NOTE]\n    > `manifest.zip` no debe contener carpetas adicionales. Debe tener `manifest json` el archivo de origen, `color` el icono y `outline` el icono dentro de la carpeta zip.\n    > Cargue el manifiesto en el inquilino de demostración para la organización o la cuenta de Teams y ejecute la solución en Visual Studio.\n\n1. Vaya a Teams.\n1. Para cargar `manifest.zip`, seleccione **Store > Manage your apps (Administrar las aplicaciones) > Upload a custom app** and open from the repo folder in File explorer (Cargar una aplicación personalizada y abrir `manifest.zip` desde la carpeta del repositorio en el Explorador de archivos).\n1. Seleccione **Agregar** para instalar el bot de llamadas en Teams.\n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/output.png\" alt-text=\"Captura de pantalla que muestra la selección de agregar salida.\":::\n\n    Puede interactuar con este bot después de la depuración en Visual Studio.\n"
- title: Interacción con el bot de llamadas y reuniones
  durationInMinutes: 2
  content: >
    Bot le permite acceder a servicios y contenido en un espacio dedicado dentro de un canal o en un chat.


    Siga los pasos para usar el bot:


    1. En el panel izquierdo de Teams, seleccione los puntos suspensivos ●●● y elija la aplicación en la lista.

    1. El bot enviará texto de bienvenida con tarjeta adaptable, como se muestra a continuación.

        :::image type="content" source="./assets/images/calls-and-meetings/bot-with-adaptive-card.png" alt-text="Tarjeta adaptable en bot.":::

    1. Puede pedir al bot que cree una llamada.

        :::image type="content" source="./assets/images/calls-and-meetings/placed-call.png" alt-text="Captura de pantalla que muestra la llamada colocada.":::

    1. Puede pedir al bot que transfiera la llamada.

        :::image type="content" source="./assets/images/calls-and-meetings/transfer-call.png" alt-text="Captura de pantalla que muestra la llamada de transferencia.":::

    1. Puede pedir al bot que programe una reunión e invite a los participantes.

        :::image type="content" source="./assets/images/calls-and-meetings/meeting.png" alt-text="Captura de pantalla que muestra el bot de reunión.":::
- title: Desafío completo
  durationInMinutes: 1
  content: >
    ¿Se te ocurrió algo como esto?


    ![Salida final](~/assets/images/calls-and-meetings/final-output.png)
- content: Ha completado el tutorial para empezar a llamar a bots y a la aplicación de reunión para Microsoft Teams.
