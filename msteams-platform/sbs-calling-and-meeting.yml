### YamlMime:Tutorial
title: Teams de llamadas y reuniones
metadata:
  title: Teams bot con llamadas y reuniones
  description: En este tutorial, aprenderás a configurar llamadas y reuniones en un bot para Teams.
  audience: Developer
  level: Beginner
  ms.date: 02/08/2021
  ms.topic: interactive-tutorial
  nextTutorialHref: bots/calls-and-meetings/registering-calling-bot.md
  nextTutorialTitle: Registrar un bot de llamadas
  ms.custom: mvc
  ms.localizationpriority: none
  ms.openlocfilehash: 99671564ef597944b946c44a40f830d7b4558321
  ms.sourcegitcommit: a36760750ff4f510c374a4c956be57f7c1b4a0db
  ms.translationtype: MT
  ms.contentlocale: es-ES
  ms.lasthandoff: 03/20/2022
  ms.locfileid: "63674974"
items:
- durationInMinutes: 1
  content: >
    El bot de llamadas y reuniones proporciona funcionalidades básicas como crear una llamada, unirse a una llamada, transferir o redirigir una llamada, unirse a una reunión programada e invitar a los participantes integrando la API de comunicaciones en la nube Graph API.


    Los bots pueden interactuar con Teams llamadas y reuniones mediante el uso compartido de pantalla, vídeo y voz en tiempo real. Con las API Graph Microsoft para llamadas y reuniones en línea, Teams aplicaciones ahora pueden interactuar con los usuarios mediante voz y vídeo para mejorar la experiencia. Estas API le permiten agregar las siguientes características nuevas:


    * Respuesta de voz interactiva (IVR)

    * Control de llamadas

    * Acceso a secuencias de audio y vídeo en tiempo real, incluido el uso compartido de aplicaciones y escritorio


    Crea un bot y especifica información y permisos adicionales para usar estas API Graph api en una Teams aplicación.


    Esta guía paso a paso le ayuda a crear un bot con funciones de llamada y reunión. Al final de este tutorial puede lograr el siguiente resultado:


    ![Salida final](~/assets/images/calls-and-meetings/final-output.png)
- title: Requisitos previos
  durationInMinutes: 1
  content: "Asegúrese de instalar las siguientes herramientas y configurar el entorno de desarrollo:  \n\n* [Office 365 inquilino](https://developer.microsoft.com/microsoft-365/dev-program)\n* [Solución de túnel Ngrok](https://ngrok.com/) o equivalente\n* [Visual Studio 2019](https://visualstudio.microsoft.com/downloads/)\n* [SDK de .NET Core](https://dotnet.microsoft.com/download) versión 3.1\n* Microsoft Teams con una cuenta (no una cuenta de invitado)\n* Instalar [Windows PowerShell](/microsoftteams/teams-powershell-install) mediante la ejecución de todos los comandos\n"
- title: Setup Calling and Meeting Bot
  durationInMinutes: 5
  content: "Registre una aplicación mediante el registro de aplicaciones en el portal de Microsoft Azure para que la aplicación se integre con el Plataforma de identidad de Microsoft y llame a Microsoft Graph. Realice lo siguiente:\n\n1. Use ngrok para crear un túnel a los puntos de conexión del servidor web.\n1. Cree el recurso Bot de Azure para registrar el bot con el Servicio de bots de Azure.\n1. Cree un secreto de cliente que permita la autenticación sso del bot.\n1. Cree una directiva para un usuario de inquilino de demostración para crear las reuniones en línea con PowerShell.\n1. Agregar permisos de API para llamadas descendentes.\n1. Cree el registro del canal bot en la cuenta de Azure.\n1. Agregue Microsoft Teams para implementar el bot en un canal Teams.\n1. Agregue el punto de conexión de mensajería al túnel ngrok que creó.\n\n**Crear túnel ngrok:**\n\nUse ngrok para crear un túnel para los puntos de conexión HTTPS del servidor web que se ejecuta localmente. Ejecute el siguiente comando en ngrok:\n\n```bash\nngrok http -host-header=rewrite 3978\n```\n\n**Registrar una aplicación en Azure:**\n\n1. Inicie sesión en [Azure Portal](https://portal.azure.com/) con su cuenta personal de Microsoft.\n1. Seleccione el **Azure Active Directory** y seleccione **Registros de aplicaciones** en el panel izquierdo y, a continuación, **seleccione Nuevo registro**.\n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/azure-active-directory.png\" alt-text=\"Azure Active Directory.\":::\n\n1. **Se abre la página** Registrar una aplicación. Escriba la información de registro de la aplicación.\n1. Escriba un nombre de **aplicación significativo** que se muestre a los usuarios de la aplicación.\n1. En **Tipos de cuentas compatibles**, seleccione las cuentas que desea que admita la aplicación.\n1. En **el campo URI** de redireccionamiento (opcional), seleccione el tipo de aplicación **Web o cliente público (escritorio & móvil)** y, a continuación, escriba el URI de redireccionamiento de la aplicación.\n\n    > [!NOTE]\n    > Para aplicaciones web, proporcione el URI base como `http://localhost:31544`. Para las aplicaciones cliente públicas, proporcione el URI usado por Azure AD para devolver respuestas de token como `myapp://auth`.\n\n1. Seleccione **Registrar**.\n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/reg-app.png\" alt-text=\"Registrar una aplicación.\":::\n\n**Para crear un secreto de cliente:**\n\n1. En **la página** Información general del bot, seleccione **Essentials** y guarde el id. de cliente de **aplicación (Id** . de aplicación de Microsoft) para la referencia futura.\n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/microsoft-app-id-new.png\" alt-text=\"Id. de aplicación de Microsoft.\":::\n\n1. En **Administrar**, seleccione **Certificados & secretos y, a** continuación, seleccione **Secretos de** **cliente y nuevo secreto de cliente**. Aparecerá **la ventana Agregar un secreto de** cliente.  \n\n1. Escriba **Descripción** y seleccione **Agregar**.\n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/add-client.png\" alt-text=\"Agregar secreto de cliente.\":::\n\n1. En la **columna Valor** , seleccione **Copiar en el** Portapapeles y guarde el identificador de secreto de cliente para la referencia futura.\n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/client-secret.png\" alt-text=\"Valor.\":::\n\n**Ejecute el script de PowerShell para crear una directiva:**\n\n1. Cree una directiva para un usuario de inquilino de demostración para crear las reuniones en línea con el siguiente script de PowerShell:\n\n    > [!NOTE]\n    > Ejecute Windows PowerShell PSI como administrador y ejecute el script.\n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/powershell-script.png\" alt-text=\"Script de PowerShell.\":::\n\n1. Reemplace `azure-client-id` con el identificador de **aplicación de Microsoft** del bot `object-id` y con  el identificador de inquilino de su cuenta que se usa para iniciar sesión en el Teams (Copie el vínculo como se muestra en la siguiente imagen y puede encontrar el identificador de inquilino de su cuenta de Teams en el vínculo obtenido).\n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/teams-link-new.png\" alt-text=\"Teams link.\":::\n\n1. Agregue `PolicyName`, `azure-client-id`, `policy-description`y en `object-id` el script de PowerShell. Inicie sesión con su Teams cuando Se solicite PowerShell.\n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/powershell.png\" alt-text=\"PowerShell.\":::\n\n1. Ejecute el siguiente comando en PowerShell para comprobar si la directiva se creó correctamente o no. Reemplace el nombre de la directiva por el nombre de directiva definido.\n\n    ```powershell\n    Get-CsApplicationAccessPolicy -Identity “<<policy-identity/policy-name>>”\n    ```\n\n**Para agregar permisos de API para llamadas descendentes:**\n\n> [!NOTE]\n> Asegúrese de que su cuenta puede conceder el consentimiento de administrador para Microsoft. Después de agregar permisos, seleccione `Grant admin consent for Microsoft` para conocer el estado del consentimiento.\n\n1. En **el panel** Administrar del bot, seleccione **Permisos de API**.\n1. Seleccione **Agregar un permiso** **Aparece la ventana Solicitar permisos de la API** .\n1. Seleccione **API de Microsoft y** seleccione **Microsoft Graph**.\n1. Seleccione **Permisos de aplicación y** , a continuación, seleccione permisos.\n1. Agregue los siguientes Graph de aplicaciones api a su aplicación de Azure y conceda el consentimiento de administrador.\n    * `Calls.AccessMedia.All`\n    * `Calls.Initiate.All`\n    * `Calls.InitiateGroupCall.All`\n    * `Calls.JoinGroupCall.All`\n    * `Calls.JoinGroupCallAsGuest.All`\n    * `OnlineMeetings.ReadWrite.All`\n1. Seleccione **Agregar permisos**.\n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/add-api-permissions.png\" alt-text=\"Agregar permisos de API.\":::\n\n**Crear registro del canal bot en la cuenta de Azure:**\n\n1. Abra [Azure Portal](https://portal.azure.com/).\n1. Elija **Crear un recurso**.\n1. Busque **Bot de Azure** en el cuadro de búsqueda.\n1. Seleccione **Bot de Azure**.\n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/azure-bot-homepage.png\" alt-text=\"Tarjeta de bot de Azure.\":::\n\n1. Seleccione **Crear**.\n1. Escriba el nombre del controlador del **bot en el campo Detección de** bots.\n1. Selecciona tu **suscripción** en la lista desplegable.\n1. Selecciona el **grupo De recursos** de la lista desplegable.\n\n    Para crear un nuevo grupo de recursos, seleccione **Crear** nuevo, escriba el nombre del recurso, seleccione **Aceptar** y seleccione ubicación necesaria en La lista desplegable Nueva ubicación **del grupo de** recursos.\n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/create-azure-bot.png\" alt-text=\"Crear bot de Azure.\":::\n\n1. Selecciona **Tipo de aplicación como** **multiinquilino** para **id. de aplicación de Microsoft**.\n\n    > [!NOTE]\n    > En `Creation type` la sección Id. de aplicación de Microsoft, `Create new Microsoft App ID` ya está seleccionada para crear un bot nuevo. También puede seleccionar `Use existing app registration`, si ya ha registrado un bot. Escriba el id. de aplicación de `Existing app id` Microsoft en el campo y escriba el valor en `Existing app password` el campo.\n\n1. Selecciona **Usar el registro de la aplicación existente** y escribe Id. **de** **aplicación y** secreto de aplicación de la aplicación de Azure registrada en el inquilino de demostración.\n1. Seleccione **Revisar y crear**.\n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/review-create.png\" alt-text=\"Inquilino múltiple.\":::\n\n1. Si la validación pasa, seleccione **Crear**.\n\n   El servicio de bots tarda unos minutos en aprovisionarse.\n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/validation.png\" alt-text=\"Validación.\":::\n\n1. Seleccione **Ir a recursos**. El bot y los recursos relacionados se enumeran en el grupo de recursos.\n\n    Ahora se ha creado el bot de Azure.\n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/go-to-resource.png\" alt-text=\"Ir al recurso.\":::\n\n**Para agregar el Microsoft Teams:**\n\n1. Vaya a **Inicio**.\n1. Abra el bot, que aparece en la **sección Recursos** recientes.\n1. Seleccione **Canales** en el panel izquierdo y **seleccione Microsoft Teams** <img src=\"~/assets/images/bots/teamsicon.png\" alt=\"Teams icon\" width=\"20\"/> de la lista de canales disponibles.    \n    \n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/channels-teams.png\" alt-text=\"Canales Teams.\":::\n\n1. Active la casilla para aceptar los términos del servicio y seleccione **Aceptar**.\n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/terms-of-service.png\" alt-text=\"Términos de servicio.\":::\n\n1. Seleccione **Guardar**.\n1. Seleccione **Microsoft Teams** y seleccione **La pestaña Llamar** en Teams de canal.\n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/configure-teams.png\" alt-text=\"Configure Teams.\":::\n\n1. Seleccione **Habilitar llamada** y, a continuación, actualice **Webhook** con la dirección URL de https ngrok (https://yourNgrok/api/callback) y agregue `/api/callback` al final.\n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/enable-calling.png\" alt-text=\"Habilitar la llamada.\":::\n\n1. Seleccione **Guardar**.\n\n**Para agregar punto de conexión de mensajería:**\n\n1. Vaya a **la página** principal del bot y seleccione **Configuración** en **Configuración** desde el panel izquierdo.\n1. Vaya a ngrok.\n1. Copie la dirección URL HTTPS (https a io) como se muestra en la siguiente imagen:\n    \n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/ngrok.png\" alt-text=\"Ngrok.\":::\n\n1. En **El extremo de** mensajería, agregue la dirección URL HTTPS disponible desde ngrok y al final de la dirección URL agregue **/api/messages**.\n    \n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/messaging-endpoint.png\" alt-text=\"Extremo de mensajería.\":::\n\n1. Seleccione **Aplicar**.\n\n    Ha configurado correctamente un bot en el Servicio de bots de Azure y ahora necesita configurar la conexión del servicio bot.\n"
- title: Actualizar y crear un paquete Teams aplicación
  durationInMinutes: 1
  content: "Configure el ejemplo de bot para comprender cómo autenticar el bot de conversación en Microsoft Teams crear el paquete de aplicación Teams y cargarlo en la organización.\n\n1. Actualice appsettings.json en Visual Studio.\n1. Actualice manifest.json en Visual Studio y comprimalo en el archivo zip en el Explorador de archivos.\n\n**Actualizar appsettings para llamar a Bot:**\n\n1. Vaya al repositorio https://github.com/OfficeDev/Microsoft-Teams-Samples.git.\n1. Seleccione **Código** y seleccione la lista desplegable.\n1. Seleccione **Descargar ZIP**.\n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/repo-download.png\" alt-text=\"Descarga de repositorio.\":::\n\n1. Asegúrese de tener en cuenta la ruta de acceso del repositorio que se descarga.\n1. En el **Explorador de archivos**, vaya a la carpeta Microsoft-Teams-Samples-mainsamplesbot-calling-meetingcsharp. >  >  > \n1. Abra el **archivo appsettings.json** en Visual Studio y actualice la configuración del bot.\n\n    * Puede obtener la de `MicrosoftAppId` la página de configuración del bot. Es `MicrosoftAppPassword` el valor del identificador secreto de cliente que guardó anteriormente.\n    * Puede obtener el vínculo `Tenant ID` o `UserId` del vínculo de la cuenta usada para iniciar sesión en el Teams. Siga la ruta de acceso de la imagen para obtener el vínculo para `tenant id`.\n    \n        :::image type=\"content\" source=\"./assets/images/calls-and-meetings/teams-link-new.png\" alt-text=\"Teams link.\":::\n    \n    * Puede obtener el y `DisplayName` `UserId` del sitio [de Microsoft Graph Explorer](https://developer.microsoft.com/graph/graph-explorer).\n        * Inicie sesión en la página con su Teams y `Users` agregue al final de la URl en el cuadro de búsqueda y seleccione **Ejecutar consulta**.\n        * Se generan nombres para mostrar e id. de usuario vinculados a su cuenta.\n        * Elija las tres cuentas y agrégrelas al `DisplayName` archivo `UserId` appsettings.json.\n\n        :::image type=\"content\" source=\"./assets/images/calls-and-meetings/graph-explorer.png\" alt-text=\"Graph Explorer.\":::\n\n    > [!NOTE]\n    > `Tenant ID`o `UserId` de la cuenta Teams indica desde dónde desea iniciar la llamada, `DisplayName` `UserId` y de los usuarios indica a quién desea redirigir o transferir la llamada.\n\n1. Reemplace `MicrosoftAppId`, `ClientId`, por `AppId` su **identificador de aplicación (cliente)** y `MicrosoftAppPassword`, `ClientSecret`y por `AppSecret` su **valor**.\n1. Actualice `BotBaseUrl` con la `ngrok` dirección URL.\n1. Actualizar `Tenant ID` y `UserId`.\n1. Actualizar `DisplayName` y `UserId`.\n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/appsettings.png\" alt-text=\"Appsettings Json.\":::\n\n1. Seleccione **Guardar**.\n\n**Para actualizar el manifiesto:**\n\n1. En el **Explorador de** archivos, vaya a la carpeta Microsoft-Teams-Samples-mainsamplesbot-calling-meetingcsharpManifest > . >  >  > \n1. Abra el **archivo manifest.json** en Visual Studio.\n1. En el **archivo manifest.json** , busque **{id}, {BotId}** y agregue el identificador de aplicación de Microsoft.\n1. Agregue la dirección URL de ngrok **en validDomains** excluyendo https:// y guardar.\n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/manifest.png\" alt-text=\"Manifiesto.\":::\n\n1. Zip the contents of the **Manifest** folder to create **manifest.zip**.\n\n    > [!NOTE]\n    > No `manifest.zip` debe contener carpetas adicionales. Debe tener el archivo `manifest json` de origen, `color` el icono y el `outline` icono dentro de la carpeta zip.\n    > Upload su manifiesto en el espacio empresarial de demostración para la organización o su cuenta de Teams y ejecute la solución en Visual Studio.\n\n1. Vaya a Teams.\n1. Para cargar **manifest.zip**, selecciona Store **> Administrar** tus aplicaciones > Upload una aplicación personalizada y abremanifest.zipdesde la carpeta repositorio en el Explorador **** de archivos.\n1. Seleccione **Agregar para** instalar el bot de llamadas en Teams.\n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/output.png\" alt-text=\"Agregar salida.\":::\n\n    Puede interactuar con este bot después de la depuración en Visual Studio.\n"
- title: Interacción con el bot de llamadas y reuniones
  durationInMinutes: 2
  content: >
    Bot te permite tener acceso a servicios y contenido en un espacio dedicado dentro de un canal o en un chat.


    Siga los pasos para usar el bot:


    1. En el panel izquierdo de la Teams, seleccione los puntos suspensivos de la aplicación y elija la aplicación en la lista.

    1. Bot enviará texto de bienvenida con tarjeta adaptable como se muestra a continuación.

        :::image type="content" source="./assets/images/calls-and-meetings/bot-with-adaptive-card.png" alt-text="Tarjeta adaptable en bot.":::

    1. Puedes pedir al bot que cree una llamada.

        :::image type="content" source="./assets/images/calls-and-meetings/placed-call.png" alt-text="Llamada colocada.":::

    1. Puedes pedir al bot que transfiera la llamada.

        :::image type="content" source="./assets/images/calls-and-meetings/transfer-call.png" alt-text="Transferir llamada.":::

    1. Puedes pedir al bot que programe una reunión e invitar a los participantes.

        :::image type="content" source="./assets/images/calls-and-meetings/meeting.png" alt-text="Bot de reunión.":::
- title: Desafío completo
  durationInMinutes: 1
  content: >
    ¿Has llegado a algo como esto?


    ![Salida final](~/assets/images/calls-and-meetings/final-output.png)
- content: Has completado el tutorial para empezar con las llamadas de bot y la aplicación de reunión para Microsoft Teams.
