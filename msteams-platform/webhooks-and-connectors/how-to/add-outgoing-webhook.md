---
title: Agregar bots personalizados a Microsoft Teams con webhooks salientes
author: laujan
description: ''
keywords: webhook saliente de pestañas de Teams *
ms.topic: conceptual
ms.author: laujan
ms.openlocfilehash: 4881dc8768c7c51947f6a80a55affe78c28874d3
ms.sourcegitcommit: 3ba5a5a7d9d9d906abc3ee1df9c2177de0cfd767
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 07/11/2020
ms.locfileid: "45103001"
---
# <a name="add-custom-bots-to-microsoft-teams-with-outgoing-webhooks"></a><span data-ttu-id="81b6d-103">Agregar bots personalizados a Microsoft Teams con webhooks salientes</span><span class="sxs-lookup"><span data-stu-id="81b6d-103">Add custom bots to Microsoft Teams with outgoing webhooks</span></span>

## <a name="what-are-outgoing-webhooks-in-teams"></a><span data-ttu-id="81b6d-104">¿Qué son los webhooks salientes en Teams?</span><span class="sxs-lookup"><span data-stu-id="81b6d-104">What are outgoing webhooks in Teams?</span></span>

<span data-ttu-id="81b6d-105">Los webhooks son una buena forma de que Microsoft Teams se integre con aplicaciones externas.</span><span class="sxs-lookup"><span data-stu-id="81b6d-105">Webhooks are a great way for Teams to integrate with external apps.</span></span> <span data-ttu-id="81b6d-106">Un webhook es básicamente una solicitud POST enviada a una dirección URL de devolución de llamada.</span><span class="sxs-lookup"><span data-stu-id="81b6d-106">A webhook is essentially a POST request sent to a callback URL.</span></span> <span data-ttu-id="81b6d-107">En Teams, los webhooks salientes proporcionan una forma sencilla de permitir que los usuarios envíen mensajes al servicio Web sin tener que pasar por el proceso completo de creación de bots mediante [Microsoft bot Framework](https://dev.botframework.com/).</span><span class="sxs-lookup"><span data-stu-id="81b6d-107">In Teams, outgoing webhooks provide a simple way to allow users to send messages to your web service without having to go through the full process of creating bots via the [Microsoft Bot Framework](https://dev.botframework.com/).</span></span> <span data-ttu-id="81b6d-108">Los webhooks salientes exponen datos de Teams a cualquier servicio seleccionado que pueda aceptar una carga JSON.</span><span class="sxs-lookup"><span data-stu-id="81b6d-108">Outgoing webhooks post data from Teams to any chosen service capable of accepting a JSON payload.</span></span> <span data-ttu-id="81b6d-109">Una vez que un webhook de salida se agrega a un equipo, actúa como bot, escuchando en los canales los mensajes que usan la \*\* \@ mención\*\*, el envío de notificaciones a servicios web externos y la respuesta con mensajes enriquecidos que pueden incluir tarjetas e imágenes.</span><span class="sxs-lookup"><span data-stu-id="81b6d-109">Once an outgoing webhook is added to a team, it acts like bot, listening in channels for messages using **\@mention**, sending notifications to external web services, and responding with rich messages that can include cards and images.</span></span>

## <a name="outgoing-webhook-key-features"></a><span data-ttu-id="81b6d-110">Características de la clave de webhook saliente</span><span class="sxs-lookup"><span data-stu-id="81b6d-110">Outgoing webhook key features</span></span>

| <span data-ttu-id="81b6d-111">Característica</span><span class="sxs-lookup"><span data-stu-id="81b6d-111">Feature</span></span> | <span data-ttu-id="81b6d-112">Descripción</span><span class="sxs-lookup"><span data-stu-id="81b6d-112">Description</span></span> |
| ------- | ----------- |
| <span data-ttu-id="81b6d-113">Configuración con ámbito</span><span class="sxs-lookup"><span data-stu-id="81b6d-113">Scoped Configuration</span></span>| <span data-ttu-id="81b6d-114">Los webhooks tienen un ámbito en el nivel de equipo.</span><span class="sxs-lookup"><span data-stu-id="81b6d-114">Webhooks are scoped at the team level.</span></span> <span data-ttu-id="81b6d-115">Deberá pasar por el proceso de configuración para cada equipo al que quiera agregar el webhook saliente.</span><span class="sxs-lookup"><span data-stu-id="81b6d-115">You’ll need to go through the setup process for each team you want to add your outgoing webhook to.</span></span> |
| <span data-ttu-id="81b6d-116">Mensajería reactiva</span><span class="sxs-lookup"><span data-stu-id="81b6d-116">Reactive Messaging</span></span>| <span data-ttu-id="81b6d-117">Los usuarios deben usar @mention para que el webhook reciba mensajes.</span><span class="sxs-lookup"><span data-stu-id="81b6d-117">Users must use @mention for the webhook to receive messages.</span></span> <span data-ttu-id="81b6d-118">Actualmente, los usuarios solo pueden hacer un mensaje de un webhook de salida en canales públicos y no dentro del ámbito personal o privado.</span><span class="sxs-lookup"><span data-stu-id="81b6d-118">Currently users can only message an outgoing webhook in public channels and not within the personal or private scope</span></span> |
|<span data-ttu-id="81b6d-119">Intercambio de mensajes HTTP estándar</span><span class="sxs-lookup"><span data-stu-id="81b6d-119">Standard HTTP message exchange</span></span>|<span data-ttu-id="81b6d-120">Las respuestas aparecerán en la misma cadena que el mensaje de solicitud original y pueden incluir cualquier contenido de mensaje del marco de Bot? (texto enriquecido, imágenes, tarjetas y emojis).</span><span class="sxs-lookup"><span data-stu-id="81b6d-120">Responses will appear in the same chain as the original request message and can include any Bot Framework message content (rich text, images, cards, and emojis).</span></span> <span data-ttu-id="81b6d-121">**Nota**: aunque los webhooks salientes pueden usar tarjetas, no pueden usar ninguna acción de tarjeta excepto para `openURL` .</span><span class="sxs-lookup"><span data-stu-id="81b6d-121">**Note**: Although outgoing webhooks can use cards, they cannot use any card actions except for `openURL`.</span></span>|
| <span data-ttu-id="81b6d-122">Compatibilidad del método de la API de Microsoft Teams</span><span class="sxs-lookup"><span data-stu-id="81b6d-122">Teams API method support</span></span>|<span data-ttu-id="81b6d-123">En Teams, los webhooks salientes envían un HTTP POST a un servicio Web y procesan una respuesta.</span><span class="sxs-lookup"><span data-stu-id="81b6d-123">In Teams, outgoing webhooks send an HTTP POST to a web service and process a response back.</span></span> <span data-ttu-id="81b6d-124">No pueden tener acceso a ninguna otra API, como recuperar la lista o la lista de canales de un equipo.</span><span class="sxs-lookup"><span data-stu-id="81b6d-124">They cannot access any other APIs like retrieve the roster or list of channels in a team.</span></span>|

## <a name="adding-outgoing-webhook-processing-to-your-app"></a><span data-ttu-id="81b6d-125">Adición de procesamiento de webhook saliente a la aplicación</span><span class="sxs-lookup"><span data-stu-id="81b6d-125">Adding outgoing webhook processing to your app</span></span>

<span data-ttu-id="81b6d-126">**Escenario**: inserción de notificaciones de estado del cambio en un servidor de base de datos de canal de Microsoft Teams para la aplicación.</span><span class="sxs-lookup"><span data-stu-id="81b6d-126">**Scenario**: Push change status notifications on a Teams channel database server to your app.</span></span>  
<span data-ttu-id="81b6d-127">**Ejemplo**: tiene una aplicación de línea de negocio que realiza un seguimiento de todas las operaciones CRUD realizadas a los registros de empleados por parte de los usuarios de recursos humanos de los equipos de recursos humanos en un arrendamiento de Office 365.</span><span class="sxs-lookup"><span data-stu-id="81b6d-127">**Example**: You have a line-of-business app that tracks all CRUD operations made to employee records by Teams channel HR users across an Office 365 tenancy.</span></span>

### <a name="1-create-a-url-on-your-apps-server-to-accept-and-process-a-post-request-with-a-json-payload"></a><span data-ttu-id="81b6d-128">1. crear una dirección URL en el servidor de la aplicación para aceptar y procesar una solicitud POST con una carga JSON</span><span class="sxs-lookup"><span data-stu-id="81b6d-128">1. Create a URL on your app's server to accept and process a POST request with a JSON payload</span></span>

<span data-ttu-id="81b6d-129">El servicio recibirá mensajes en el esquema de mensajería estándar del servicio de robots de Azure.</span><span class="sxs-lookup"><span data-stu-id="81b6d-129">Your service will receive messages in the standard Azure bot service messaging schema.</span></span> <span data-ttu-id="81b6d-130">Bot Framework Connector es un servicio RESTful que permite al servicio procesar el intercambio de mensajes con formato JSON a través de protocolos HTTPS, tal como se documenta en la [API del servicio de bot de Azure](/bot-framework/rest-api/bot-framework-rest-connector-api-reference).</span><span class="sxs-lookup"><span data-stu-id="81b6d-130">The Bot Framework connector is a RESTful service that enables your service to process the interchange of JSON formatted messages via HTTPS protocols as documented in the [Azure Bot Service API](/bot-framework/rest-api/bot-framework-rest-connector-api-reference).</span></span> <span data-ttu-id="81b6d-131">Como alternativa, puede seguir [Microsoft bot Framework SDK] para procesar y analizar mensajes.</span><span class="sxs-lookup"><span data-stu-id="81b6d-131">Alternatively, you can follow the [Microsoft Bot Framework SDK] to process and parse messages.</span></span> <span data-ttu-id="81b6d-132">*Consulte también*  [acerca del servicio de bot de Azure](/azure/bot-service/bot-service-overview-introduction?view=azure-bot-service-4.0).</span><span class="sxs-lookup"><span data-stu-id="81b6d-132">*See also*  [About Azure Bot Service](/azure/bot-service/bot-service-overview-introduction?view=azure-bot-service-4.0).</span></span>

<span data-ttu-id="81b6d-133">Los webhooks de salida tienen un ámbito de `team` nivel y son visibles para todos los miembros del equipo.</span><span class="sxs-lookup"><span data-stu-id="81b6d-133">Outgoing webhooks are scoped to the `team` level and are visible to all members of the team.</span></span> <span data-ttu-id="81b6d-134">Al igual que un bot, los usuarios deben \*\* \@ mencionar\*\* el nombre del webhook saliente para invocarlo en el canal.</span><span class="sxs-lookup"><span data-stu-id="81b6d-134">Just like a bot, users are required to **\@mention** the name of the outgoing webhook to invoke it in the channel.</span></span>

### <a name="2-create-a-method-to-verify-the-outgoing-webhook-hmac-token"></a><span data-ttu-id="81b6d-135">2. crear un método para comprobar el token HMAC de webhook saliente</span><span class="sxs-lookup"><span data-stu-id="81b6d-135">2. Create a method to verify the outgoing webhook HMAC token</span></span>

<span data-ttu-id="81b6d-136">Para asegurarse de que el servicio recibe llamadas de clientes de equipos reales, Teams proporciona un código HMAC en el `hmac` encabezado HTTP que siempre debe incluirse en el protocolo de autenticación.</span><span class="sxs-lookup"><span data-stu-id="81b6d-136">To ensure that your service is receiving calls only from actual Teams clients, Teams provides an HMAC Code in the HTTP `hmac` header that should always be  included in your authentication protocol.</span></span>

<span data-ttu-id="81b6d-137">El código siempre debe validar la firma HMAC que se incluye en la solicitud:</span><span class="sxs-lookup"><span data-stu-id="81b6d-137">Your code should always validate the HMAC signature included in the request:</span></span>

* <span data-ttu-id="81b6d-138">*Generar* el token HMAC desde el cuerpo de la solicitud del mensaje.</span><span class="sxs-lookup"><span data-stu-id="81b6d-138">*Generate* the HMAC token from the request body of the message.</span></span> <span data-ttu-id="81b6d-139">Hay bibliotecas estándar para hacer esto en la mayoría de las plataformas (*consulte* [Crypto](https://nodejs.org/api/crypto.html#crypto_crypto) for Node.js o *See* [Team webhook Sample](https://github.com/OfficeDev/microsoft-teams-sample-outgoing-webhook/blob/23eb61da5a18634d51c5247944843da9abed01b6/WebhookSampleBot/Models/AuthProvider.cs) for C \# ).</span><span class="sxs-lookup"><span data-stu-id="81b6d-139">There are standard libraries to do this on most platforms (*see* [Crypto](https://nodejs.org/api/crypto.html#crypto_crypto) for Node.js or  *see* [Teams Webhook Sample](https://github.com/OfficeDev/microsoft-teams-sample-outgoing-webhook/blob/23eb61da5a18634d51c5247944843da9abed01b6/WebhookSampleBot/Models/AuthProvider.cs) for C\#).</span></span> <span data-ttu-id="81b6d-140">Microsoft Teams usa la criptografía de HMAC estándar SHA256.</span><span class="sxs-lookup"><span data-stu-id="81b6d-140">Microsoft Teams uses standard SHA256 HMAC cryptography .</span></span> <span data-ttu-id="81b6d-141">Tendrá que convertir el cuerpo en una matriz de bytes en UTF8.</span><span class="sxs-lookup"><span data-stu-id="81b6d-141">You will need to convert the body to a byte array in UTF8.</span></span>
* <span data-ttu-id="81b6d-142">*Calcule* el hash a partir de la matriz de bytes del token de seguridad **proporcionado por Teams** cuando registró el webhook saliente en el cliente de Teams.</span><span class="sxs-lookup"><span data-stu-id="81b6d-142">*Compute* the hash from the byte array of the security token **provided by Teams** when you registered the outgoing webhook in the Teams client].</span></span> <span data-ttu-id="81b6d-143">*Consulte* [crear un webhook saliente](#create-an-outgoing-webhook), a continuación.</span><span class="sxs-lookup"><span data-stu-id="81b6d-143">*See* [Create an outgoing webhook](#create-an-outgoing-webhook), below.</span></span>
* <span data-ttu-id="81b6d-144">*Convierta* el hash en una cadena con codificación UTF-8.</span><span class="sxs-lookup"><span data-stu-id="81b6d-144">*Convert* the hash to a string using UTF-8 encoding.</span></span>
* <span data-ttu-id="81b6d-145">*Compare* el valor de cadena del hash generado con el valor proporcionado en la solicitud HTTP.</span><span class="sxs-lookup"><span data-stu-id="81b6d-145">*Compare* the string value of the generated hash with the value provided in the HTTP request.</span></span>

### <a name="3-create-a-method-to-send-a-success-or-failure-response"></a><span data-ttu-id="81b6d-146">3. crear un método para enviar una respuesta correcta o incorrecta</span><span class="sxs-lookup"><span data-stu-id="81b6d-146">3. Create a method to send a success or failure response</span></span>

<span data-ttu-id="81b6d-147">Las respuestas del webhook saliente aparecerán en la misma cadena de respuesta que el mensaje original.</span><span class="sxs-lookup"><span data-stu-id="81b6d-147">Responses from your outgoing webhook will appear in the same reply chain as the original message.</span></span> <span data-ttu-id="81b6d-148">Cuando el usuario realiza una consulta, Microsoft Teams emite una solicitud HTTP sincrónica a su servicio y el código tendrá 5 segundos para responder al mensaje antes de que se agote el tiempo de espera de la conexión y finalice.</span><span class="sxs-lookup"><span data-stu-id="81b6d-148">When the user performs a query, Microsoft Teams issues a synchronous HTTP request to your service and your code will have 5 seconds to respond to the message before the connection times out and terminates.</span></span>

### <a name="example-response"></a><span data-ttu-id="81b6d-149">Ejemplo de respuesta</span><span class="sxs-lookup"><span data-stu-id="81b6d-149">Example response</span></span>

```json
{
    "type": "message",
    "text": "This is a reply!"
}
```

## <a name="create-an-outgoing-webhook"></a><span data-ttu-id="81b6d-150">Creación de un webhook saliente</span><span class="sxs-lookup"><span data-stu-id="81b6d-150">Create an outgoing webhook</span></span>

1. <span data-ttu-id="81b6d-151">Seleccione el equipo adecuado y seleccione **administrar equipo** en el menú desplegable (&#8226;&#8226;&#8226;).</span><span class="sxs-lookup"><span data-stu-id="81b6d-151">Select the appropriate team and select **Manage team** from the (&#8226;&#8226;&#8226;) drop-down menu.</span></span>
1. <span data-ttu-id="81b6d-152">Elija la pestaña **aplicaciones** de la barra de navegación.</span><span class="sxs-lookup"><span data-stu-id="81b6d-152">Choose the **Apps** tab from the navigation bar.</span></span>
1. <span data-ttu-id="81b6d-153">En la esquina inferior derecha de la ventana, seleccione **crear un webhook saliente**.</span><span class="sxs-lookup"><span data-stu-id="81b6d-153">From the window's lower right corner select **Create an outgoing webhook**.</span></span>
1. <span data-ttu-id="81b6d-154">En la ventana emergente resultante, complete los campos obligatorios:</span><span class="sxs-lookup"><span data-stu-id="81b6d-154">In the resulting popup window complete the required fields:</span></span>

>* <span data-ttu-id="81b6d-155">**Name** : el título del webhook y el @mention TAP.</span><span class="sxs-lookup"><span data-stu-id="81b6d-155">**Name** - The webhook title and @mention tap.</span></span>
>* <span data-ttu-id="81b6d-156">**URL de devolución de llamada** : el extremo https que acepta cargas JSON y recibirá solicitudes post de Teams.</span><span class="sxs-lookup"><span data-stu-id="81b6d-156">**Callback URL** - The HTTPS endpoint that accepts JSON payloads and will receive POST requests from Teams.</span></span>
>* <span data-ttu-id="81b6d-157">**Description** : una cadena detallada que aparecerá en la tarjeta de perfil y en el panel de la aplicación de nivel de equipo.</span><span class="sxs-lookup"><span data-stu-id="81b6d-157">**Description** - A detailed string that will appear in the profile card and the team-level App dashboard.</span></span>
>* <span data-ttu-id="81b6d-158">**Imagen de perfil** (opcional) icono de aplicación para el webhook.</span><span class="sxs-lookup"><span data-stu-id="81b6d-158">**Profile Picture** (optional) an app icon for your webhook.</span></span>
>* <span data-ttu-id="81b6d-159">Seleccione el botón **crear** desde la esquina inferior derecha de la ventana emergente y el webhook de salida se agregará a los canales del equipo actual.</span><span class="sxs-lookup"><span data-stu-id="81b6d-159">Select the **Create** button from lower right corner of the pop-up window and the outgoing webhook will be added to the current team's channels.</span></span>
>* <span data-ttu-id="81b6d-160">La siguiente ventana de diálogo mostrará un token [de seguridad de código de autenticación de mensajes (HMAC) basado en hash](https://security.stackexchange.com/questions/20129/how-and-when-do-i-use-hmac/20301) que se usará para autenticar las llamadas entre Microsoft Teams y el servicio externo designado.</span><span class="sxs-lookup"><span data-stu-id="81b6d-160">The next dialog window will display an [Hash-based Message Authentication Code (HMAC)](https://security.stackexchange.com/questions/20129/how-and-when-do-i-use-hmac/20301) security token that will be used to authenticate calls between Teams and the designated outside service.</span></span>
>* <span data-ttu-id="81b6d-161">Si la dirección URL es válida y los tokens de autenticación del servidor y del cliente son iguales (es decir, un protocolo de enlace HMAC), el webhook saliente estará disponible para los usuarios del equipo.</span><span class="sxs-lookup"><span data-stu-id="81b6d-161">If the URL is valid and the server and client authentication tokens are equal (i.e., an HMAC handshake), the outgoing webhook will be available to the team's users.</span></span>

## <a name="code-samples"></a><span data-ttu-id="81b6d-162">Muestras de código</span><span class="sxs-lookup"><span data-stu-id="81b6d-162">Code samples</span></span>

<span data-ttu-id="81b6d-163">Puede ver ejemplos de código de webhook salientes en GitHub:</span><span class="sxs-lookup"><span data-stu-id="81b6d-163">You can view outgoing webhook code samples on GitHub:</span></span>

### <a name="nodejs"></a><span data-ttu-id="81b6d-164">Node.js</span><span class="sxs-lookup"><span data-stu-id="81b6d-164">Node.js</span></span>

[<span data-ttu-id="81b6d-165">OfficeDev/msteams-samples-outhook-webhook-NodeJS</span><span class="sxs-lookup"><span data-stu-id="81b6d-165">OfficeDev/msteams-samples-outgoing-webhook-nodejs</span></span>](https://github.com/OfficeDev/msteams-samples-outgoing-webhook-nodejs)

### <a name="c"></a><span data-ttu-id="81b6d-166">CA\#</span><span class="sxs-lookup"><span data-stu-id="81b6d-166">C\#</span></span>

[<span data-ttu-id="81b6d-167">OfficeDev/Microsoft-Teams-Sample-outhook</span><span class="sxs-lookup"><span data-stu-id="81b6d-167">OfficeDev/microsoft-teams-sample-outgoing-webhook</span></span>](https://github.com/OfficeDev/microsoft-teams-sample-outgoing-webhook)
