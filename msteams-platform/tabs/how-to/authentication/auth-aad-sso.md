---
title: Compatibilidad con inicio de sesión único para pestañas
description: Describe el inicio de sesión único (SSO)
ms.topic: how-to
keywords: API de inicio de sesión único de SSO AAD de autenticación de teams
ms.openlocfilehash: e5f79aaf62d195144dd9b34cfbce601c94478191
ms.sourcegitcommit: 23ed7edf145df10dcfba15c43978eae9e0d451a8
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 03/12/2021
ms.locfileid: "50753542"
---
# <a name="single-sign-on-sso-support-for-tabs"></a><span data-ttu-id="99bb1-104">Compatibilidad con inicio de sesión único (SSO) para pestañas</span><span class="sxs-lookup"><span data-stu-id="99bb1-104">Single sign-on (SSO) support for tabs</span></span>

<span data-ttu-id="99bb1-105">Los usuarios inician sesión en Microsoft Teams a través de sus cuentas de trabajo, escuela o Microsoft que son Office 365, Outlook, entre otras.</span><span class="sxs-lookup"><span data-stu-id="99bb1-105">Users sign in to Microsoft Teams through their work, school, or Microsoft accounts that is Office 365, Outlook, and so on.</span></span> <span data-ttu-id="99bb1-106">Puedes aprovechar esto al permitir que un inicio de sesión único autorice tu pestaña o módulo de tareas de Teams en clientes móviles o de escritorio.</span><span class="sxs-lookup"><span data-stu-id="99bb1-106">You can take advantage of this by allowing a single sign-on to authorize your Teams tab or task module on desktop or mobile clients.</span></span> <span data-ttu-id="99bb1-107">Si un usuario da su consentimiento para usar la aplicación, no tiene que volver a dar su consentimiento en otro dispositivo, ya que ha iniciado sesión automáticamente.</span><span class="sxs-lookup"><span data-stu-id="99bb1-107">If a user consents to use your app, they do not have to consent again on another device as they are signed in automatically.</span></span> <span data-ttu-id="99bb1-108">Además, el token de acceso está predefinido para mejorar el rendimiento y los tiempos de carga.</span><span class="sxs-lookup"><span data-stu-id="99bb1-108">In addition, your access token is prefetched to improve performance and load times.</span></span>

> [!NOTE]
> <span data-ttu-id="99bb1-109">**Versiones de cliente móvil de Teams que admiten SSO**</span><span class="sxs-lookup"><span data-stu-id="99bb1-109">**Teams mobile client versions supporting SSO**</span></span>  
>
> <span data-ttu-id="99bb1-110">✔Teams para Android (1416/1.0.0.2020073101 y versiones posteriores)</span><span class="sxs-lookup"><span data-stu-id="99bb1-110">✔Teams for Android (1416/1.0.0.2020073101 and later)</span></span>
>
> <span data-ttu-id="99bb1-111">✔Teams para iOS (_Versión_: 2.0.18 y versiones posteriores)</span><span class="sxs-lookup"><span data-stu-id="99bb1-111">✔Teams for iOS (_Version_: 2.0.18 and later)</span></span>  
>
> <span data-ttu-id="99bb1-112">Para disfrutar de la mejor experiencia con Teams, usa la versión más reciente de iOS y Android.</span><span class="sxs-lookup"><span data-stu-id="99bb1-112">For the best experience with Teams, use the latest version of iOS and Android.</span></span>

> [!NOTE]
> <span data-ttu-id="99bb1-113">**Inicio rápido**</span><span class="sxs-lookup"><span data-stu-id="99bb1-113">**Quickstart**</span></span>  
>
> <span data-ttu-id="99bb1-114">La ruta de acceso más sencilla para empezar con sso de pestaña es con el kit de herramientas de Teams para Visual Studio código.</span><span class="sxs-lookup"><span data-stu-id="99bb1-114">The simplest path to getting started with tab SSO is with the Teams toolkit for Visual Studio Code.</span></span> <span data-ttu-id="99bb1-115">Para obtener más información, vea [SSO with Teams toolkit and Visual Studio Code for tabs](../../../toolkit/visual-studio-code-tab-sso.md)</span><span class="sxs-lookup"><span data-stu-id="99bb1-115">For more information, see [SSO with Teams toolkit and Visual Studio Code for tabs](../../../toolkit/visual-studio-code-tab-sso.md)</span></span>

## <a name="how-sso-works-at-runtime"></a><span data-ttu-id="99bb1-116">Cómo funciona el SSO en tiempo de ejecución</span><span class="sxs-lookup"><span data-stu-id="99bb1-116">How SSO works at runtime</span></span>

<span data-ttu-id="99bb1-117">La siguiente imagen muestra cómo funciona el proceso de SSO:</span><span class="sxs-lookup"><span data-stu-id="99bb1-117">The following image shows how the SSO process works:</span></span>

<!-- markdownlint-disable MD033 -->
<img src="~/assets/images/tabs/tabs-sso-diagram.png" alt="Tab single sign-on SSO diagram" width="75%"/>

1. <span data-ttu-id="99bb1-118">En la pestaña, se realiza una llamada de JavaScript a `getAuthToken()` .</span><span class="sxs-lookup"><span data-stu-id="99bb1-118">In the tab, a JavaScript call is made to `getAuthToken()`.</span></span> <span data-ttu-id="99bb1-119">Esto indica a Teams que obtenga un token de autenticación para la aplicación de pestaña.</span><span class="sxs-lookup"><span data-stu-id="99bb1-119">This tells Teams to obtain an authentication token for the tab application.</span></span>
2. <span data-ttu-id="99bb1-120">Si es la primera vez que el usuario actual usa la aplicación de pestaña, hay un mensaje de solicitud para dar su consentimiento si se requiere consentimiento o para administrar la autenticación de paso a paso, como la autenticación en dos fases.</span><span class="sxs-lookup"><span data-stu-id="99bb1-120">If this is the first time the current user has used your tab application, there is a request prompt to consent if consent is required or to handle step-up authentication such as two-factor authentication.</span></span>
3. <span data-ttu-id="99bb1-121">Teams solicita el token de aplicación de tabulación desde el punto de conexión de Azure Active Directory (AAD) para el usuario actual.</span><span class="sxs-lookup"><span data-stu-id="99bb1-121">Teams requests the tab application token from the Azure Active Directory (AAD) endpoint for the current user.</span></span>
4. <span data-ttu-id="99bb1-122">AAD envía el token de aplicación de pestaña a la aplicación teams.</span><span class="sxs-lookup"><span data-stu-id="99bb1-122">AAD sends the tab application token to the Teams application.</span></span>
5. <span data-ttu-id="99bb1-123">Teams envía el token de aplicación de pestaña a la pestaña como parte del objeto de resultado devuelto por la `getAuthToken()` llamada.</span><span class="sxs-lookup"><span data-stu-id="99bb1-123">Teams sends the tab application token to the tab as part of the result object returned by the `getAuthToken()` call.</span></span>
6. <span data-ttu-id="99bb1-124">El token se analiza en la aplicación de pestaña mediante JavaScript, para extraer la información necesaria, como la dirección de correo electrónico del usuario.</span><span class="sxs-lookup"><span data-stu-id="99bb1-124">The token is parsed in the tab application using JavaScript, to extract required information, such as the user's email address.</span></span>

> [!NOTE]
> <span data-ttu-id="99bb1-125">El solo es válido para dar su consentimiento a un conjunto limitado de API de nivel de usuario que son correo `getAuthToken()` electrónico, perfil, offline_access y OpenId.</span><span class="sxs-lookup"><span data-stu-id="99bb1-125">The `getAuthToken()` is only valid for consenting to a limited set of user-level APIs that is email, profile, offline_access and OpenId.</span></span> <span data-ttu-id="99bb1-126">No se usa para otros ámbitos de Graph, como `User.Read` o `Mail.Read` .</span><span class="sxs-lookup"><span data-stu-id="99bb1-126">It is not used for further Graph scopes such as `User.Read` or `Mail.Read`.</span></span> <span data-ttu-id="99bb1-127">Para obtener soluciones alternativas sugeridas, [vea ámbitos de Graph adicionales](#apps-that-require-additional-graph-scopes).</span><span class="sxs-lookup"><span data-stu-id="99bb1-127">For suggested workarounds, see [additional Graph scopes](#apps-that-require-additional-graph-scopes).</span></span>

<span data-ttu-id="99bb1-128">La API de SSO también funciona en [módulos de tareas](../../../task-modules-and-cards/what-are-task-modules.md) que insertan contenido web.</span><span class="sxs-lookup"><span data-stu-id="99bb1-128">The SSO API also works in [task modules](../../../task-modules-and-cards/what-are-task-modules.md) that embed web content.</span></span>

## <a name="develop-an-sso-microsoft-teams-tab"></a><span data-ttu-id="99bb1-129">Desarrollar una pestaña sso de Microsoft Teams</span><span class="sxs-lookup"><span data-stu-id="99bb1-129">Develop an SSO Microsoft Teams tab</span></span>

<span data-ttu-id="99bb1-130">En esta sección se describen las tareas relacionadas con la creación de una pestaña de Teams que usa SSO.</span><span class="sxs-lookup"><span data-stu-id="99bb1-130">This section describes the tasks involved in creating a Teams tab that uses SSO.</span></span> <span data-ttu-id="99bb1-131">Estas tareas son independientes del lenguaje y del marco.</span><span class="sxs-lookup"><span data-stu-id="99bb1-131">These tasks are language- and framework-agnostic.</span></span>

### <a name="1-create-your-aad-application"></a><span data-ttu-id="99bb1-132">1. Crear la aplicación de AAD</span><span class="sxs-lookup"><span data-stu-id="99bb1-132">1. Create your AAD application</span></span>

<span data-ttu-id="99bb1-133">**Para registrar la aplicación en la información general [del portal de AAD](https://azure.microsoft.com/features/azure-portal/)**</span><span class="sxs-lookup"><span data-stu-id="99bb1-133">**To register your application in the [AAD portal](https://azure.microsoft.com/features/azure-portal/) overview**</span></span>

1. <span data-ttu-id="99bb1-134">Obtener el [identificador de aplicación de AAD](/azure/active-directory/develop/howto-create-service-principal-portal#get-values-for-signing-in).</span><span class="sxs-lookup"><span data-stu-id="99bb1-134">Get your [AAD Application ID](/azure/active-directory/develop/howto-create-service-principal-portal#get-values-for-signing-in).</span></span>
2. <span data-ttu-id="99bb1-135">Especifique los permisos que la aplicación necesita para el extremo de AAD y, opcionalmente, Graph.</span><span class="sxs-lookup"><span data-stu-id="99bb1-135">Specify the permissions that your application needs for the AAD endpoint and, optionally, Graph.</span></span>
3. <span data-ttu-id="99bb1-136">[Conceder permisos para](/azure/active-directory/develop/howto-create-service-principal-portal#configure-access-policies-on-resources) aplicaciones de escritorio, web y móviles de Teams.</span><span class="sxs-lookup"><span data-stu-id="99bb1-136">[Grant permissions](/azure/active-directory/develop/howto-create-service-principal-portal#configure-access-policies-on-resources) for Teams desktop, web, and mobile applications.</span></span>
4. <span data-ttu-id="99bb1-137">Para autorizar previamente Teams, seleccione el botón Agregar **un** ámbito y, en el panel que se abre, **escriba access_as_user** como nombre **de ámbito**.</span><span class="sxs-lookup"><span data-stu-id="99bb1-137">Pre-authorize Teams by selecting the **Add a scope** button and in the panel that opens, enter **access_as_user** as the **Scope name**.</span></span>

> [!NOTE]
> <span data-ttu-id="99bb1-138">Hay algunas restricciones importantes que debe saber:</span><span class="sxs-lookup"><span data-stu-id="99bb1-138">There are some important restrictions that you must know:</span></span>
>
> * <span data-ttu-id="99bb1-139">Solo se admiten permisos de api de Graph de nivel de usuario, es decir, correo electrónico, perfil, offline_access, OpenId.</span><span class="sxs-lookup"><span data-stu-id="99bb1-139">Only user-level Graph API permissions are supported that is, email, profile, offline_access, OpenId.</span></span> <span data-ttu-id="99bb1-140">Si debe tener acceso a otros ámbitos de Graph, como `User.Read` o , vea la solución alternativa `Mail.Read` [recomendada](#apps-that-require-additional-graph-scopes).</span><span class="sxs-lookup"><span data-stu-id="99bb1-140">If you must have access to other Graph scopes such as `User.Read` or `Mail.Read`, see [recommended workaround](#apps-that-require-additional-graph-scopes).</span></span>
> * <span data-ttu-id="99bb1-141">Es importante que el nombre de dominio de la aplicación sea el mismo que el nombre de dominio registrado para la aplicación de AAD.</span><span class="sxs-lookup"><span data-stu-id="99bb1-141">It is important that your application's domain name is the same as the domain name you have registered for your AAD application.</span></span>
> * <span data-ttu-id="99bb1-142">Actualmente, no se admiten varios dominios por aplicación.</span><span class="sxs-lookup"><span data-stu-id="99bb1-142">Currently multiple domains per app are not supported.</span></span>
> * <span data-ttu-id="99bb1-143">Las aplicaciones que usan `azurewebsites.net` el dominio no se admiten porque es demasiado común y pueden ser un riesgo de seguridad.</span><span class="sxs-lookup"><span data-stu-id="99bb1-143">Applications that use the `azurewebsites.net` domain are not supported as it is too common and can be a security risk.</span></span>

<span data-ttu-id="99bb1-144">**Para registrar la aplicación a través del portal de AAD**</span><span class="sxs-lookup"><span data-stu-id="99bb1-144">**To register your app through the AAD portal**</span></span>

1. <span data-ttu-id="99bb1-145">Registrar una nueva aplicación en el portal [de registros de aplicaciones de AAD.](https://go.microsoft.com/fwlink/?linkid=2083908)</span><span class="sxs-lookup"><span data-stu-id="99bb1-145">Register a new application in the [AAD App Registrations](https://go.microsoft.com/fwlink/?linkid=2083908) portal.</span></span>
2. <span data-ttu-id="99bb1-146">Seleccione **Nuevo registro**.</span><span class="sxs-lookup"><span data-stu-id="99bb1-146">Select **New Registration**.</span></span> <span data-ttu-id="99bb1-147">Aparece **la página** Registrar una aplicación.</span><span class="sxs-lookup"><span data-stu-id="99bb1-147">The **Register an application** page appears.</span></span>
3. <span data-ttu-id="99bb1-148">En la **página Registrar una aplicación,** escriba los siguientes valores:</span><span class="sxs-lookup"><span data-stu-id="99bb1-148">In the **Register an application** page, enter the following values:</span></span>
    1. <span data-ttu-id="99bb1-149">Escribe un **nombre** para la aplicación.</span><span class="sxs-lookup"><span data-stu-id="99bb1-149">Enter a **Name** for your app.</span></span>
    2. <span data-ttu-id="99bb1-150">Elija los **tipos de cuenta admitidos,** seleccione un único inquilino o tipo de cuenta multiempresa.</span><span class="sxs-lookup"><span data-stu-id="99bb1-150">Choose the **Supported account types**, select single tenant or multitenant account type.</span></span> <span data-ttu-id="99bb1-151">¹</span><span class="sxs-lookup"><span data-stu-id="99bb1-151">¹</span></span>
    * <span data-ttu-id="99bb1-152">Deje **URI de redireccionamiento** vacía.</span><span class="sxs-lookup"><span data-stu-id="99bb1-152">Leave **Redirect URI** empty.</span></span>
    3. <span data-ttu-id="99bb1-153">Elija **Registrar**.</span><span class="sxs-lookup"><span data-stu-id="99bb1-153">Choose **Register**.</span></span>
4. <span data-ttu-id="99bb1-154">En la página de información general, copie y guarde el **identificador de aplicación (cliente).**</span><span class="sxs-lookup"><span data-stu-id="99bb1-154">On the overview page, copy and save the **Application (client) ID**.</span></span> <span data-ttu-id="99bb1-155">Debe tenerla más adelante al actualizar el manifiesto de la aplicación de Teams.</span><span class="sxs-lookup"><span data-stu-id="99bb1-155">You must have it later when updating your Teams application manifest.</span></span>
5. <span data-ttu-id="99bb1-156">En **Administrar**, seleccione **Exponer una API**</span><span class="sxs-lookup"><span data-stu-id="99bb1-156">Under **Manage**, select **Expose an API**.</span></span>
6. <span data-ttu-id="99bb1-157">Seleccione el **vínculo Establecer** para generar el URI de id. de aplicación con el formato `api://{AppID}` de .</span><span class="sxs-lookup"><span data-stu-id="99bb1-157">Select the **Set** link to generate the Application ID URI in the form of `api://{AppID}`.</span></span> <span data-ttu-id="99bb1-158">Inserte el nombre de dominio completo con una barra diagonal "/" anexada al final, entre las barras diagonales dobles y el GUID.</span><span class="sxs-lookup"><span data-stu-id="99bb1-158">Insert your fully qualified domain name with a forward slash "/" appended to the end, between the double forward slashes and the GUID.</span></span> <span data-ttu-id="99bb1-159">El identificador completo debe tener el formato `api://fully-qualified-domain-name.com/{AppID}` de .</span><span class="sxs-lookup"><span data-stu-id="99bb1-159">The entire ID must have the form of `api://fully-qualified-domain-name.com/{AppID}`.</span></span> <span data-ttu-id="99bb1-160">² Por ejemplo, `api://subdomain.example.com/00000000-0000-0000-0000-000000000000` .</span><span class="sxs-lookup"><span data-stu-id="99bb1-160">² For example, `api://subdomain.example.com/00000000-0000-0000-0000-000000000000`.</span></span> <span data-ttu-id="99bb1-161">El nombre de dominio completo es el nombre de dominio legible desde el que se sirve la aplicación.</span><span class="sxs-lookup"><span data-stu-id="99bb1-161">The fully qualified domain name is the human readable domain name from which your app is served.</span></span> <span data-ttu-id="99bb1-162">Si usa un servicio de túnel como ngrok, debe actualizar este valor siempre que cambie su subdominio ngrok.</span><span class="sxs-lookup"><span data-stu-id="99bb1-162">If you are using a tunneling service such as ngrok, you must update this value whenever your ngrok subdomain changes.</span></span>
7. <span data-ttu-id="99bb1-163">Seleccione **Agregar un ámbito**.</span><span class="sxs-lookup"><span data-stu-id="99bb1-163">Select **Add a scope**.</span></span> <span data-ttu-id="99bb1-164">En el panel que se abre, **escriba access_as_user** como el nombre **de ámbito**.</span><span class="sxs-lookup"><span data-stu-id="99bb1-164">In the panel that opens, enter **access_as_user** as the **Scope name**.</span></span>
8. <span data-ttu-id="99bb1-165">En el **cuadro ¿Quién puede dar su consentimiento?,** escriba **Administradores y usuarios**.</span><span class="sxs-lookup"><span data-stu-id="99bb1-165">In the **Who can consent?** box, enter **Admins and users**.</span></span>
9. <span data-ttu-id="99bb1-166">Escriba los detalles en los cuadros para configurar los mensajes de consentimiento de usuario y administrador con los valores adecuados para el `access_as_user` ámbito:</span><span class="sxs-lookup"><span data-stu-id="99bb1-166">Enter the details in the boxes for configuring the admin and user consent prompts with values that are appropriate for the `access_as_user` scope:</span></span>
    * <span data-ttu-id="99bb1-167">**Título del consentimiento de administrador:** Teams puede tener acceso al perfil del usuario.</span><span class="sxs-lookup"><span data-stu-id="99bb1-167">**Admin consent title:** Teams can access the user’s profile.</span></span>
    * <span data-ttu-id="99bb1-168">**Descripción del consentimiento de administrador:** Teams puede llamar a las API web de la aplicación como el usuario actual.</span><span class="sxs-lookup"><span data-stu-id="99bb1-168">**Admin consent description**: Teams can call the app’s web APIs as the current user.</span></span>
    * <span data-ttu-id="99bb1-169">**Título de consentimiento de** usuario: Teams puede tener acceso al perfil de usuario y realizar solicitudes en nombre del usuario.</span><span class="sxs-lookup"><span data-stu-id="99bb1-169">**User consent title**: Teams can access the user profile and make requests on the user's behalf.</span></span>
    * <span data-ttu-id="99bb1-170">**Descripción del consentimiento del usuario:** Teams puede llamar a las API de esta aplicación con los mismos derechos que el usuario.</span><span class="sxs-lookup"><span data-stu-id="99bb1-170">**User consent description:** Teams can call this app’s APIs with the same rights as the user.</span></span>
10. <span data-ttu-id="99bb1-171">Asegúrese de que **Estado** se establece en **Habilitado**.</span><span class="sxs-lookup"><span data-stu-id="99bb1-171">Ensure that **State** is set to **Enabled**.</span></span>
11. <span data-ttu-id="99bb1-172">Seleccione **Agregar ámbito** para guardar los detalles.</span><span class="sxs-lookup"><span data-stu-id="99bb1-172">Select **Add scope** to save the details.</span></span> <span data-ttu-id="99bb1-173">La parte de dominio del **nombre de** ámbito que se muestra debajo del campo de texto debe coincidir automáticamente con el URI de **id.** de aplicación establecido en el paso anterior, con `/access_as_user` anexado al final `api://subdomain.example.com/00000000-0000-0000-0000-000000000000/access_as_user` .</span><span class="sxs-lookup"><span data-stu-id="99bb1-173">The domain part of the **Scope name** displayed below the text field must automatically match the **Application ID** URI set in the previous step, with `/access_as_user` appended to the end `api://subdomain.example.com/00000000-0000-0000-0000-000000000000/access_as_user`.</span></span>
12. <span data-ttu-id="99bb1-174">En la **sección Aplicaciones cliente autorizadas,** identifique las aplicaciones que desea autorizar para la aplicación web de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="99bb1-174">In the **Authorized client applications** section, identify the applications that you want to authorize for your app’s web application.</span></span> <span data-ttu-id="99bb1-175">Seleccione **Agregar una aplicación cliente**.</span><span class="sxs-lookup"><span data-stu-id="99bb1-175">Select **Add a client application**.</span></span> <span data-ttu-id="99bb1-176">Escriba cada uno de los siguientes IDs de cliente y seleccione el ámbito autorizado que creó en el paso anterior:</span><span class="sxs-lookup"><span data-stu-id="99bb1-176">Enter each of the following client IDs and select the authorized scope you created in the previous step:</span></span>
    * <span data-ttu-id="99bb1-177">`1fec8e78-bce4-4aaf-ab1b-5451cc387264` para la aplicación móvil o de escritorio de Teams.</span><span class="sxs-lookup"><span data-stu-id="99bb1-177">`1fec8e78-bce4-4aaf-ab1b-5451cc387264` for Teams mobile or desktop application.</span></span>
    * <span data-ttu-id="99bb1-178">`5e3ce6c0-2b1f-4285-8d4b-75ee78787346` para la aplicación web de Teams.</span><span class="sxs-lookup"><span data-stu-id="99bb1-178">`5e3ce6c0-2b1f-4285-8d4b-75ee78787346` for Teams web application.</span></span>
13. <span data-ttu-id="99bb1-179">Vaya a **Permisos de API**.</span><span class="sxs-lookup"><span data-stu-id="99bb1-179">Navigate to **API Permissions**.</span></span> <span data-ttu-id="99bb1-180">Seleccione **Agregar permisos delegados** de Microsoft Graph y, a continuación,  >    >  agregue los siguientes permisos de la API de Graph:</span><span class="sxs-lookup"><span data-stu-id="99bb1-180">Select **Add a permission** > **Microsoft Graph** > **Delegated permissions**, then add the following permissions from Graph API:</span></span>
    * <span data-ttu-id="99bb1-181">User.Read habilitado de forma predeterminada</span><span class="sxs-lookup"><span data-stu-id="99bb1-181">User.Read enabled by default</span></span>
    * <span data-ttu-id="99bb1-182">email</span><span class="sxs-lookup"><span data-stu-id="99bb1-182">email</span></span>
    * <span data-ttu-id="99bb1-183">offline_access</span><span class="sxs-lookup"><span data-stu-id="99bb1-183">offline_access</span></span>
    * <span data-ttu-id="99bb1-184">OpenId</span><span class="sxs-lookup"><span data-stu-id="99bb1-184">OpenId</span></span>
    * <span data-ttu-id="99bb1-185">perfil</span><span class="sxs-lookup"><span data-stu-id="99bb1-185">profile</span></span>

14. <span data-ttu-id="99bb1-186">Vaya a **Autenticación**.</span><span class="sxs-lookup"><span data-stu-id="99bb1-186">Navigate to **Authentication**.</span></span>

    <span data-ttu-id="99bb1-187">Si no se ha concedido el consentimiento de administrador de TI a una aplicación, los usuarios tendrán que dar su consentimiento la primera vez que usen una aplicación.</span><span class="sxs-lookup"><span data-stu-id="99bb1-187">If an app has not been granted IT admin consent, users have to provide consent the first time they use an app.</span></span>

    <span data-ttu-id="99bb1-188">Para escribir un URI de redireccionamiento:</span><span class="sxs-lookup"><span data-stu-id="99bb1-188">To enter a redirect URI:</span></span>
    * <span data-ttu-id="99bb1-189">Seleccione **Agregar una plataforma**.</span><span class="sxs-lookup"><span data-stu-id="99bb1-189">Select **Add a platform**.</span></span>
    * <span data-ttu-id="99bb1-190">Seleccione **web**.</span><span class="sxs-lookup"><span data-stu-id="99bb1-190">Select **web**.</span></span>
    * <span data-ttu-id="99bb1-191">Escribe el **URI de redireccionamiento** de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="99bb1-191">Enter the **redirect URI** for your app.</span></span> <span data-ttu-id="99bb1-192">Esta es la página donde un flujo de concesión implícito correcto redirige al usuario.</span><span class="sxs-lookup"><span data-stu-id="99bb1-192">This is the page where a successful implicit grant flow redirects the user.</span></span> <span data-ttu-id="99bb1-193">Este es el mismo nombre de dominio completo que escribió en el paso 5 seguido de la ruta de api a la que se envía una respuesta de autenticación.</span><span class="sxs-lookup"><span data-stu-id="99bb1-193">This is the same fully qualified domain name that you entered in step 5 followed by the API route where an authentication response is sent.</span></span> <span data-ttu-id="99bb1-194">Si sigue cualquiera de los ejemplos de Teams, se trata de `https://subdomain.example.com/auth-end` .</span><span class="sxs-lookup"><span data-stu-id="99bb1-194">If you are following any of the Teams samples, this is `https://subdomain.example.com/auth-end`.</span></span>

    <span data-ttu-id="99bb1-195">Habilite la concesión implícita activando los siguientes cuadros: ✔ token de identificador ✔ token de acceso</span><span class="sxs-lookup"><span data-stu-id="99bb1-195">Enable implicit grant by checking the following boxes: ✔ ID Token ✔ Access Token</span></span>

<span data-ttu-id="99bb1-196">¡Enhorabuena!</span><span class="sxs-lookup"><span data-stu-id="99bb1-196">Congratulations!</span></span> <span data-ttu-id="99bb1-197">Has completado los requisitos previos de registro de la aplicación para continuar con la pestaña APLICACIÓN SSO.</span><span class="sxs-lookup"><span data-stu-id="99bb1-197">You have completed the app registration prerequisites to proceed with your tab SSO app.</span></span>

> [!NOTE]
>
> * <span data-ttu-id="99bb1-198">¹ Si la aplicación de AAD está registrada en el mismo inquilino en el que realizas una solicitud de autenticación en Teams, no se puede pedir al usuario su consentimiento y se le concede un token de acceso de inmediato.</span><span class="sxs-lookup"><span data-stu-id="99bb1-198">¹ If your AAD app is registered in the same tenant where you are making an authentication request in Teams, the user cannot be asked to consent and is granted an access token right away.</span></span> <span data-ttu-id="99bb1-199">Los usuarios solo consienten estos permisos si la aplicación AAD está registrada en un inquilino diferente.</span><span class="sxs-lookup"><span data-stu-id="99bb1-199">Users only consent to these permissions if the AAD app is registered in a different tenant.</span></span>
> * <span data-ttu-id="99bb1-200">² Si el dominio personalizado no se agrega a AAD, se produce un error que indica que el nombre de host no debe basarse en un dominio ya propiedad.</span><span class="sxs-lookup"><span data-stu-id="99bb1-200">² If the custom domain is not added to AAD, you get an error stating that the host name must not be based on an already owned domain.</span></span> <span data-ttu-id="99bb1-201">Para agregar un dominio personalizado a AAD y registrarlo, siga el procedimiento agregar un nombre de dominio [personalizado al procedimiento de AAD](/azure/active-directory/fundamentals/add-custom-domain) y, a continuación, repita el paso 5.</span><span class="sxs-lookup"><span data-stu-id="99bb1-201">To add custom domain to AAD and register it, follow the [add a custom domain name to AAD](/azure/active-directory/fundamentals/add-custom-domain) procedure, and then repeat step 5.</span></span> <span data-ttu-id="99bb1-202">También puede obtener este error si no ha iniciado sesión con credenciales de administrador en el arrendamiento de Office 365.</span><span class="sxs-lookup"><span data-stu-id="99bb1-202">You can also get this error if you are not signed in with Admin credentials in the Office 365 tenancy.</span></span>
> * <span data-ttu-id="99bb1-203">Si no recibe el nombre principal de usuario (UPN)) en el token de acceso devuelto, puede agregarlo como una notificación opcional [en](https://docs.microsoft.com/azure/active-directory/develop/active-directory-optional-claims) AAD.</span><span class="sxs-lookup"><span data-stu-id="99bb1-203">If you are not receiving the user principal name (UPN)) in the returned access token, you can add it as an [optional claim](https://docs.microsoft.com/azure/active-directory/develop/active-directory-optional-claims) in AAD.</span></span>

### <a name="2-update-your-teams-application-manifest"></a><span data-ttu-id="99bb1-204">2. Actualizar el manifiesto de la aplicación de Teams</span><span class="sxs-lookup"><span data-stu-id="99bb1-204">2. Update your Teams application manifest</span></span>

<span data-ttu-id="99bb1-205">Use el siguiente código para agregar nuevas propiedades al manifiesto de Teams:</span><span class="sxs-lookup"><span data-stu-id="99bb1-205">Use the following code to add new properties to your Teams manifest:</span></span>

```json
"webApplicationInfo": {
  "id": "00000000-0000-0000-0000-000000000000",
  "resource": "api://subdomain.example.com/00000000-0000-0000-0000-000000000000"
}
```

* <span data-ttu-id="99bb1-206">**WebApplicationInfo** es el elemento principal de los siguientes elementos:</span><span class="sxs-lookup"><span data-stu-id="99bb1-206">**WebApplicationInfo** is the parent of the following elements:</span></span>

> [!div class="checklist"]
> * <span data-ttu-id="99bb1-207">**id:** el identificador de cliente de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="99bb1-207">**id** - The client ID of the application.</span></span> <span data-ttu-id="99bb1-208">Este es el identificador de aplicación que obtuvo como parte del registro de la aplicación con Azure AD.</span><span class="sxs-lookup"><span data-stu-id="99bb1-208">This is the application ID that you obtained as part of registering the application with Azure AD.</span></span>
>* <span data-ttu-id="99bb1-209">**resource:** el dominio y el subdominio de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="99bb1-209">**resource** - The domain and subdomain of your application.</span></span> <span data-ttu-id="99bb1-210">Este es el mismo URI (incluido el `api://` protocolo) que registró al crear `scope` el paso 6.</span><span class="sxs-lookup"><span data-stu-id="99bb1-210">This is the same URI (including the `api://` protocol) that you registered when creating your `scope` in step 6.</span></span> <span data-ttu-id="99bb1-211">No debe incluir la ruta `access_as_user` de acceso en el recurso.</span><span class="sxs-lookup"><span data-stu-id="99bb1-211">You must not include the `access_as_user` path in your resource.</span></span> <span data-ttu-id="99bb1-212">La parte de dominio de este URI debe coincidir con el dominio, incluidos los subdominios, que se usan en las direcciones URL del manifiesto de la aplicación de Teams.</span><span class="sxs-lookup"><span data-stu-id="99bb1-212">The domain part of this URI must match the domain, including any subdomains, used in the URLs of your Teams application manifest.</span></span>

> [!NOTE]
>
>* <span data-ttu-id="99bb1-213">El recurso de una aplicación de AAD suele ser la raíz de la dirección URL del sitio y el appID (por ejemplo, `api://subdomain.example.com/00000000-0000-0000-0000-000000000000` ).</span><span class="sxs-lookup"><span data-stu-id="99bb1-213">The resource for an AAD app is usually the root of its site URL and the appID (e.g. `api://subdomain.example.com/00000000-0000-0000-0000-000000000000`).</span></span> <span data-ttu-id="99bb1-214">Este valor también se usa para garantizar que la solicitud viene del mismo dominio.</span><span class="sxs-lookup"><span data-stu-id="99bb1-214">This value is also used to ensure your request is coming from the same domain.</span></span> <span data-ttu-id="99bb1-215">Asegúrese de que `contentURL` la pestaña usa los mismos dominios que la propiedad de recurso.</span><span class="sxs-lookup"><span data-stu-id="99bb1-215">Ensure that the `contentURL` for your tab uses the same domains as your resource property.</span></span>
>* <span data-ttu-id="99bb1-216">Debe usar la versión 1.5 del manifiesto o posterior para implementar el `webApplicationInfo` campo.</span><span class="sxs-lookup"><span data-stu-id="99bb1-216">You must use manifest version 1.5 or higher to implement the `webApplicationInfo` field.</span></span>

### <a name="3-get-an-authentication-token-from-your-client-side-code"></a><span data-ttu-id="99bb1-217">3. Obtener un token de autenticación del código del lado cliente</span><span class="sxs-lookup"><span data-stu-id="99bb1-217">3. Get an authentication token from your client-side code</span></span>

<span data-ttu-id="99bb1-218">Use la siguiente API de autenticación:</span><span class="sxs-lookup"><span data-stu-id="99bb1-218">Use the following authentication API:</span></span>

```javascript
var authTokenRequest = {
  successCallback: function(result) { console.log("Success: " + result); },
  failureCallback: function(error) { console.log("Failure: " + error); }
};
microsoftTeams.authentication.getAuthToken(authTokenRequest);
```

<span data-ttu-id="99bb1-219">Al llamar: y se requiere un consentimiento de usuario adicional para los permisos de nivel de usuario, se muestra un cuadro de diálogo al usuario `getAuthToken` para conceder un consentimiento adicional.</span><span class="sxs-lookup"><span data-stu-id="99bb1-219">When you call `getAuthToken` - and additional user consent is required for user-level permissions, a dialog is shown to the user to grant additional consent.</span></span>

<span data-ttu-id="99bb1-220">Después de recibir el token de acceso en la devolución de llamada correcta, puede descodificar el token de acceso para ver las notificaciones asociadas con ese token.</span><span class="sxs-lookup"><span data-stu-id="99bb1-220">After you receive the access token in the success callback, you can decode the access token to view the claims associated with that token.</span></span> <span data-ttu-id="99bb1-221">Opcionalmente, puedes copiar y pegar manualmente el token de acceso en una herramienta, como jwt.ms [inspeccionar](https://jwt.ms/) su contenido.</span><span class="sxs-lookup"><span data-stu-id="99bb1-221">Optionally, you can manually copy and paste the access token into a tool, such as [jwt.ms](https://jwt.ms/) to inspect its contents.</span></span> <span data-ttu-id="99bb1-222">Si no recibe el UPN en el token de acceso devuelto, puede agregarlo como una notificación [opcional](https://docs.microsoft.com/azure/active-directory/develop/active-directory-optional-claims) en AAD.</span><span class="sxs-lookup"><span data-stu-id="99bb1-222">If you are not receiving the UPN in the returned access token, you can add it as an [optional claim](https://docs.microsoft.com/azure/active-directory/develop/active-directory-optional-claims) in AAD.</span></span>

<p>
    <img src="~/assets/images/tabs/tabs-sso-prompt.png" alt="Tab single sign-on SSO dialog prompt" width="75%"/>
</p>

## <a name="code-sample"></a><span data-ttu-id="99bb1-223">Ejemplo de código</span><span class="sxs-lookup"><span data-stu-id="99bb1-223">Code sample</span></span>

|<span data-ttu-id="99bb1-224">**Nombre de ejemplo**</span><span class="sxs-lookup"><span data-stu-id="99bb1-224">**Sample name**</span></span>|<span data-ttu-id="99bb1-225">**Descripción**</span><span class="sxs-lookup"><span data-stu-id="99bb1-225">**Description**</span></span>|<span data-ttu-id="99bb1-226">**C#**</span><span class="sxs-lookup"><span data-stu-id="99bb1-226">**C#**</span></span>|<span data-ttu-id="99bb1-227">**Node.js**</span><span class="sxs-lookup"><span data-stu-id="99bb1-227">**Node.js**</span></span>|
|---------------|---------------|------|--------------|
| <span data-ttu-id="99bb1-228">Tab SSO</span><span class="sxs-lookup"><span data-stu-id="99bb1-228">Tab SSO</span></span> |<span data-ttu-id="99bb1-229">Aplicación de ejemplo de Microsoft Teams para pestañas SSO de Azure AD</span><span class="sxs-lookup"><span data-stu-id="99bb1-229">Microsoft Teams sample app for tabs Azure AD SSO</span></span>| [<span data-ttu-id="99bb1-230">View</span><span class="sxs-lookup"><span data-stu-id="99bb1-230">View</span></span>](https://github.com/OfficeDev/Microsoft-Teams-Samples/tree/main/samples/tab-sso/csharp)|<span data-ttu-id="99bb1-231">[Ver](https://github.com/OfficeDev/Microsoft-Teams-Samples/blob/main/samples/tab-sso/nodejs),</span><span class="sxs-lookup"><span data-stu-id="99bb1-231">[View](https://github.com/OfficeDev/Microsoft-Teams-Samples/blob/main/samples/tab-sso/nodejs),</span></span> </br>[<span data-ttu-id="99bb1-232">Kit de herramientas de Teams</span><span class="sxs-lookup"><span data-stu-id="99bb1-232">Teams Toolkit</span></span>](../../../toolkit/visual-studio-code-tab-sso.md)|

## <a name="known-limitations"></a><span data-ttu-id="99bb1-233">Limitaciones conocidas</span><span class="sxs-lookup"><span data-stu-id="99bb1-233">Known limitations</span></span>

### <a name="apps-that-require-additional-graph-scopes"></a><span data-ttu-id="99bb1-234">Aplicaciones que requieren ámbitos de Graph adicionales</span><span class="sxs-lookup"><span data-stu-id="99bb1-234">Apps that require additional Graph scopes</span></span>

<span data-ttu-id="99bb1-235">Nuestra implementación actual para SSO solo concede consentimiento para permisos de nivel de usuario que son correo electrónico, perfil, offline_access, OpenId y no para otras API como User.Read o Mail.Read.</span><span class="sxs-lookup"><span data-stu-id="99bb1-235">Our current implementation for SSO only grants consent for user-level permissions that is email, profile, offline_access, OpenId and not for other APIs such as User.Read or Mail.Read.</span></span> <span data-ttu-id="99bb1-236">Si la aplicación necesita más ámbitos de Graph, en la siguiente sección se proporcionan algunas soluciones alternativas de habilitación.</span><span class="sxs-lookup"><span data-stu-id="99bb1-236">If your app needs further Graph scopes, the next section provides some enabling workarounds.</span></span>

#### <a name="tenant-admin-consent"></a><span data-ttu-id="99bb1-237">Consentimiento de administrador de inquilinos</span><span class="sxs-lookup"><span data-stu-id="99bb1-237">Tenant Admin Consent</span></span>

<span data-ttu-id="99bb1-238">El enfoque más sencillo es conseguir que un administrador de inquilinos preconsiente en nombre de la organización.</span><span class="sxs-lookup"><span data-stu-id="99bb1-238">The simplest approach is to get a tenant admin to pre-consent on behalf of the organization.</span></span> <span data-ttu-id="99bb1-239">Esto significa que los usuarios no tienen que dar su consentimiento a estos ámbitos y, a continuación, puede intercambiar el lado del servidor de tokens con el flujo en nombre [de](/azure/active-directory/develop/v1-oauth2-on-behalf-of-flow)AAD.</span><span class="sxs-lookup"><span data-stu-id="99bb1-239">This means users do not have to consent to these scopes and you can then be free to exchange the token server side using AAD’s [on-behalf-of flow](/azure/active-directory/develop/v1-oauth2-on-behalf-of-flow).</span></span> <span data-ttu-id="99bb1-240">Esta solución alternativa es aceptable para aplicaciones internas de línea de negocio, pero no es suficiente para desarrolladores de terceros que no pueden confiar en la aprobación del administrador de inquilinos.</span><span class="sxs-lookup"><span data-stu-id="99bb1-240">This workaround is acceptable for internal line-of-business applications but is not enough for third-party developers who are not able to rely on tenant admin approval.</span></span>

<span data-ttu-id="99bb1-241">Una forma sencilla de dar su consentimiento en nombre de una organización como administrador de inquilinos es hacer referencia a `https://login.microsoftonline.com/common/adminconsent?client_id=<AAD_App_ID>` .</span><span class="sxs-lookup"><span data-stu-id="99bb1-241">A simple way of consenting on behalf of an organization as a tenant admin is to refer to `https://login.microsoftonline.com/common/adminconsent?client_id=<AAD_App_ID>`.</span></span>

#### <a name="ask-for-additional-consent-using-the-auth-api"></a><span data-ttu-id="99bb1-242">Solicitar consentimiento adicional mediante la API de autenticación</span><span class="sxs-lookup"><span data-stu-id="99bb1-242">Ask for additional consent using the Auth API</span></span>

<span data-ttu-id="99bb1-243">Otro enfoque para obtener ámbitos de Graph adicionales es presentar un cuadro de diálogo de consentimiento mediante nuestro enfoque de autenticación de [Azure AD](~/tabs/how-to/authentication/auth-tab-aad.md#navigate-to-the-authorization-page-from-your-popup-page) basado en web existente, que implica crear un cuadro de diálogo de consentimiento de Azure AD.</span><span class="sxs-lookup"><span data-stu-id="99bb1-243">Another approach for getting additional Graph scopes is to present a consent dialog using our existing [web-based Azure AD authentication approach](~/tabs/how-to/authentication/auth-tab-aad.md#navigate-to-the-authorization-page-from-your-popup-page) which involves popping up an Azure AD consent dialog box.</span></span> 

<span data-ttu-id="99bb1-244">**Para solicitar consentimiento adicional mediante la API de autenticación**</span><span class="sxs-lookup"><span data-stu-id="99bb1-244">**To ask for additional consent using the Auth API**</span></span>

1. <span data-ttu-id="99bb1-245">El token recuperado mediante debe intercambiarse en el lado servidor mediante AAD en nombre del flujo para obtener acceso a esas `getAuthToken()` API de Graph adicionales. [](/azure/active-directory/develop/v2-oauth2-on-behalf-of-flow)</span><span class="sxs-lookup"><span data-stu-id="99bb1-245">The token retrieved using `getAuthToken()` needs to be exchanged server-side using AAD [on-behalf-of flow](/azure/active-directory/develop/v2-oauth2-on-behalf-of-flow) to get access to those additional Graph APIs.</span></span> <span data-ttu-id="99bb1-246">Asegúrese de usar el extremo de Graph de v2 para este intercambio.</span><span class="sxs-lookup"><span data-stu-id="99bb1-246">Ensure you use the v2 Graph endpoint for this exchange.</span></span>
2. <span data-ttu-id="99bb1-247">Si se produce un error en el intercambio, AAD devuelve una excepción de concesión no válida.</span><span class="sxs-lookup"><span data-stu-id="99bb1-247">If the exchange fails, AAD returns an invalid grant exception.</span></span> <span data-ttu-id="99bb1-248">Normalmente hay uno de los dos mensajes de error o `invalid_grant` `interaction_required` .</span><span class="sxs-lookup"><span data-stu-id="99bb1-248">There are usually one of two error messages, `invalid_grant` or `interaction_required`.</span></span>
3. <span data-ttu-id="99bb1-249">Cuando se produce un error en el intercambio, debe solicitar el consentimiento adicional.</span><span class="sxs-lookup"><span data-stu-id="99bb1-249">When the exchange fails, you must ask for additional consent.</span></span> <span data-ttu-id="99bb1-250">Muestra una interfaz de usuario (UI) que pide al usuario que conceda un consentimiento adicional.</span><span class="sxs-lookup"><span data-stu-id="99bb1-250">Show some user interface (UI) asking the user to grant additional consent.</span></span> <span data-ttu-id="99bb1-251">Esta interfaz de usuario debe incluir un botón que active un cuadro de diálogo de consentimiento de AAD mediante nuestra [API de autenticación de AAD](~/concepts/authentication/auth-silent-aad.md).</span><span class="sxs-lookup"><span data-stu-id="99bb1-251">This UI must include a button that triggers an AAD consent dialog box using our [AAD authentication API](~/concepts/authentication/auth-silent-aad.md).</span></span>
4. <span data-ttu-id="99bb1-252">Al solicitar el consentimiento adicional de AAD, debe incluir en el parámetro `prompt=consent` [query-string-parameter](~/tabs/how-to/authentication/auth-silent-aad.md#get-the-user-context) a AAD, de lo contrario, AAD no pide los ámbitos adicionales.</span><span class="sxs-lookup"><span data-stu-id="99bb1-252">When asking for additional consent from AAD, you must include `prompt=consent` in your [query-string-parameter](~/tabs/how-to/authentication/auth-silent-aad.md#get-the-user-context) to AAD, otherwise AAD does not ask for the additional scopes.</span></span>
    * <span data-ttu-id="99bb1-253">En lugar de `?scope={scopes}`</span><span class="sxs-lookup"><span data-stu-id="99bb1-253">Instead of `?scope={scopes}`</span></span>
    * <span data-ttu-id="99bb1-254">Use esta opción `?prompt=consent&scope={scopes}`</span><span class="sxs-lookup"><span data-stu-id="99bb1-254">Use this `?prompt=consent&scope={scopes}`</span></span>
    * <span data-ttu-id="99bb1-255">Asegúrese de que incluye todos los ámbitos que está solicitando al usuario, por `{scopes}` ejemplo, Mail.Read o User.Read.</span><span class="sxs-lookup"><span data-stu-id="99bb1-255">Ensure that `{scopes}` includes all the scopes you are prompting the user for, for example, Mail.Read or User.Read.</span></span>
5. <span data-ttu-id="99bb1-256">Una vez que el usuario haya concedido permisos adicionales, vuelva a intentar el flujo en nombre del usuario para obtener acceso a estas API adicionales.</span><span class="sxs-lookup"><span data-stu-id="99bb1-256">Once the user has granted additional permission, retry the on-behalf-of-flow to get access to these additional APIs.</span></span>

### <a name="non-aad-authentication"></a><span data-ttu-id="99bb1-257">Autenticación que no es AAD</span><span class="sxs-lookup"><span data-stu-id="99bb1-257">Non-AAD authentication</span></span>

<span data-ttu-id="99bb1-258">La solución de autenticación descrita anteriormente solo funciona para aplicaciones y servicios que admiten AAD como proveedor de identidades.</span><span class="sxs-lookup"><span data-stu-id="99bb1-258">The above-described authentication solution only works for apps and services that support AAD as an identity provider.</span></span> <span data-ttu-id="99bb1-259">Las aplicaciones que quieran autenticarse con servicios no basados en AAD deben seguir usando el flujo de autenticación web basado [en elementos emergentes](~/concepts/authentication.md).</span><span class="sxs-lookup"><span data-stu-id="99bb1-259">Apps that want to authenticate using non-AAD based services must continue using the pop-up-based [web authentication flow](~/concepts/authentication.md).</span></span>

> [!NOTE]
> <span data-ttu-id="99bb1-260">Sso es compatible con aplicaciones de propiedad del cliente dentro de los inquilinos de AAD B2C.</span><span class="sxs-lookup"><span data-stu-id="99bb1-260">SSO is supported for customer owned apps within the AAD B2C tenants.</span></span>
