---
title: Inicio de sesión único
description: Describe el inicio de sesión único (SSO)
keywords: autenticación de SSO de Microsoft Teams AAD
ms.openlocfilehash: 8f9d94346aad7c096e4310f80b6cda73856afc8c
ms.sourcegitcommit: 61c93b22490526b1de87c0b14a3c7eb6e046caf6
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 05/31/2020
ms.locfileid: "44455516"
---
# <a name="single-sign-on"></a><span data-ttu-id="3e4b9-104">Inicio de sesión único</span><span class="sxs-lookup"><span data-stu-id="3e4b9-104">Single Sign-On</span></span>

> [!NOTE]
> <span data-ttu-id="3e4b9-105">La API de "Inicio de sesión único" solo se admite actualmente en _Developer Preview_ .</span><span class="sxs-lookup"><span data-stu-id="3e4b9-105">The "single sign-on" API is currently supported in _Developer Preview_ only.</span></span>

<span data-ttu-id="3e4b9-106">Los usuarios inician sesión en Microsoft Teams con su cuenta profesional o educativa (Office 365) y puede aprovecharlas usando el inicio de sesión único (SSO) para autorizar al usuario a su pestaña de Microsoft Teams. Esto significa que si un usuario consiente usar la aplicación en el escritorio, no tendrá que volver a dar su consentimiento en dispositivos móviles y se iniciará sesión automáticamente.</span><span class="sxs-lookup"><span data-stu-id="3e4b9-106">Users sign-in to Microsoft Teams using their work or school (Office 365) account and you can take advantage of this by using single sign-on (SSO) to authorize the user to your Microsoft Teams tab. That means if a user consents to use your app on desktop, they won’t have to consent again on mobile and will be automatically logged in.</span></span> 

## <a name="how-sso-works-at-runtime"></a><span data-ttu-id="3e4b9-107">Cómo funciona el SSO en tiempo de ejecución</span><span class="sxs-lookup"><span data-stu-id="3e4b9-107">How SSO works at runtime</span></span>

<span data-ttu-id="3e4b9-108">El siguiente diagrama muestra cómo funciona el proceso de SSO:</span><span class="sxs-lookup"><span data-stu-id="3e4b9-108">The following diagram shows how the SSO process works:</span></span>

<img src="~/assets/images/tabs/tabs-sso-diagram.png" alt="Tab single sign-on SSO diagram" width="75%"/>

1. <span data-ttu-id="3e4b9-109">En la pestaña, JavaScript llama a getAuthToken ().</span><span class="sxs-lookup"><span data-stu-id="3e4b9-109">In the tab, JavaScript calls getAuthToken().</span></span> <span data-ttu-id="3e4b9-110">Esto indica a la aplicación de Microsoft teams que debe obtener un token de autenticación para la aplicación de pestañas.</span><span class="sxs-lookup"><span data-stu-id="3e4b9-110">This tells the Teams application to obtain an authentication token to the tab application.</span></span>
2. <span data-ttu-id="3e4b9-111">Si esta es la primera vez que el usuario actual ha usado la aplicación de pestañas, se le pedirá que lo solicite (si se requiere consentimiento) o que se le pida que controle la autenticación de paso a paso (por ejemplo, la autenticación en dos fases).</span><span class="sxs-lookup"><span data-stu-id="3e4b9-111">If this is the first time the current user has used your tab application, they will be prompted to consent (if consent is required) or asked to handle step-up authentication (such as two-factor authentication).</span></span>
3. <span data-ttu-id="3e4b9-112">La aplicación Microsoft Teams solicita el token de la aplicación Tab desde el punto de conexión de Azure AD v 1.0 para el usuario actual.</span><span class="sxs-lookup"><span data-stu-id="3e4b9-112">The Microsoft Teams application requests the tab application token from the Azure AD v1.0 endpoint for the current user.</span></span>
4. <span data-ttu-id="3e4b9-113">Azure AD envía el token de aplicación de la pestaña a la aplicación Teams.</span><span class="sxs-lookup"><span data-stu-id="3e4b9-113">Azure AD sends the tab application token to the Teams application.</span></span>
5. <span data-ttu-id="3e4b9-114">La aplicación Microsoft Teams envía el token de aplicación de la pestaña a la ficha como parte del objeto de resultado devuelto por la llamada de getAuthToken ().</span><span class="sxs-lookup"><span data-stu-id="3e4b9-114">The Microsoft Teams application sends the tab application token to the tab as part of the result object returned by the getAuthToken() call.</span></span>
6. <span data-ttu-id="3e4b9-115">JavaScript en la aplicación de pestañas puede analizar el token y extraer la información que necesita, como la dirección de correo electrónico del usuario.</span><span class="sxs-lookup"><span data-stu-id="3e4b9-115">JavaScript in the tab application can parse the token and extract the information it needs, such as the user's email address.</span></span>
    * <span data-ttu-id="3e4b9-116">Nota: este token solo es válido para Consent? a un conjunto limitado de API de nivel de usuario (por ejemplo: email, Profile, etc) y no para otros ámbitos de gráficos (como mail. Read).</span><span class="sxs-lookup"><span data-stu-id="3e4b9-116">Note: this token is only valid for consenting to a limited set of user-level APIs (ex: email, profile, etc)  and not for further Graph scopes (such as Mail.Read).</span></span> <span data-ttu-id="3e4b9-117">Consulte nuestra sección al final de este documento para obtener soluciones alternativas si necesita ámbitos de gráficos adicionales.</span><span class="sxs-lookup"><span data-stu-id="3e4b9-117">See our section at the end of this document for suggested workarounds if you require additional Graph scopes.</span></span>

## <a name="develop-an-sso-microsoft-teams-tab"></a><span data-ttu-id="3e4b9-118">Desarrollar una pestaña de Microsoft Teams de SSO</span><span class="sxs-lookup"><span data-stu-id="3e4b9-118">Develop an SSO Microsoft Teams tab</span></span>

<span data-ttu-id="3e4b9-119">En esta sección se describen las tareas necesarias para crear una pestaña de Microsoft teams que usen SSO.</span><span class="sxs-lookup"><span data-stu-id="3e4b9-119">This section describes the tasks involved in creating an Microsoft Teams tab that use SSO.</span></span> <span data-ttu-id="3e4b9-120">Estas tareas se describen aquí de forma independiente del lenguaje y el marco.</span><span class="sxs-lookup"><span data-stu-id="3e4b9-120">These tasks are described here in a language- and framework-agnostic way.</span></span>

### <a name="1-create-your-aad-application-in-azure"></a><span data-ttu-id="3e4b9-121">1. crear una aplicación de AAD en Azure</span><span class="sxs-lookup"><span data-stu-id="3e4b9-121">1. Create your AAD application in Azure</span></span>

<span data-ttu-id="3e4b9-122">Registre su aplicación en el portal de registro para el punto de conexión de Azure AD v 1.0.</span><span class="sxs-lookup"><span data-stu-id="3e4b9-122">Register you application at the registration portal for the Azure AD v1.0 endpoint.</span></span> <span data-ttu-id="3e4b9-123">Este es un proceso de 5 a 10 minutos que incluye las siguientes tareas:</span><span class="sxs-lookup"><span data-stu-id="3e4b9-123">This is a 5–10 minute process that includes the following tasks:</span></span>

* <span data-ttu-id="3e4b9-124">Obtener el identificador de la aplicación de AAD</span><span class="sxs-lookup"><span data-stu-id="3e4b9-124">Getting your AAD application ID</span></span>
* <span data-ttu-id="3e4b9-125">Especifique los permisos que necesita la aplicación para el punto de conexión de AAD (y opcionalmente para Microsoft Graph).</span><span class="sxs-lookup"><span data-stu-id="3e4b9-125">Specify the permissions that your application needs for the AAD endpoint (and optionally to Microsoft Graph).</span></span> 
* <span data-ttu-id="3e4b9-126">Conceder confianza a la aplicación de escritorio, Web y aplicación móvil de Microsoft Teams a la aplicación</span><span class="sxs-lookup"><span data-stu-id="3e4b9-126">Grant the Microsoft Teams desktop, web and mobile application to trust to your application</span></span>
* <span data-ttu-id="3e4b9-127">Autorizar previamente la aplicación Microsoft Teams a la aplicación con el nombre de ámbito predeterminado de `access_as_user` .</span><span class="sxs-lookup"><span data-stu-id="3e4b9-127">Preauthorize the Microsoft Teams application to your app with the default scope name of `access_as_user`.</span></span>

> [!NOTE]
> <span data-ttu-id="3e4b9-128">Hay algunas restricciones importantes que debe tener en cuenta:</span><span class="sxs-lookup"><span data-stu-id="3e4b9-128">There are some important restrictions you should be aware of:</span></span>
>
> * <span data-ttu-id="3e4b9-129">Solo se admiten los permisos de la API Graph de nivel de usuario, por ejemplo, email, Profile, offline_access, OpenID.</span><span class="sxs-lookup"><span data-stu-id="3e4b9-129">We only support user-level Graph API permissions, e.g., email, profile, offline_access, openid.</span></span> <span data-ttu-id="3e4b9-130">Si necesita acceso a otros ámbitos de Graph, lea nuestra solución recomendada al final de esta documentación.</span><span class="sxs-lookup"><span data-stu-id="3e4b9-130">If you need access to other Graph scopes, read our recommended workaround at the end of this documentation.</span></span>
> * <span data-ttu-id="3e4b9-131">Es importante que el nombre de dominio de la aplicación se registre con la aplicación de Azure AD.</span><span class="sxs-lookup"><span data-stu-id="3e4b9-131">It's important that your application's domain name be registered with your Azure AD application.</span></span> <span data-ttu-id="3e4b9-132">Debe ser el mismo nombre de dominio en el que se ejecuta la aplicación cuando se solicita un token de autenticación en Microsoft Teams y también cuando se especifica la propiedad Resource en el manifiesto de Microsoft Teams (más detalles en la sección siguiente).</span><span class="sxs-lookup"><span data-stu-id="3e4b9-132">This must be the same domain name that your application runs on when requesting an authentication token in Teams and also when specifying the resource property in your Teams manifest (more details in the next section).</span></span>
> * <span data-ttu-id="3e4b9-133">Actualmente no se admiten varios dominios por aplicación</span><span class="sxs-lookup"><span data-stu-id="3e4b9-133">We do not currently support multiple domains per app</span></span>
> * <span data-ttu-id="3e4b9-134">Tampoco se admiten aplicaciones que usan el `azurewebsites.net` dominio, ya que este dominio es demasiado común y puede ser un riesgo para la seguridad.</span><span class="sxs-lookup"><span data-stu-id="3e4b9-134">We also do not support applications that use the `azurewebsites.net` domain since this domain is too common and may be a security risk</span></span>

#### <a name="steps"></a><span data-ttu-id="3e4b9-135">Pasos</span><span class="sxs-lookup"><span data-stu-id="3e4b9-135">Steps</span></span>

1. <span data-ttu-id="3e4b9-136">Registrar una nueva aplicación en el portal de [registro de aplicaciones de Azure Active Directory:](https://go.microsoft.com/fwlink/?linkid=2083908)</span><span class="sxs-lookup"><span data-stu-id="3e4b9-136">Register a new application in the [Azure Active Directory – App Registration](https://go.microsoft.com/fwlink/?linkid=2083908) portal</span></span>
2. <span data-ttu-id="3e4b9-137">Seleccione "nuevo registro".</span><span class="sxs-lookup"><span data-stu-id="3e4b9-137">Select “New Registration”.</span></span> <span data-ttu-id="3e4b9-138">En la página registrar una aplicación, establezca los valores de la siguiente manera:</span><span class="sxs-lookup"><span data-stu-id="3e4b9-138">On the register an application page, set the values as follows:</span></span>
    * <span data-ttu-id="3e4b9-139">Establecer el **nombre** del nombre de la aplicación</span><span class="sxs-lookup"><span data-stu-id="3e4b9-139">Set **name** to your app name</span></span>
    * <span data-ttu-id="3e4b9-140">Establecer **tipos de cuenta admitidos** **en cuentas de cualquier directorio de la organización y cuentas personales de Microsoft**</span><span class="sxs-lookup"><span data-stu-id="3e4b9-140">Set **supported account types** to **Accounts in any organizational directory and personal Microsoft accounts**</span></span>
    * <span data-ttu-id="3e4b9-141">Dejar el **URI de redireccionamiento** vacío</span><span class="sxs-lookup"><span data-stu-id="3e4b9-141">Leave **Redirect URI** empty</span></span>
    * <span data-ttu-id="3e4b9-142">Elegir **registro**</span><span class="sxs-lookup"><span data-stu-id="3e4b9-142">Choose **Register**</span></span>
3. <span data-ttu-id="3e4b9-143">En la página información general, copie y guarde el identificador de la **aplicación (cliente)**.</span><span class="sxs-lookup"><span data-stu-id="3e4b9-143">On the overview page, copy and save the **Application (client) ID**.</span></span> <span data-ttu-id="3e4b9-144">Lo necesitará más adelante al actualizar el manifiesto de aplicación de Teams.</span><span class="sxs-lookup"><span data-stu-id="3e4b9-144">You’ll need it later when updating your Teams application manifest.</span></span>
4. <span data-ttu-id="3e4b9-145">Seleccione **Exponer una API** en **Administrar**.</span><span class="sxs-lookup"><span data-stu-id="3e4b9-145">Select **Expose an API** under **Manage**.</span></span> <span data-ttu-id="3e4b9-146">Seleccione el vínculo **establecer** para generar el URI del identificador de aplicación con el formato de `api://{AppID}` .</span><span class="sxs-lookup"><span data-stu-id="3e4b9-146">Select the **Set** link to generate the Application ID URI in the form of `api://{AppID}`.</span></span> <span data-ttu-id="3e4b9-147">Inserte el nombre de dominio completo (con una barra diagonal "/" anexada al final) entre las dos barras diagonales y el GUID.</span><span class="sxs-lookup"><span data-stu-id="3e4b9-147">Insert your fully qualified domain name (with a forward slash "/" appended to the end) between the double forward slashes and the GUID.</span></span> <span data-ttu-id="3e4b9-148">El identificador completo debe tener el siguiente formato:`api://fully-qualified-domain-name.com/{AppID}`</span><span class="sxs-lookup"><span data-stu-id="3e4b9-148">The entire ID should have the form of: `api://fully-qualified-domain-name.com/{AppID}`</span></span>
    * <span data-ttu-id="3e4b9-149">por ejemplo: `api://subdomain.example.com:6789/c6c1f32b-5e55-4997-881a-753cc1d563b7` .</span><span class="sxs-lookup"><span data-stu-id="3e4b9-149">ex: `api://subdomain.example.com:6789/c6c1f32b-5e55-4997-881a-753cc1d563b7`.</span></span>

> [!NOTE]
> <span data-ttu-id="3e4b9-150">Si recibe un error que indica que el dominio ya tiene propietario, pero es usted su propietario, siga el procedimiento de [Inicio rápido: agregar un nombre de dominio personalizado a Azure Active Directory](/azure/active-directory/fundamentals/add-custom-domain) para registrarlo y repita este paso.</span><span class="sxs-lookup"><span data-stu-id="3e4b9-150">If you get an error saying that the domain is already owned but you own it, follow the procedure at [Quickstart: Add a custom domain name to Azure Active Directory](/azure/active-directory/fundamentals/add-custom-domain) to register it, and then repeat this step.</span></span> <span data-ttu-id="3e4b9-151">(Este error también puede producirse si no ha iniciado sesión con las credenciales de un administrador en el inquilino de Office 365).</span><span class="sxs-lookup"><span data-stu-id="3e4b9-151">(This error can also occur if you are not signed in with credentials of an admin in the Office 365 tenancy).</span></span>

5. <span data-ttu-id="3e4b9-152">Seleccione el botón **Agregar un ámbito**</span><span class="sxs-lookup"><span data-stu-id="3e4b9-152">Select the **Add a scope** button.</span></span> <span data-ttu-id="3e4b9-153">En el panel que se abre, escriba `access_as_user` como el **Nombre de ámbito**.</span><span class="sxs-lookup"><span data-stu-id="3e4b9-153">In the panel that opens, enter `access_as_user` as the **Scope name**.</span></span>
6. <span data-ttu-id="3e4b9-154">¿Quién puede dar su consentimiento? para administradores y usuarios</span><span class="sxs-lookup"><span data-stu-id="3e4b9-154">Set Who can consent? to Admins and users</span></span>
7. <span data-ttu-id="3e4b9-155">Rellene los campos para configurar las solicitudes de consentimiento del usuario y el administrador con valores que sean apropiados para el `access_as_user` ámbito.</span><span class="sxs-lookup"><span data-stu-id="3e4b9-155">Fill in the fields for configuring the admin and user consent prompts with values that are appropriate for the `access_as_user` scope.</span></span> <span data-ttu-id="3e4b9-156">Sugerencias:</span><span class="sxs-lookup"><span data-stu-id="3e4b9-156">Suggestions:</span></span>
    * <span data-ttu-id="3e4b9-157">**Título de consentimiento de administración:** Teams puede tener acceso al perfil del usuario</span><span class="sxs-lookup"><span data-stu-id="3e4b9-157">**Admin consent title:** Teams can access the user’s profile</span></span>
    * <span data-ttu-id="3e4b9-158">**Descripción del consentimiento del administrador**: permite a los equipos llamar a las API Web de la aplicación como el usuario actual.</span><span class="sxs-lookup"><span data-stu-id="3e4b9-158">**Admin consent description**: Allows Teams to call the app’s web APIs as the current user.</span></span>
    * <span data-ttu-id="3e4b9-159">**Título de consentimiento del usuario**: Microsoft Teams puede obtener acceso a su perfil de usuario y realizar solicitudes en su nombre</span><span class="sxs-lookup"><span data-stu-id="3e4b9-159">**User consent title**: Teams can access your user profile and make requests on your behalf</span></span>
    * <span data-ttu-id="3e4b9-160">**Descripción del consentimiento del usuario:** Permitir que Microsoft Teams llame a las API de la aplicación con los mismos derechos que usted</span><span class="sxs-lookup"><span data-stu-id="3e4b9-160">**User consent description:** Enable Teams to call this app’s APIs with the same rights that you have</span></span>
8. <span data-ttu-id="3e4b9-161">Asegurarse de que el **Estado** está establecido en **habilitado**</span><span class="sxs-lookup"><span data-stu-id="3e4b9-161">Ensure that **State** is set to **Enabled**</span></span>
9. <span data-ttu-id="3e4b9-162">Seleccionar **Agregar ámbito**</span><span class="sxs-lookup"><span data-stu-id="3e4b9-162">Select **Add scope**</span></span>
    * <span data-ttu-id="3e4b9-163">Nota: la parte de dominio del **nombre de ámbito** que se muestra justo debajo del campo de texto debe coincidir automáticamente con el URI de **identificador de aplicación** establecido en el paso anterior, con `/access_as_user` anexado al final; por ejemplo:</span><span class="sxs-lookup"><span data-stu-id="3e4b9-163">Note: The domain part of the **Scope name** displayed just below the text field should automatically match the **Application ID** URI set in the previous step, with `/access_as_user` appended to the end; for example:</span></span> 
        * `api://subdomain.example.com:6789/c6c1f32b-5e55-4997-881a-753cc1d563b7/access_as_user`
10. <span data-ttu-id="3e4b9-164">En la sección **aplicaciones cliente autorizadas** , se identifican las aplicaciones que se desea autorizar en la aplicación Web de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="3e4b9-164">In the **Authorized client applications** section, you identify the applications that you want to authorize to your app’s web application.</span></span> <span data-ttu-id="3e4b9-165">Debe especificarse cada uno de los siguientes identificadores:</span><span class="sxs-lookup"><span data-stu-id="3e4b9-165">Each of the following IDs needs to be entered:</span></span>
    * <span data-ttu-id="3e4b9-166">`1fec8e78-bce4-4aaf-ab1b-5451cc387264`(Aplicación para equipos móviles o de escritorio)</span><span class="sxs-lookup"><span data-stu-id="3e4b9-166">`1fec8e78-bce4-4aaf-ab1b-5451cc387264` (Teams mobile/desktop application)</span></span>
    * <span data-ttu-id="3e4b9-167">`5e3ce6c0-2b1f-4285-8d4b-75ee78787346`(Aplicación Web de Teams)</span><span class="sxs-lookup"><span data-stu-id="3e4b9-167">`5e3ce6c0-2b1f-4285-8d4b-75ee78787346` (Teams web application)</span></span>
11. <span data-ttu-id="3e4b9-168">Navegue a **permisos**de la API y asegúrese de agregar los siguientes permisos:</span><span class="sxs-lookup"><span data-stu-id="3e4b9-168">Navigate to **API Permissions**, and make sure to add the follow permissions:</span></span>
    * <span data-ttu-id="3e4b9-169">User. Read (habilitado de forma predeterminada)</span><span class="sxs-lookup"><span data-stu-id="3e4b9-169">User.Read (enabled by default)</span></span>
    * <span data-ttu-id="3e4b9-170">email</span><span class="sxs-lookup"><span data-stu-id="3e4b9-170">email</span></span>
    * <span data-ttu-id="3e4b9-171">offline_access</span><span class="sxs-lookup"><span data-stu-id="3e4b9-171">offline_access</span></span>
    * <span data-ttu-id="3e4b9-172">OpenID</span><span class="sxs-lookup"><span data-stu-id="3e4b9-172">openid</span></span>
    * <span data-ttu-id="3e4b9-173">perfil</span><span class="sxs-lookup"><span data-stu-id="3e4b9-173">profile</span></span>

### <a name="2-update-your-microsoft-teams-application-manifest"></a><span data-ttu-id="3e4b9-174">2. actualizar el manifiesto de aplicación de Microsoft Teams</span><span class="sxs-lookup"><span data-stu-id="3e4b9-174">2. Update your Microsoft Teams application manifest</span></span>

<span data-ttu-id="3e4b9-175">Agregue nuevas propiedades al manifiesto de Microsoft Teams:</span><span class="sxs-lookup"><span data-stu-id="3e4b9-175">Add new properties to your Microsoft Teams manifest:</span></span>

* <span data-ttu-id="3e4b9-176">**WebApplicationInfo**: elemento primario de los siguientes elementos.</span><span class="sxs-lookup"><span data-stu-id="3e4b9-176">**WebApplicationInfo** - The parent of the following elements.</span></span>
* <span data-ttu-id="3e4b9-177">**ID** -el identificador de cliente de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="3e4b9-177">**Id** - The client ID of the application.</span></span> <span data-ttu-id="3e4b9-178">Se trata de un identificador de aplicación que se obtiene como parte del registro de la aplicación con el punto de conexión de Azure AD 1,0.</span><span class="sxs-lookup"><span data-stu-id="3e4b9-178">This is an application ID that you obtain as part of registering the application with Azure AD 1.0 endpoint.</span></span>
* <span data-ttu-id="3e4b9-179">**Resource** : el dominio y el subdominio de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="3e4b9-179">**Resource** - The domain and subdomain of your application.</span></span> <span data-ttu-id="3e4b9-180">Se trata del mismo URI (incluido el `api://` Protocolo) que usó al registrar la aplicación en AAD.</span><span class="sxs-lookup"><span data-stu-id="3e4b9-180">This is the same URI (including the `api://` protocol) that you used when registering the app in AAD.</span></span> <span data-ttu-id="3e4b9-181">La parte de dominio de este URI debe coincidir con el dominio, incluidos los subdominios, que se usan en las direcciones URL en la sección del manifiesto de aplicación de Teams.</span><span class="sxs-lookup"><span data-stu-id="3e4b9-181">The domain part of this URI should match the domain, including any subdomains, used in the URLs in the section of your Teams application manifest.</span></span>

```json
"webApplicationInfo": {
  "id": "<application_GUID here>",
  "resource": "<web_API resource here>"
}
```

<span data-ttu-id="3e4b9-182">Notas:</span><span class="sxs-lookup"><span data-stu-id="3e4b9-182">Notes:</span></span>

* <span data-ttu-id="3e4b9-183">El recurso de una aplicación de AAD normalmente será simplemente la raíz de la dirección URL del sitio y el appID (por ejemplo, `api://subdomain.example.com/6789/c6c1f32b-5e55-4997-881a-753cc1d563b7` ).</span><span class="sxs-lookup"><span data-stu-id="3e4b9-183">The resource for an AAD app will usually just be the root of its site URL and the appID (e.g. `api://subdomain.example.com/6789/c6c1f32b-5e55-4997-881a-753cc1d563b7`).</span></span> <span data-ttu-id="3e4b9-184">Este valor también se usa para garantizar que la solicitud procede del mismo dominio.</span><span class="sxs-lookup"><span data-stu-id="3e4b9-184">We also use this value to ensure your request is coming from the same domain.</span></span> <span data-ttu-id="3e4b9-185">Por ello, asegúrese de que su `contentURL` para su pestaña use los mismos dominios que la propiedad de recurso.</span><span class="sxs-lookup"><span data-stu-id="3e4b9-185">Therefor make sure that your `contentURL` for your tab uses the same domains as your resource property.</span></span>
* <span data-ttu-id="3e4b9-186">Debe usar la versión del manifiesto 1,5 o superior para usar estos campos.</span><span class="sxs-lookup"><span data-stu-id="3e4b9-186">You need to be using manifest version 1.5 or higher for these fields to be used.</span></span>
* <span data-ttu-id="3e4b9-187">Los ámbitos no se admiten en el manifiesto y, en su lugar, deben especificarse en la sección permisos de la API de Azure portal.</span><span class="sxs-lookup"><span data-stu-id="3e4b9-187">Scopes aren’t supported in the manifest and instead should be specified in the API Permissions section in the Azure portal</span></span>

### <a name="3-get-an-authentication-token-from-your-client-side-code"></a><span data-ttu-id="3e4b9-188">3. obtener un token de autenticación del código del lado cliente</span><span class="sxs-lookup"><span data-stu-id="3e4b9-188">3. Get an authentication token from your client-side code</span></span>

<span data-ttu-id="3e4b9-189">Esto es lo que la API de autenticación tiene como:</span><span class="sxs-lookup"><span data-stu-id="3e4b9-189">Here's what the authentication API looks like:</span></span>

```javascript
var authTokenRequest = {
  successCallback: function(result) { console.log("Success: " + result); },
  failureCallback: function(error) { console.log("Failure: " + error); },
};
microsoftTeams.authentication.getAuthToken(authTokenRequest);
```

<span data-ttu-id="3e4b9-190">Cuando se `getAuthToken` requiere el consentimiento del usuario adicional (para los permisos de nivel de usuario), se muestra un cuadro de diálogo al usuario para alentarlo a conceder consentimiento adicional.</span><span class="sxs-lookup"><span data-stu-id="3e4b9-190">When you call `getAuthToken` - and additional user consent is required (for user-level permissions) - we will show a dialog to the user encouraging them to grant additional consent.</span></span> 

<img src="~/assets/images/tabs/tabs-sso-prompt.png" alt="Tab single sign-on SSO dialog prompt" width="75%"/>

## <a name="demo-code"></a><span data-ttu-id="3e4b9-191">Código de demostración</span><span class="sxs-lookup"><span data-stu-id="3e4b9-191">Demo code</span></span>

<span data-ttu-id="3e4b9-192">Por ahora, puede visitar nuestra [tarea](https://github.com/ydogandjiev/taskmeow) de aplicación de prueba Meow y usar el manifiesto de SSO y desproteger el `teams.auth.service.js` `sso.auth.service.js` archivo y para ver cómo se controla el flujo de trabajo de autenticación.</span><span class="sxs-lookup"><span data-stu-id="3e4b9-192">For now you can visit our test application [Task Meow](https://github.com/ydogandjiev/taskmeow) and use the SSO manifest and checkout the `teams.auth.service.js` and `sso.auth.service.js` file to see how we handle the authentication workflow.</span></span>

## <a name="known-limitations"></a><span data-ttu-id="3e4b9-193">Limitaciones conocidas</span><span class="sxs-lookup"><span data-stu-id="3e4b9-193">Known Limitations</span></span>

### <a name="apps-that-require-additional-graph-scopes"></a><span data-ttu-id="3e4b9-194">Aplicaciones que requieren ámbitos de gráficos adicionales</span><span class="sxs-lookup"><span data-stu-id="3e4b9-194">Apps that require additional Graph Scopes</span></span>

<span data-ttu-id="3e4b9-195">Nuestra implementación actual de SSO solo concede el consentimiento para los permisos de nivel de usuario (email, Profile, offline_access, OpenID), pero no para otras API (como mail. Read).</span><span class="sxs-lookup"><span data-stu-id="3e4b9-195">Our current implementation for SSO only grants consent for user-level permissions (email, profile, offline_access, openid) but not for other APIs (such as Mail.Read).</span></span> <span data-ttu-id="3e4b9-196">Si la aplicación necesita más ámbitos de gráficos, hay algunas soluciones para habilitarlo.</span><span class="sxs-lookup"><span data-stu-id="3e4b9-196">If your app needs further Graph scopes, there are some workarounds to enable this.</span></span>

#### <a name="tenant-admin-consent"></a><span data-ttu-id="3e4b9-197">Consentimiento del administrador de inquilinos</span><span class="sxs-lookup"><span data-stu-id="3e4b9-197">Tenant Admin Consent</span></span>

<span data-ttu-id="3e4b9-198">El método más sencillo sería obtener un administrador de inquilinos para el consentimiento previo en nombre de la organización.</span><span class="sxs-lookup"><span data-stu-id="3e4b9-198">The simplest approach would be to get a tenant admin to pre-consent on behalf of the organization.</span></span> <span data-ttu-id="3e4b9-199">Esto significa que los usuarios no tendrán que dar su consentimiento a estos ámbitos y, a continuación, puede tener libertad para intercambiar el lado servidor de tokens mediante el [flujo en nombre de](/azure/active-directory/develop/v1-oauth2-on-behalf-of-flow)AAD.</span><span class="sxs-lookup"><span data-stu-id="3e4b9-199">This means users won’t have to consent to these scopes and you can then be free to exchange the token server side using AAD’s [on-behalf-of flow](/azure/active-directory/develop/v1-oauth2-on-behalf-of-flow).</span></span> <span data-ttu-id="3e4b9-200">Esta solución es aceptable para las aplicaciones de línea de negocio internas, pero es posible que no sea suficiente para los ISV que no puedan confiar en la aprobación del administrador de inquilinos.</span><span class="sxs-lookup"><span data-stu-id="3e4b9-200">This workaround is acceptable for internal line-of-business applications but may not be enough for ISVs who may not be able to rely on tenant admin approval.</span></span>

<span data-ttu-id="3e4b9-201">Una forma sencilla de conformar en nombre de una organización (como administrador de inquilinos) es visitar:</span><span class="sxs-lookup"><span data-stu-id="3e4b9-201">A simple way of consenting on behalf of an organization (as a tenant admin) is to visit:</span></span>

* `https://login.microsoftonline.com/common/adminconsent?client_id=<AAD_App_ID>`

#### <a name="asking-for-additional-consent-using-the-auth-api"></a><span data-ttu-id="3e4b9-202">Pedir consentimiento adicional usando la API de autenticación</span><span class="sxs-lookup"><span data-stu-id="3e4b9-202">Asking for additional consent using the Auth API</span></span>

<span data-ttu-id="3e4b9-203">Otro enfoque para obtener ámbitos de gráficos adicionales sería presentar un cuadro de diálogo de consentimiento mediante nuestro [enfoque de autenticación de AAD basado en Web](~/tabs/how-to/authentication/auth-tab-aad.md#navigate-to-the-authorization-page-from-your-popup-page) existente que implica mostrar un cuadro de diálogo de consentimiento de AAD.</span><span class="sxs-lookup"><span data-stu-id="3e4b9-203">Another approach for getting additional Graph scopes would be to present a consent dialog using our existing [web-based AAD authentication approach](~/tabs/how-to/authentication/auth-tab-aad.md#navigate-to-the-authorization-page-from-your-popup-page) which involves popping up an AAD consent dialog.</span></span> <span data-ttu-id="3e4b9-204">Hay adiciones notables:</span><span class="sxs-lookup"><span data-stu-id="3e4b9-204">There are some notable additions:</span></span>

1. <span data-ttu-id="3e4b9-205">El token recuperado con getAuthToken tendría que intercambiar el servidor usando el [flujo en nombre de](/azure/active-directory/develop/v1-oauth2-on-behalf-of-flow) AADs para obtener acceso a las API de Graph adicionales.</span><span class="sxs-lookup"><span data-stu-id="3e4b9-205">The token retrieved using getAuthToken would need to be exchanged server side using AADs [on-behalf-of flow](/azure/active-directory/develop/v1-oauth2-on-behalf-of-flow) to get access to those additional Graph APIs.</span></span>
    * <span data-ttu-id="3e4b9-206">Asegúrese de usar el punto de conexión de Graph v2 para este intercambio</span><span class="sxs-lookup"><span data-stu-id="3e4b9-206">Be sure to use the v2 Graph endpoint for this exchange</span></span>
2. <span data-ttu-id="3e4b9-207">Si se produce un error en el intercambio, AAD devolverá una excepción de concesión no válida.</span><span class="sxs-lookup"><span data-stu-id="3e4b9-207">If the exchange fails, AAD will return an invalid grant exception.</span></span> <span data-ttu-id="3e4b9-208">Suele haber un mensaje de error de dos: `ConsentRequired` o`InteractionRequired`</span><span class="sxs-lookup"><span data-stu-id="3e4b9-208">There are usually one of two error messages: `ConsentRequired` or `InteractionRequired`</span></span>
3. <span data-ttu-id="3e4b9-209">Cuando se produzca un error en el intercambio, deberá pedir consentimiento adicional.</span><span class="sxs-lookup"><span data-stu-id="3e4b9-209">When the exchange fails, then you need to ask for additional consent.</span></span> <span data-ttu-id="3e4b9-210">Le recomendamos que muestre una interfaz de usuario que pida al usuario que conceda el consentimiento adicional.</span><span class="sxs-lookup"><span data-stu-id="3e4b9-210">We recommend showing some UI asking the user to grant additional consent.</span></span> <span data-ttu-id="3e4b9-211">Esta interfaz de usuario debe incluir un botón que desencadene un cuadro de diálogo de consentimiento de AAD mediante nuestra [API de autenticación de AAD](~/concepts/authentication/auth-silent-aad.md).</span><span class="sxs-lookup"><span data-stu-id="3e4b9-211">This UI should include a button that triggers an AAD consent dialog using our [AAD authentication API](~/concepts/authentication/auth-silent-aad.md).</span></span>
4. <span data-ttu-id="3e4b9-212">Al solicitar consentimiento adicional de AAD, debe incluir `prompt=consent` en el [parámetro de cadena de consulta](~/tabs/how-to/authentication/auth-silent-aad.md#get-the-user-context) a AAD, de lo contrario, AAD no pedirá los ámbitos adicionales.</span><span class="sxs-lookup"><span data-stu-id="3e4b9-212">When asking for additional consent from AAD, you need to include `prompt=consent` in your [query-string-parameter](~/tabs/how-to/authentication/auth-silent-aad.md#get-the-user-context) to AAD otherwise AAD will not ask for the additional scopes.</span></span>
    * <span data-ttu-id="3e4b9-213">En lugar de:`?scope={scopes}`</span><span class="sxs-lookup"><span data-stu-id="3e4b9-213">Instead of: `?scope={scopes}`</span></span>
    * <span data-ttu-id="3e4b9-214">Use lo siguiente:`?prompt=consent&scope={scopes}`</span><span class="sxs-lookup"><span data-stu-id="3e4b9-214">Use this: `?prompt=consent&scope={scopes}`</span></span>
    * <span data-ttu-id="3e4b9-215">Asegúrese de que `{scopes}` incluye todos los ámbitos que solicita al usuario (por ejemplo: mail. Read o User. Read).</span><span class="sxs-lookup"><span data-stu-id="3e4b9-215">Be sure that `{scopes}` includes all the scopes you are prompting the user for (ex: Mail.Read or User.Read).</span></span>
5. <span data-ttu-id="3e4b9-216">Una vez que el usuario haya concedido permiso adicional, vuelva a intentar el en nombre de flujo para obtener acceso a estas API adicionales.</span><span class="sxs-lookup"><span data-stu-id="3e4b9-216">Once the user has granted additional permission, retry the on-behalf-of-flow to get access to these additional APIs.</span></span>

### <a name="non-aad-authentication"></a><span data-ttu-id="3e4b9-217">Autenticación que no es AAD</span><span class="sxs-lookup"><span data-stu-id="3e4b9-217">Non-AAD Authentication</span></span>

<span data-ttu-id="3e4b9-218">La solución de autenticación descrita anteriormente solo funciona con aplicaciones y servicios que admitan Azure AD como proveedor de identidades.</span><span class="sxs-lookup"><span data-stu-id="3e4b9-218">The above-described authentication solution only works for apps and services that support Azure AD as an identity provider.</span></span> <span data-ttu-id="3e4b9-219">Las aplicaciones que quieran autenticarse con servicios no basados en AAD deben seguir usando el [flujo de autenticación Web](~/concepts/authentication.md)basada en Popup.</span><span class="sxs-lookup"><span data-stu-id="3e4b9-219">Apps that want to authenticate using non-AAD based services need to continue using the popup-based [web authentication flow](~/concepts/authentication.md).</span></span>
