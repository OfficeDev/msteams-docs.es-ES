---
title: Compatibilidad con inicio de sesión único para pestañas
description: Describe el inicio de sesión único (SSO)
ms.topic: how-to
keywords: API de inicio de sesión único de SSO AAD de autenticación de teams
ms.openlocfilehash: 9392c3c01a7fa6dffc673cd01f57d0eab1720efe
ms.sourcegitcommit: 976e870cc925f61b76c3830ec04ba6e4bdfde32f
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/27/2021
ms.locfileid: "50014127"
---
# <a name="single-sign-on-sso-support-for-tabs"></a><span data-ttu-id="ccca4-104">Compatibilidad con inicio de sesión único (SSO) para pestañas</span><span class="sxs-lookup"><span data-stu-id="ccca4-104">Single sign-on (SSO) support for tabs</span></span>

<span data-ttu-id="ccca4-105">Los usuarios inician sesión en Microsoft Teams a través de sus cuentas profesionales, educativas o de Microsoft (Office 365, Outlook, etc.).</span><span class="sxs-lookup"><span data-stu-id="ccca4-105">Users sign in to Microsoft Teams via their work, school, or Microsoft accounts (Office 365, Outlook, etc).</span></span> <span data-ttu-id="ccca4-106">Puede aprovechar esto si permite que un inicio de sesión único autorice la pestaña (o módulo de tareas) de Microsoft Teams en clientes móviles o de escritorio.</span><span class="sxs-lookup"><span data-stu-id="ccca4-106">You can take advantage of this by allowing a single sign-on to authorize your Microsoft Teams tab (or task module) on desktop or mobile clients.</span></span> <span data-ttu-id="ccca4-107">Por lo tanto, si un usuario da su consentimiento para usar la aplicación, no tendrá que volver a dar su consentimiento en otro dispositivo, sino que se iniciará sesión automáticamente.</span><span class="sxs-lookup"><span data-stu-id="ccca4-107">Thus, if a user consents to use your app, they won’t have to consent again on another device — they will be signed in automatically.</span></span> <span data-ttu-id="ccca4-108">Además, se realiza una captura previa del token de acceso para mejorar el rendimiento y los tiempos de carga.</span><span class="sxs-lookup"><span data-stu-id="ccca4-108">In addition, we prefetch your access token to improve performance and load times.</span></span>

>[!NOTE]
> <span data-ttu-id="ccca4-109">**Versiones de cliente móvil de Teams compatibles con SSO**</span><span class="sxs-lookup"><span data-stu-id="ccca4-109">**Teams mobile client versions supporting SSO**</span></span>  
>
> <span data-ttu-id="ccca4-110">✔Teams para Android (1416/1.0.0.2020073101 y versiones posteriores)</span><span class="sxs-lookup"><span data-stu-id="ccca4-110">✔Teams for Android (1416/1.0.0.2020073101 and later)</span></span>
>
> <span data-ttu-id="ccca4-111">✔Teams para iOS (_Versión_: 2.0.18 y posteriores)</span><span class="sxs-lookup"><span data-stu-id="ccca4-111">✔Teams for iOS (_Version_: 2.0.18 and later)</span></span>  
>
> <span data-ttu-id="ccca4-112">Para obtener la mejor experiencia con Teams, use la versión más reciente de iOS y Android.</span><span class="sxs-lookup"><span data-stu-id="ccca4-112">For the best experience with Teams, please use the latest version of iOS and Android.</span></span>

>[!NOTE]
> <span data-ttu-id="ccca4-113">**Inicio rápido**</span><span class="sxs-lookup"><span data-stu-id="ccca4-113">**Quickstart**</span></span>  
>
> <span data-ttu-id="ccca4-114">La ruta de acceso más sencilla para empezar a trabajar con SSO de pestaña es con Microsoft Teams Toolkit para Visual Studio código.</span><span class="sxs-lookup"><span data-stu-id="ccca4-114">The simplest path to getting started with tab SSO is with the Microsoft Teams Toolkit for Visual Studio Code.</span></span> [<span data-ttu-id="ccca4-115">Más información</span><span class="sxs-lookup"><span data-stu-id="ccca4-115">Learn more</span></span>](../../../toolkit/visual-studio-code-tab-sso.md)


## <a name="how-sso-works-at-runtime"></a><span data-ttu-id="ccca4-116">Cómo funciona el SSO en tiempo de ejecución</span><span class="sxs-lookup"><span data-stu-id="ccca4-116">How SSO works at runtime</span></span>

<span data-ttu-id="ccca4-117">En el siguiente diagrama se muestra cómo funciona el proceso de SSO:</span><span class="sxs-lookup"><span data-stu-id="ccca4-117">The following diagram shows how the SSO process works:</span></span>

<!-- markdownlint-disable MD033 -->
<img src="~/assets/images/tabs/tabs-sso-diagram.png" alt="Tab single sign-on SSO diagram" width="75%"/>

1. <span data-ttu-id="ccca4-118">En la pestaña, se realiza una llamada de JavaScript a `getAuthToken()` .</span><span class="sxs-lookup"><span data-stu-id="ccca4-118">In the tab, a JavaScript call is made to `getAuthToken()`.</span></span> <span data-ttu-id="ccca4-119">Esto indica a Teams que obtenga un token de autenticación para la aplicación de pestaña.</span><span class="sxs-lookup"><span data-stu-id="ccca4-119">This tells Teams to obtain an authentication token for the tab application.</span></span>
2. <span data-ttu-id="ccca4-120">Si es la primera vez que el usuario actual usa la aplicación de pestaña, habrá una solicitud de consentimiento (si se requiere consentimiento) o para controlar la autenticación paso a paso (como la autenticación en dos fases).</span><span class="sxs-lookup"><span data-stu-id="ccca4-120">If this is the first time the current user has used your tab application, there will be a request prompt to consent (if consent is required) or to handle step-up authentication (such as two-factor authentication).</span></span>
3. <span data-ttu-id="ccca4-121">Teams solicita el token de aplicación de pestaña del punto de conexión de Azure AD para el usuario actual.</span><span class="sxs-lookup"><span data-stu-id="ccca4-121">Teams requests the tab application token from the Azure AD endpoint for the current user.</span></span>
4. <span data-ttu-id="ccca4-122">Azure AD envía el token de aplicación de pestaña a la aplicación teams.</span><span class="sxs-lookup"><span data-stu-id="ccca4-122">Azure AD sends the tab application token to the Teams application.</span></span>
5. <span data-ttu-id="ccca4-123">Teams envía el token de aplicación de pestaña a la pestaña como parte del objeto de resultado devuelto por la `getAuthToken()` llamada.</span><span class="sxs-lookup"><span data-stu-id="ccca4-123">Teams sends the tab application token to the tab as part of the result object returned by the `getAuthToken()` call.</span></span>
6. <span data-ttu-id="ccca4-124">El token se analizará en la aplicación de pestaña, a través de JavaScript, para extraer la información necesaria, como la dirección de correo electrónico del usuario.</span><span class="sxs-lookup"><span data-stu-id="ccca4-124">The token will be parsed in the tab application, via JavaScript, to extract the needed information, such as the user's email address.</span></span>

> [!NOTE]
> <span data-ttu-id="ccca4-125">El solo es válido para dar su consentimiento a un conjunto limitado de API de nivel de usuario `getAuthToken()` (correo electrónico, perfil, offline_access y OpenId) y no para otros ámbitos de Microsoft Graph como `User.Read` o `Mail.Read` .</span><span class="sxs-lookup"><span data-stu-id="ccca4-125">The `getAuthToken()` is only valid for consenting to a limited set of user-level APIs — email, profile, offline_access and OpenId — and not for further Microsoft Graph scopes such as `User.Read` or `Mail.Read`.</span></span> <span data-ttu-id="ccca4-126">Consulte nuestra sección al final de este documento para obtener soluciones alternativas sugeridas si necesita [ámbitos de Graph adicionales.](#apps-that-require-additional-microsoft-graph-scopes)</span><span class="sxs-lookup"><span data-stu-id="ccca4-126">See our section at the end of this document for suggested workarounds if you require [additional Graph scopes](#apps-that-require-additional-microsoft-graph-scopes).</span></span>

<span data-ttu-id="ccca4-127">La API de SSO también funcionará en [módulos de tareas](../../../task-modules-and-cards/what-are-task-modules.md) que insertan contenido web.</span><span class="sxs-lookup"><span data-stu-id="ccca4-127">The SSO API will also work in [Task Modules](../../../task-modules-and-cards/what-are-task-modules.md) that embed web content.</span></span>

## <a name="develop-an-sso-microsoft-teams-tab"></a><span data-ttu-id="ccca4-128">Desarrollar una pestaña de SSO de Microsoft Teams</span><span class="sxs-lookup"><span data-stu-id="ccca4-128">Develop an SSO Microsoft Teams tab</span></span>

<span data-ttu-id="ccca4-129">En esta sección se describen las tareas implicadas en la creación de una pestaña de Teams que usa SSO.</span><span class="sxs-lookup"><span data-stu-id="ccca4-129">This section describes the tasks involved in creating a Teams tab that uses SSO.</span></span> <span data-ttu-id="ccca4-130">Estas tareas se describen aquí, independientemente del lenguaje y del marco.</span><span class="sxs-lookup"><span data-stu-id="ccca4-130">These tasks are described here are language- and framework-agnostic.</span></span>

### <a name="1-create-your-azure-active-directory-azure-ad-application"></a><span data-ttu-id="ccca4-131">1. Crear la aplicación de Azure Active Directory (Azure AD)</span><span class="sxs-lookup"><span data-stu-id="ccca4-131">1. Create your Azure Active Directory (Azure AD) application</span></span>

#### <a name="registering-your-application-in-theazure-ad-portal-overview"></a><span data-ttu-id="ccca4-132">Introducción al registro de la aplicación en[el portal de Azure AD:](https://azure.microsoft.com/features/azure-portal/)</span><span class="sxs-lookup"><span data-stu-id="ccca4-132">Registering your application in the[Azure AD portal](https://azure.microsoft.com/features/azure-portal/) overview:</span></span>

1. <span data-ttu-id="ccca4-133">Obtenga el [id. de aplicación de Azure AD.](/azure/active-directory/develop/howto-create-service-principal-portal#get-values-for-signing-in)</span><span class="sxs-lookup"><span data-stu-id="ccca4-133">Get your [Azure AD Application ID](/azure/active-directory/develop/howto-create-service-principal-portal#get-values-for-signing-in).</span></span>
2. <span data-ttu-id="ccca4-134">Especifique los permisos que la aplicación necesita para el punto de conexión de Azure AD y, opcionalmente, Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="ccca4-134">Specify the permissions that your application needs for the Azure AD endpoint and, optionally, Microsoft Graph.</span></span>
3. <span data-ttu-id="ccca4-135">[Conceda permisos para](/azure/active-directory/develop/howto-create-service-principal-portal#configure-access-policies-on-resources) aplicaciones móviles, web y de escritorio de Teams.</span><span class="sxs-lookup"><span data-stu-id="ccca4-135">[Grant permissions](/azure/active-directory/develop/howto-create-service-principal-portal#configure-access-policies-on-resources) for Teams desktop, web, and mobile applications.</span></span>
4. <span data-ttu-id="ccca4-136">Autorizar previamente Teams seleccionando el botón Agregar **un** ámbito y, en el panel que se abre, escriba `access_as_user` como el nombre del **ámbito.**</span><span class="sxs-lookup"><span data-stu-id="ccca4-136">Pre-authorize Teams by selecting the **Add a scope** button and in the panel that opens, enter `access_as_user` as the **Scope name**.</span></span>

> [!NOTE]
> <span data-ttu-id="ccca4-137">Hay algunas restricciones importantes que debe tener en cuenta:</span><span class="sxs-lookup"><span data-stu-id="ccca4-137">There are some important restrictions you should be aware of:</span></span>
>
> * <span data-ttu-id="ccca4-138">Solo se admiten permisos de api de Microsoft Graph de nivel de usuario, es decir, correo electrónico, perfil, offline_access, OpenId.</span><span class="sxs-lookup"><span data-stu-id="ccca4-138">We only support user-level Microsoft Graph API permissions, i.e., email, profile, offline_access, OpenId.</span></span> <span data-ttu-id="ccca4-139">Si necesita obtener acceso a otros ámbitos de Microsoft Graph (como o ), consulte nuestra solución alternativa recomendada al `User.Read` `Mail.Read` final de esta documentación. [](#apps-that-require-additional-microsoft-graph-scopes)</span><span class="sxs-lookup"><span data-stu-id="ccca4-139">If you need access to other Microsoft Graph scopes (such as `User.Read` or `Mail.Read`), see our [recommended workaround](#apps-that-require-additional-microsoft-graph-scopes) at the end of this documentation.</span></span>
> * <span data-ttu-id="ccca4-140">Es importante que el nombre de dominio de la aplicación sea el mismo que el nombre de dominio que registraste para la aplicación de Azure AD.</span><span class="sxs-lookup"><span data-stu-id="ccca4-140">It's important that your application's domain name is the same as the domain name you've registering for your Azure AD application.</span></span>
> * <span data-ttu-id="ccca4-141">Actualmente no se admiten varios dominios por aplicación.</span><span class="sxs-lookup"><span data-stu-id="ccca4-141">We don't currently support multiple domains per app.</span></span>
> * <span data-ttu-id="ccca4-142">No se admiten aplicaciones que usen el dominio porque `azurewebsites.net` es demasiado común y puede ser un riesgo para la seguridad.</span><span class="sxs-lookup"><span data-stu-id="ccca4-142">We don't support applications that use the `azurewebsites.net` domain because it is too common and may be a security risk.</span></span> <span data-ttu-id="ccca4-143">Sin embargo, estamos buscando activamente quitar esta restricción.</span><span class="sxs-lookup"><span data-stu-id="ccca4-143">However, we're actively seeking to remove this restriction.</span></span>

#### <a name="registering-your-app-through-the-azure-active-directory-portal-in-depth"></a><span data-ttu-id="ccca4-144">Registrar la aplicación a través del portal de Azure Active Directory en profundidad:</span><span class="sxs-lookup"><span data-stu-id="ccca4-144">Registering your app through the Azure Active Directory portal in-depth:</span></span>

1. <span data-ttu-id="ccca4-145">Registrar una nueva aplicación en el portal de registros de aplicaciones [de Azure Active Directory.](https://go.microsoft.com/fwlink/?linkid=2083908)</span><span class="sxs-lookup"><span data-stu-id="ccca4-145">Register a new application in the [Azure Active Directory – App Registrations](https://go.microsoft.com/fwlink/?linkid=2083908) portal.</span></span>
2. <span data-ttu-id="ccca4-146">Seleccione **Nuevo registro y,** en *la página registrar una aplicación,* establezca los siguientes valores:</span><span class="sxs-lookup"><span data-stu-id="ccca4-146">Select **New Registration** and on the *register an application page*, set following values:</span></span>
    * <span data-ttu-id="ccca4-147">Establece **el nombre** en el nombre de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="ccca4-147">Set **name** to your app name.</span></span>
    * <span data-ttu-id="ccca4-148">Elegir los **tipos de cuenta admitidos** (cualquier tipo de cuenta funcionará) ¹</span><span class="sxs-lookup"><span data-stu-id="ccca4-148">Choose the **supported account types** (any account type will work) ¹</span></span>
    * <span data-ttu-id="ccca4-149">Deje **URI de redireccionamiento** vacía.</span><span class="sxs-lookup"><span data-stu-id="ccca4-149">Leave **Redirect URI** empty.</span></span>
    * <span data-ttu-id="ccca4-150">Elija **Registrar**.</span><span class="sxs-lookup"><span data-stu-id="ccca4-150">Choose **Register**.</span></span>
3. <span data-ttu-id="ccca4-151">En la página de información general, copie y guarde el identificador **de aplicación (cliente).**</span><span class="sxs-lookup"><span data-stu-id="ccca4-151">On the overview page, copy and save the **Application (client) ID**.</span></span> <span data-ttu-id="ccca4-152">Lo necesitará más adelante al actualizar el manifiesto de la aplicación de Teams.</span><span class="sxs-lookup"><span data-stu-id="ccca4-152">You’ll need it later when updating your Teams application manifest.</span></span>
4. <span data-ttu-id="ccca4-153">En **Administrar**, seleccione **Exponer una API**</span><span class="sxs-lookup"><span data-stu-id="ccca4-153">Under **Manage**, select **Expose an API**.</span></span> 
5. <span data-ttu-id="ccca4-154">Seleccione el **vínculo Establecer** para generar el URI de id. de aplicación con el formato `api://{AppID}` de .</span><span class="sxs-lookup"><span data-stu-id="ccca4-154">Select the **Set** link to generate the Application ID URI in the form of `api://{AppID}`.</span></span> <span data-ttu-id="ccca4-155">Inserte el nombre de dominio completo (con una barra diagonal "/" anexada al final) entre las barras diagonales dobles y el GUID.</span><span class="sxs-lookup"><span data-stu-id="ccca4-155">Insert your fully qualified domain name (with a forward slash "/" appended to the end) between the double forward slashes and the GUID.</span></span> <span data-ttu-id="ccca4-156">El identificador completo debe tener el formato: `api://fully-qualified-domain-name.com/{AppID}` ²</span><span class="sxs-lookup"><span data-stu-id="ccca4-156">The entire ID should have the form of: `api://fully-qualified-domain-name.com/{AppID}` ²</span></span>
    * <span data-ttu-id="ccca4-157">ex: `api://subdomain.example.com/00000000-0000-0000-0000-000000000000` .</span><span class="sxs-lookup"><span data-stu-id="ccca4-157">ex: `api://subdomain.example.com/00000000-0000-0000-0000-000000000000`.</span></span>
    
    <span data-ttu-id="ccca4-158">El nombre de dominio completo es el nombre de dominio legible humano desde el que se sirve la aplicación.</span><span class="sxs-lookup"><span data-stu-id="ccca4-158">The fully qualified domain name is the human readable domain name from which your app is served.</span></span> <span data-ttu-id="ccca4-159">Si usa un servicio de túnel como ngrok, deberá actualizar este valor siempre que cambie su subdominio ngrok.</span><span class="sxs-lookup"><span data-stu-id="ccca4-159">If you are using a tunneling service such as ngrok, you will need to update     this value whenever your ngrok subdomain changes.</span></span> 
6. <span data-ttu-id="ccca4-160">Seleccione el botón **Agregar un ámbito**</span><span class="sxs-lookup"><span data-stu-id="ccca4-160">Select the **Add a scope** button.</span></span> <span data-ttu-id="ccca4-161">En el panel que se abre, escriba `access_as_user` como el **Nombre de ámbito**.</span><span class="sxs-lookup"><span data-stu-id="ccca4-161">In the panel that opens, enter `access_as_user` as the **Scope name**.</span></span>
7. <span data-ttu-id="ccca4-162">Establecer **quién puede dar su consentimiento**`Admins and users`</span><span class="sxs-lookup"><span data-stu-id="ccca4-162">Set **Who can consent?** to `Admins and users`</span></span>
8. <span data-ttu-id="ccca4-163">Rellene los campos para configurar los mensajes de consentimiento del administrador y el usuario con valores adecuados para el `access_as_user` ámbito:</span><span class="sxs-lookup"><span data-stu-id="ccca4-163">Fill in the fields for configuring the admin and user consent prompts with values that are appropriate for the `access_as_user` scope:</span></span>
    * <span data-ttu-id="ccca4-164">**Título de consentimiento de administrador:** Teams puede acceder al perfil del usuario.</span><span class="sxs-lookup"><span data-stu-id="ccca4-164">**Admin consent title:** Teams can access the user’s profile.</span></span>
    * <span data-ttu-id="ccca4-165">**Descripción del consentimiento del administrador:** permite a Teams llamar a las API web de la aplicación como el usuario actual.</span><span class="sxs-lookup"><span data-stu-id="ccca4-165">**Admin consent description**: Allows Teams to call the app’s web APIs as the current user.</span></span>
    * <span data-ttu-id="ccca4-166">**Título de consentimiento del** usuario: Teams puede acceder al perfil de usuario y realizar solicitudes en nombre del usuario.</span><span class="sxs-lookup"><span data-stu-id="ccca4-166">**User consent title**: Teams can access the user profile and make requests on the user's behalf.</span></span>
    * <span data-ttu-id="ccca4-167">**Descripción del consentimiento del usuario:** Permitir que Teams llame a las API de esta aplicación con los mismos derechos que el usuario.</span><span class="sxs-lookup"><span data-stu-id="ccca4-167">**User consent description:** Enable Teams to call this app’s APIs with the same rights as the user.</span></span>
9. <span data-ttu-id="ccca4-168">Asegurarse de **que el estado** está establecido en **Habilitado**</span><span class="sxs-lookup"><span data-stu-id="ccca4-168">Ensure that **State** is set to **Enabled**</span></span>
10. <span data-ttu-id="ccca4-169">Seleccione el **botón Agregar ámbito** para guardar</span><span class="sxs-lookup"><span data-stu-id="ccca4-169">Select the **Add scope** button to save</span></span> 
    * <span data-ttu-id="ccca4-170">La parte de  dominio del nombre de ámbito que se muestra justo debajo del campo de texto debe coincidir automáticamente con el **URI** de id. de aplicación establecido en el paso anterior, con anexado `/access_as_user` al final:</span><span class="sxs-lookup"><span data-stu-id="ccca4-170">The domain part of the **Scope name** displayed just below the text field should automatically match the **Application ID** URI set in the previous step, with `/access_as_user` appended to the end:</span></span>
        * `api://subdomain.example.com/00000000-0000-0000-0000-000000000000/access_as_user`
11. <span data-ttu-id="ccca4-171">En la **sección Aplicaciones cliente autorizadas,** identifique las aplicaciones que desea autorizar para la aplicación web de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="ccca4-171">In the **Authorized client applications** section, identify the applications that you want to authorize for your app’s web application.</span></span> <span data-ttu-id="ccca4-172">Seleccione *Agregar una aplicación cliente.*</span><span class="sxs-lookup"><span data-stu-id="ccca4-172">Select *Add a client application*.</span></span> <span data-ttu-id="ccca4-173">Escriba cada uno de los siguientes IDs de cliente y seleccione el ámbito autorizado que creó en el paso anterior:</span><span class="sxs-lookup"><span data-stu-id="ccca4-173">Enter each of the following client IDs and select the authorized scope you created in the previous step:</span></span>
    * <span data-ttu-id="ccca4-174">`1fec8e78-bce4-4aaf-ab1b-5451cc387264` (Aplicación de escritorio o móvil de Teams)</span><span class="sxs-lookup"><span data-stu-id="ccca4-174">`1fec8e78-bce4-4aaf-ab1b-5451cc387264` (Teams mobile/desktop application)</span></span>
    * <span data-ttu-id="ccca4-175">`5e3ce6c0-2b1f-4285-8d4b-75ee78787346` (Aplicación web de Teams)</span><span class="sxs-lookup"><span data-stu-id="ccca4-175">`5e3ce6c0-2b1f-4285-8d4b-75ee78787346` (Teams web application)</span></span>
12. <span data-ttu-id="ccca4-176">Vaya a **Permisos de API.**</span><span class="sxs-lookup"><span data-stu-id="ccca4-176">Navigate to **API Permissions**.</span></span> <span data-ttu-id="ccca4-177">Seleccione *Agregar permisos delegados* de Microsoft Graph y, a continuación, agregue los siguientes  >    >  permisos de la API de Microsoft Graph:</span><span class="sxs-lookup"><span data-stu-id="ccca4-177">Select *Add a permission* > *Microsoft Graph* > *Delegated permissions*, then add the following permissions from Microsoft Graph API:</span></span>
    * <span data-ttu-id="ccca4-178">User.Read (habilitado de forma predeterminada)</span><span class="sxs-lookup"><span data-stu-id="ccca4-178">User.Read (enabled by default)</span></span>
    * <span data-ttu-id="ccca4-179">email</span><span class="sxs-lookup"><span data-stu-id="ccca4-179">email</span></span>
    * <span data-ttu-id="ccca4-180">offline_access</span><span class="sxs-lookup"><span data-stu-id="ccca4-180">offline_access</span></span>
    * <span data-ttu-id="ccca4-181">OpenId</span><span class="sxs-lookup"><span data-stu-id="ccca4-181">OpenId</span></span>
    * <span data-ttu-id="ccca4-182">perfil</span><span class="sxs-lookup"><span data-stu-id="ccca4-182">profile</span></span>

13. <span data-ttu-id="ccca4-183">Ir a **Autenticación**</span><span class="sxs-lookup"><span data-stu-id="ccca4-183">Navigate to **Authentication**</span></span>

    <span data-ttu-id="ccca4-184">Si no se ha concedido el consentimiento de administrador de TI a una aplicación, los usuarios tendrán que dar su consentimiento la primera vez que usen una aplicación.</span><span class="sxs-lookup"><span data-stu-id="ccca4-184">If an app hasn't been granted IT admin consent, users will have to provide consent the first time they use an app.</span></span>

    <span data-ttu-id="ccca4-185">Establecer un URI de redireccionamiento:</span><span class="sxs-lookup"><span data-stu-id="ccca4-185">Set a redirect URI:</span></span>
    * <span data-ttu-id="ccca4-186">Seleccione **Agregar una plataforma.**</span><span class="sxs-lookup"><span data-stu-id="ccca4-186">Select **Add a platform**.</span></span>
    * <span data-ttu-id="ccca4-187">Seleccione **web**.</span><span class="sxs-lookup"><span data-stu-id="ccca4-187">Select **web**.</span></span>
    * <span data-ttu-id="ccca4-188">Escribe el **URI de redireccionamiento** de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="ccca4-188">Enter the **redirect URI** for your app.</span></span> <span data-ttu-id="ccca4-189">Esta será la página donde un flujo de concesión implícito correcto redirigirá al usuario.</span><span class="sxs-lookup"><span data-stu-id="ccca4-189">This will be the page where a successful implicit grant flow will redirect the user.</span></span> <span data-ttu-id="ccca4-190">Este será el mismo nombre de dominio completo que escribió en el paso 5 seguido de la ruta de api donde se debe enviar una respuesta de autenticación.</span><span class="sxs-lookup"><span data-stu-id="ccca4-190">This will be same fully qualified domain name that you entered in step 5 followed by the API route where a authentication response should be sent.</span></span> <span data-ttu-id="ccca4-191">Si sigue cualquiera de los ejemplos de Teams, será: `https://subdomain.example.com/auth-end`</span><span class="sxs-lookup"><span data-stu-id="ccca4-191">If you are following any of the Teams samples, this will be: `https://subdomain.example.com/auth-end`</span></span>

    <span data-ttu-id="ccca4-192">A continuación, habilite la concesión implícita activando las siguientes casillas:</span><span class="sxs-lookup"><span data-stu-id="ccca4-192">Next, enable implicit grant by checking the following boxes:</span></span>  
    <span data-ttu-id="ccca4-193">✔ token de id.</span><span class="sxs-lookup"><span data-stu-id="ccca4-193">✔ ID Token</span></span>  
    <span data-ttu-id="ccca4-194">✔ token de acceso</span><span class="sxs-lookup"><span data-stu-id="ccca4-194">✔ Access Token</span></span>  
    
<span data-ttu-id="ccca4-195">¡Enhorabuena!</span><span class="sxs-lookup"><span data-stu-id="ccca4-195">Congratulations!</span></span> <span data-ttu-id="ccca4-196">Ha completado los requisitos previos de registro de la aplicación para continuar con la aplicación sso de pestaña.</span><span class="sxs-lookup"><span data-stu-id="ccca4-196">You have completed the app registration prerequisites to proceed with your tab SSO app.</span></span>     

> [!NOTE]
>
> * <span data-ttu-id="ccca4-197">¹ Si la aplicación de  Azure AD está registrada en el mismo espacio empresarial en el que realiza una solicitud de autenticación en Teams, no se le pedirá al usuario su consentimiento y se le concederá un token de acceso inmediatamente.</span><span class="sxs-lookup"><span data-stu-id="ccca4-197">¹ If your Azure AD app is registered in the _same_ tenant where you're making an authentication request in Teams, the user won't be asked to consent and will be granted an access token right away.</span></span> <span data-ttu-id="ccca4-198">Los usuarios solo necesitan dar su consentimiento a estos permisos si la aplicación de Azure AD está registrada en un inquilino diferente.</span><span class="sxs-lookup"><span data-stu-id="ccca4-198">Users only need to consent to these permissions if the Azure AD app is registered in a different tenant.</span></span>
> * <span data-ttu-id="ccca4-199">Si recibe un error que indica que el dominio ya es propiedad y es el propietario, siga el procedimiento de [Inicio rápido:](/azure/active-directory/fundamentals/add-custom-domain) Agregar un nombre de dominio personalizado a Azure Active Directory para registrar el dominio y, a continuación, repita el paso 5 anterior.</span><span class="sxs-lookup"><span data-stu-id="ccca4-199">² If you get an error stating that the domain is already owned and you are the owner, follow the procedure at [Quickstart: Add a custom domain name to Azure Active Directory](/azure/active-directory/fundamentals/add-custom-domain) to register the domain, and then repeat step 5, above.</span></span> <span data-ttu-id="ccca4-200">(Este error también puede producirse si no ha iniciado sesión con credenciales de administrador en el arrendamiento de Office 365).</span><span class="sxs-lookup"><span data-stu-id="ccca4-200">(This error can also occur if you aren't signed in with Admin credentials in the Office 365 tenancy).</span></span>
> * <span data-ttu-id="ccca4-201">Si no recibe el UPN (nombre principal de usuario) en el token de acceso devuelto, puede agregarlo como una notificación opcional [en](https://docs.microsoft.com/azure/active-directory/develop/active-directory-optional-claims) Azure AD.</span><span class="sxs-lookup"><span data-stu-id="ccca4-201">If you are not receiving the UPN (User Principal Name) in the returned access token, you can add it as an [optional claim](https://docs.microsoft.com/azure/active-directory/develop/active-directory-optional-claims) in Azure AD.</span></span>

### <a name="2-update-your-microsoft-teams-application-manifest"></a><span data-ttu-id="ccca4-202">2. Actualizar el manifiesto de la aplicación de Microsoft Teams</span><span class="sxs-lookup"><span data-stu-id="ccca4-202">2. Update your Microsoft Teams application manifest</span></span>

<span data-ttu-id="ccca4-203">Agregue nuevas propiedades al manifiesto de Microsoft Teams:</span><span class="sxs-lookup"><span data-stu-id="ccca4-203">Add new properties to your Microsoft Teams manifest:</span></span>

* <span data-ttu-id="ccca4-204">**WebApplicationInfo:** elemento principal de los siguientes elementos:</span><span class="sxs-lookup"><span data-stu-id="ccca4-204">**WebApplicationInfo** - The parent of the following elements:</span></span>

> [!div class="checklist"]
> * <span data-ttu-id="ccca4-205">**id:** id. de cliente de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="ccca4-205">**id** - The client ID of the application.</span></span> <span data-ttu-id="ccca4-206">Este es el identificador de aplicación que obtuvo como parte del registro de la aplicación con Azure AD.</span><span class="sxs-lookup"><span data-stu-id="ccca4-206">This is the application ID that you obtained as part of registering the application with Azure AD.</span></span>
>* <span data-ttu-id="ccca4-207">**recurso:** el dominio y el subdominio de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="ccca4-207">**resource** - The domain and subdomain of your application.</span></span> <span data-ttu-id="ccca4-208">Este es el mismo URI (incluido el `api://` protocolo) que registró al crear el paso `scope` 6 anterior.</span><span class="sxs-lookup"><span data-stu-id="ccca4-208">This is the same URI (including the `api://` protocol) that you registered when creating your `scope` in step 6 above.</span></span> <span data-ttu-id="ccca4-209">No debe incluir la ruta `access_as_user` de acceso en el recurso.</span><span class="sxs-lookup"><span data-stu-id="ccca4-209">You shouldn't include the `access_as_user` path in your resource.</span></span> <span data-ttu-id="ccca4-210">La parte de dominio de este URI debe coincidir con el dominio, incluidos los subdominios, que se usan en las direcciones URL del manifiesto de la aplicación de Teams.</span><span class="sxs-lookup"><span data-stu-id="ccca4-210">The domain part of this URI should match the domain, including any subdomains, used in the URLs of your Teams application manifest.</span></span>

```json
"webApplicationInfo": {
  "id": "00000000-0000-0000-0000-000000000000",
  "resource": "api://subdomain.example.com/00000000-0000-0000-0000-000000000000"
}
```

> [!NOTE]
>
>* <span data-ttu-id="ccca4-211">El recurso de una aplicación de AAD normalmente será la raíz de su dirección URL del sitio y el appID (por ejemplo, `api://subdomain.example.com/00000000-0000-0000-0000-000000000000` ).</span><span class="sxs-lookup"><span data-stu-id="ccca4-211">The resource for an AAD app will usually be the root of its site URL and the appID (e.g. `api://subdomain.example.com/00000000-0000-0000-0000-000000000000`).</span></span> <span data-ttu-id="ccca4-212">También usamos este valor para asegurarnos de que la solicitud viene del mismo dominio.</span><span class="sxs-lookup"><span data-stu-id="ccca4-212">We also use this value to ensure your request is coming from the same domain.</span></span> <span data-ttu-id="ccca4-213">Por lo tanto, asegúrese de que la `contentURL` pestaña usa los mismos dominios que la propiedad de recurso.</span><span class="sxs-lookup"><span data-stu-id="ccca4-213">Therefore, make sure that the `contentURL` for your tab uses the same domains as your resource property.</span></span>
>* <span data-ttu-id="ccca4-214">Debe usar la versión de manifiesto 1.5 o posterior para implementar el `webApplicationInfo` campo.</span><span class="sxs-lookup"><span data-stu-id="ccca4-214">You need to use manifest version 1.5 or higher to implement the `webApplicationInfo` field.</span></span>

### <a name="3-get-an-authentication-token-from-your-client-side-code"></a><span data-ttu-id="ccca4-215">3. Obtener un token de autenticación del código del lado cliente</span><span class="sxs-lookup"><span data-stu-id="ccca4-215">3. Get an authentication token from your client-side code</span></span>

<span data-ttu-id="ccca4-216">Este es el aspecto de la API de autenticación:</span><span class="sxs-lookup"><span data-stu-id="ccca4-216">Here's what the authentication API looks like:</span></span>

```javascript
var authTokenRequest = {
  successCallback: function(result) { console.log("Success: " + result); },
  failureCallback: function(error) { console.log("Failure: " + error); }
};
microsoftTeams.authentication.getAuthToken(authTokenRequest);
```

<span data-ttu-id="ccca4-217">Cuando llames y se requiera consentimiento de usuario adicional (para permisos de nivel de usuario), mostraremos un cuadro de diálogo al usuario que le animará a conceder `getAuthToken` consentimiento adicional.</span><span class="sxs-lookup"><span data-stu-id="ccca4-217">When you call `getAuthToken` - and additional user consent is required (for user-level permissions) - we will show a dialog to the user encouraging them to grant additional consent.</span></span> 

<span data-ttu-id="ccca4-218">Una vez que haya recibido el token de acceso en la devolución de llamada correcta, puede descodificar el token de acceso para ver las notificaciones asociadas con ese token.</span><span class="sxs-lookup"><span data-stu-id="ccca4-218">Once you've received the access token in the success callback you can decode the access token to view the claims associated with that token.</span></span> <span data-ttu-id="ccca4-219">(Opcionalmente, puede copiar o pegar manualmente el token de acceso en una herramienta como [JWT.io](https://jwt.io/) inspeccionar su contenido).</span><span class="sxs-lookup"><span data-stu-id="ccca4-219">(Optionally, you can manually copy/paste the access token into a tool such as [JWT.io](https://jwt.io/) to inspect its contents).</span></span> <span data-ttu-id="ccca4-220">Si no recibe el UPN (nombre principal de usuario) en el token de acceso devuelto, puede agregarlo como una notificación opcional [en](https://docs.microsoft.com/azure/active-directory/develop/active-directory-optional-claims) Azure AD.</span><span class="sxs-lookup"><span data-stu-id="ccca4-220">If you are not receiving the UPN (User Principal Name) in the returned access token, you can add it as an [optional claim](https://docs.microsoft.com/azure/active-directory/develop/active-directory-optional-claims) in Azure AD.</span></span>

<p>
    <img src="~/assets/images/tabs/tabs-sso-prompt.png" alt="Tab single sign-on SSO dialog prompt" width="75%"/>
</p>

## <a name="sample-code"></a><span data-ttu-id="ccca4-221">Código de ejemplo</span><span class="sxs-lookup"><span data-stu-id="ccca4-221">Sample code</span></span>

<span data-ttu-id="ccca4-222">Visite nuestra aplicación de ejemplo: [ejemplo de SSO de PnP de MSTeams](https://github.com/pnp/teams-dev-samples/tree/master/samples/tab-sso)</span><span class="sxs-lookup"><span data-stu-id="ccca4-222">Visit our sample application: [MSTeams PnP SSO Sample](https://github.com/pnp/teams-dev-samples/tree/master/samples/tab-sso)</span></span>

<span data-ttu-id="ccca4-223">ReadME explica cómo configurar el entorno de desarrollo y cómo configurar la aplicación en Azure AD.</span><span class="sxs-lookup"><span data-stu-id="ccca4-223">The README explains how to set up your development environment and how to configure your application in Azure AD.</span></span> <span data-ttu-id="ccca4-224">También puedes encontrar más información sobre cómo [](https://github.com/OfficeDev/msteams-tabs-sso-sample-nodejs#app-structure) se estructura el ejemplo en la sección de estructura de la aplicación para familiarizarte con el código base.</span><span class="sxs-lookup"><span data-stu-id="ccca4-224">You can also find further information on how the sample is structured in the [app structure section](https://github.com/OfficeDev/msteams-tabs-sso-sample-nodejs#app-structure) to help familiarize yourself with the codebase.</span></span>

## <a name="known-limitations"></a><span data-ttu-id="ccca4-225">Limitaciones conocidas</span><span class="sxs-lookup"><span data-stu-id="ccca4-225">Known Limitations</span></span>

### <a name="apps-that-require-additional-microsoft-graph-scopes"></a><span data-ttu-id="ccca4-226">Aplicaciones que requieren ámbitos de Microsoft Graph adicionales</span><span class="sxs-lookup"><span data-stu-id="ccca4-226">Apps that require additional Microsoft Graph Scopes</span></span>

<span data-ttu-id="ccca4-227">Nuestra implementación actual para SSO solo concede consentimiento para permisos de nivel de usuario (correo electrónico, perfil, offline_access, OpenId) no para otras API (como User.Read o Mail.Read).</span><span class="sxs-lookup"><span data-stu-id="ccca4-227">Our current implementation for SSO only grants consent for user-level permissions — email, profile, offline_access, OpenId — not for other APIs (such as User.Read or Mail.Read).</span></span> <span data-ttu-id="ccca4-228">Si la aplicación necesita más ámbitos de Microsoft Graph, estas son algunas soluciones alternativas de habilitación:</span><span class="sxs-lookup"><span data-stu-id="ccca4-228">If your app needs further Microsoft Graph scopes, here are some enabling workarounds:</span></span>

#### <a name="tenant-admin-consent"></a><span data-ttu-id="ccca4-229">Consentimiento del administrador del espacio empresarial</span><span class="sxs-lookup"><span data-stu-id="ccca4-229">Tenant Admin Consent</span></span>

<span data-ttu-id="ccca4-230">El enfoque más sencillo es conseguir que un administrador de inquilinos consiente previamente en nombre de la organización.</span><span class="sxs-lookup"><span data-stu-id="ccca4-230">The simplest approach is to get a tenant admin to pre-consent on behalf of the organization.</span></span> <span data-ttu-id="ccca4-231">Esto significa que los usuarios no tendrán que dar su consentimiento a estos ámbitos y, a continuación, puede intercambiar el lado del servidor de tokens con el flujo en nombre de de Azure [AD.](/azure/active-directory/develop/v1-oauth2-on-behalf-of-flow)</span><span class="sxs-lookup"><span data-stu-id="ccca4-231">This means users won’t have to consent to these scopes and you can then be free to exchange the token server side using Azure AD’s [on-behalf-of flow](/azure/active-directory/develop/v1-oauth2-on-behalf-of-flow).</span></span> <span data-ttu-id="ccca4-232">Esta solución alternativa es aceptable para aplicaciones de línea de negocio internas, pero puede que no sea suficiente para desarrolladores de terceros que no puedan confiar en la aprobación del administrador de inquilinos.</span><span class="sxs-lookup"><span data-stu-id="ccca4-232">This workaround is acceptable for internal line-of-business applications but may not be enough for third-party developers who may not be able to rely on tenant admin approval.</span></span>

<span data-ttu-id="ccca4-233">Una forma sencilla de dar su consentimiento en nombre de una organización (como administrador de inquilinos) es visitar:</span><span class="sxs-lookup"><span data-stu-id="ccca4-233">A simple way of consenting on behalf of an organization (as a tenant admin) is to visit:</span></span>

* `https://login.microsoftonline.com/common/adminconsent?client_id=<AAD_App_ID>`

#### <a name="asking-for-additional-consent-using-the-auth-api"></a><span data-ttu-id="ccca4-234">Solicitar consentimiento adicional mediante la API de autenticación</span><span class="sxs-lookup"><span data-stu-id="ccca4-234">Asking for additional consent using the Auth API</span></span>

<span data-ttu-id="ccca4-235">Otro enfoque para obtener ámbitos adicionales de Microsoft Graph es presentar un cuadro de diálogo de consentimiento mediante nuestro enfoque de autenticación de [Azure AD](~/tabs/how-to/authentication/auth-tab-aad.md#navigate-to-the-authorization-page-from-your-popup-page) basado en web existente, que implica abrir un cuadro de diálogo de consentimiento de Azure AD.</span><span class="sxs-lookup"><span data-stu-id="ccca4-235">Another approach for getting additional Microsoft Graph scopes is to present a consent dialog using our existing [web-based Azure AD authentication approach](~/tabs/how-to/authentication/auth-tab-aad.md#navigate-to-the-authorization-page-from-your-popup-page) which involves popping up an Azure AD consent dialog.</span></span> <span data-ttu-id="ccca4-236">Hay algunas adiciones notables:</span><span class="sxs-lookup"><span data-stu-id="ccca4-236">There are some notable additions:</span></span>

1. <span data-ttu-id="ccca4-237">El token recuperado con el uso debe intercambiarse del lado servidor con el flujo en nombre de Azure AD para obtener acceso a esas API de `getAuthToken()` Microsoft Graph [](/azure/active-directory/develop/v2-oauth2-on-behalf-of-flow) adicionales.</span><span class="sxs-lookup"><span data-stu-id="ccca4-237">The token retrieved using `getAuthToken()` needs to be exchanged server-side using Azure AD [on-behalf-of flow](/azure/active-directory/develop/v2-oauth2-on-behalf-of-flow) to get access to those additional Microsoft Graph APIs.</span></span>
    * <span data-ttu-id="ccca4-238">Asegúrese de usar el punto de conexión v2 de Microsoft Graph para este intercambio</span><span class="sxs-lookup"><span data-stu-id="ccca4-238">Be sure to use the v2 Microsoft Graph endpoint for this exchange</span></span>
2. <span data-ttu-id="ccca4-239">Si se produce un error en exchange, Azure AD devolverá una excepción de concesión no válida.</span><span class="sxs-lookup"><span data-stu-id="ccca4-239">If the exchange fails, Azure AD will return an invalid grant exception.</span></span> <span data-ttu-id="ccca4-240">Normalmente, hay uno de los dos mensajes de error: `invalid_grant` o `interaction_required`</span><span class="sxs-lookup"><span data-stu-id="ccca4-240">There are usually one of two error messages: `invalid_grant` or `interaction_required`</span></span>
3. <span data-ttu-id="ccca4-241">Cuando se produce un error en el intercambio, debe solicitar su consentimiento adicional.</span><span class="sxs-lookup"><span data-stu-id="ccca4-241">When the exchange fails, then you need to ask for additional consent.</span></span> <span data-ttu-id="ccca4-242">Te recomendamos que muestres alguna interfaz de usuario que pida al usuario que conceda consentimiento adicional.</span><span class="sxs-lookup"><span data-stu-id="ccca4-242">We recommend showing some UI asking the user to grant additional consent.</span></span> <span data-ttu-id="ccca4-243">Esta interfaz de usuario debe incluir un botón que desencadene un cuadro de diálogo de consentimiento de Azure AD con nuestra [API de autenticación de Azure AD.](~/concepts/authentication/auth-silent-aad.md)</span><span class="sxs-lookup"><span data-stu-id="ccca4-243">This UI should include a button that triggers an Azure AD consent dialog using our [Azure AD authentication API](~/concepts/authentication/auth-silent-aad.md).</span></span>
4. <span data-ttu-id="ccca4-244">Al solicitar el consentimiento adicional de Azure AD, debes incluir en el parámetro de cadena de consulta en Azure AD; de lo contrario, Azure AD no pedirá los `prompt=consent` ámbitos adicionales. [](~/tabs/how-to/authentication/auth-silent-aad.md#get-the-user-context)</span><span class="sxs-lookup"><span data-stu-id="ccca4-244">When asking for additional consent from Azure AD, you need to include `prompt=consent` in your [query-string-parameter](~/tabs/how-to/authentication/auth-silent-aad.md#get-the-user-context) to Azure AD otherwise Azure AD will not ask for the additional scopes.</span></span>
    * <span data-ttu-id="ccca4-245">En lugar de: `?scope={scopes}`</span><span class="sxs-lookup"><span data-stu-id="ccca4-245">Instead of: `?scope={scopes}`</span></span>
    * <span data-ttu-id="ccca4-246">Use esta opción: `?prompt=consent&scope={scopes}`</span><span class="sxs-lookup"><span data-stu-id="ccca4-246">Use this: `?prompt=consent&scope={scopes}`</span></span>
    * <span data-ttu-id="ccca4-247">Asegúrese de que incluye todos los ámbitos que solicita al usuario `{scopes}` (por ejemplo: Mail.Read o User.Read).</span><span class="sxs-lookup"><span data-stu-id="ccca4-247">Be sure that `{scopes}` includes all the scopes you are prompting the user for (ex: Mail.Read or User.Read).</span></span>
5. <span data-ttu-id="ccca4-248">Una vez que el usuario haya concedido permiso adicional, vuelva a intentar el flujo en nombre de para obtener acceso a estas API adicionales.</span><span class="sxs-lookup"><span data-stu-id="ccca4-248">Once the user has granted additional permission, retry the on-behalf-of-flow to get access to these additional APIs.</span></span>

### <a name="non-azure-ad-authentication"></a><span data-ttu-id="ccca4-249">Autenticación que no es de Azure AD</span><span class="sxs-lookup"><span data-stu-id="ccca4-249">Non-Azure AD Authentication</span></span>

<span data-ttu-id="ccca4-250">La solución de autenticación descrita anteriormente solo funciona para aplicaciones y servicios que admiten Azure AD como proveedor de identidades.</span><span class="sxs-lookup"><span data-stu-id="ccca4-250">The above-described authentication solution only works for apps and services that support Azure AD as an identity provider.</span></span> <span data-ttu-id="ccca4-251">Las aplicaciones que quieran autenticarse con servicios no basados en Azure AD deben seguir usando el flujo de autenticación [web basado en elementos emergentes.](~/concepts/authentication.md)</span><span class="sxs-lookup"><span data-stu-id="ccca4-251">Apps that want to authenticate using non-Azure AD based services need to continue using the pop-up-based [web authentication flow](~/concepts/authentication.md).</span></span>
