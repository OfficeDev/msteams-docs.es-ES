---
title: Flujo de autenticación para pestañas
description: Describe el flujo de autenticación en pestañas
ms.topic: conceptual
keywords: pestañas de flujo de autenticación de teams
ms.openlocfilehash: ccc507c08007c72e5393d9175d69ea3672d73609
ms.sourcegitcommit: dd2220f691029d043aaddfc7c229e332735acb1d
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 04/24/2021
ms.locfileid: "51995851"
---
# <a name="microsoft-teams-authentication-flow-for-tabs"></a><span data-ttu-id="b5100-104">Flujo de autenticación de Microsoft Teams para pestañas</span><span class="sxs-lookup"><span data-stu-id="b5100-104">Microsoft Teams authentication flow for tabs</span></span>

> [!NOTE]
> <span data-ttu-id="b5100-105">Para que la autenticación funcione para su pestaña en clientes móviles, debe asegurarse de que está usando al menos la versión 1.4.1 del SDK de JavaScript de Microsoft Teams.</span><span class="sxs-lookup"><span data-stu-id="b5100-105">For authentication to work for your tab on mobile clients, you must ensure you are using at least 1.4.1 version of the Microsoft Teams JavaScript SDK.</span></span>
> <span data-ttu-id="b5100-106">Sdk de Teams inicia una ventana independiente para el flujo de autenticación.</span><span class="sxs-lookup"><span data-stu-id="b5100-106">Teams SDK launches separate window for authentication flow.</span></span> <span data-ttu-id="b5100-107">Establezca el `SameSite` atributo en **Lax**.</span><span class="sxs-lookup"><span data-stu-id="b5100-107">Set the `SameSite` attribute to **Lax**.</span></span> <span data-ttu-id="b5100-108">El cliente de escritorio de Teams o versiones anteriores de Chrome o Safari no `SameSite` admiten =Ninguno.</span><span class="sxs-lookup"><span data-stu-id="b5100-108">Teams desktop client or older versions of Chrome or Safari do not support `SameSite`=None.</span></span>

<span data-ttu-id="b5100-109">OAuth 2.0 es un estándar abierto para la autenticación y autorización que usan Azure Active Directory (AAD) y muchos otros proveedores de identidades.</span><span class="sxs-lookup"><span data-stu-id="b5100-109">OAuth 2.0 is an open standard for authentication and authorization used by Azure Active Directory (AAD) and many other identity providers.</span></span> <span data-ttu-id="b5100-110">Una comprensión básica de OAuth 2.0 es un requisito previo para trabajar con la autenticación en Teams.</span><span class="sxs-lookup"><span data-stu-id="b5100-110">A basic understanding of OAuth 2.0 is a prerequisite for working with authentication in Teams.</span></span> <span data-ttu-id="b5100-111">Para obtener más información, vea [OAuth 2 simplified](https://aaronparecki.com/oauth-2-simplified/) that is easier to follow than the [formal specification](https://oauth.net/2/).</span><span class="sxs-lookup"><span data-stu-id="b5100-111">For more information, see [OAuth 2 simplified](https://aaronparecki.com/oauth-2-simplified/) that is easier to follow than the [formal specification](https://oauth.net/2/).</span></span> <span data-ttu-id="b5100-112">El flujo de autenticación para pestañas y bots es diferente porque las pestañas son similares a los sitios web para que puedan usar OAuth 2.0 directamente.</span><span class="sxs-lookup"><span data-stu-id="b5100-112">Authentication flow for tabs and bots are different because tabs are similar to websites so they can use OAuth 2.0 directly.</span></span> <span data-ttu-id="b5100-113">Los bots hacen algunas cosas de forma diferente, pero los conceptos básicos son idénticos.</span><span class="sxs-lookup"><span data-stu-id="b5100-113">Bots do a few things differently, but the core concepts are identical.</span></span>

<span data-ttu-id="b5100-114">Para obtener un ejemplo de flujo de autenticación para pestañas y bots que usan Node y el tipo de concesión implícita [OAuth 2.0](https://oauth.net/2/grant-types/implicit/), vea Iniciar flujo de autenticación [para pestañas](~/tabs/how-to/authentication/auth-tab-aad.md#initiate-authentication-flow).</span><span class="sxs-lookup"><span data-stu-id="b5100-114">For an example of authentication flow for tabs and bots using Node and the [OAuth 2.0 implicit grant type](https://oauth.net/2/grant-types/implicit/), see [initiate authentication flow for tabs](~/tabs/how-to/authentication/auth-tab-aad.md#initiate-authentication-flow).</span></span>

> [!NOTE]
> <span data-ttu-id="b5100-115">Antes de mostrar **un botón Inicio** de sesión al usuario y llamar a la API en respuesta a la selección del botón, debe esperar a que se complete la `microsoftTeams.authentication.authenticate` inicialización del SDK.</span><span class="sxs-lookup"><span data-stu-id="b5100-115">Before showing a **Login** button to the user and calling the `microsoftTeams.authentication.authenticate` API in response to selecting the button, you must wait for the SDK initialization to complete.</span></span> <span data-ttu-id="b5100-116">Puede pasar una devolución de llamada a la API a `microsoftTeams.initialize` la que se llama cuando se complete la inicialización.</span><span class="sxs-lookup"><span data-stu-id="b5100-116">You can pass a callback to the `microsoftTeams.initialize` API that is called when initialization completes.</span></span>

![Diagrama de secuencia de autenticación de tabulación](~/assets/images/authentication/tab_auth_sequence_diagram.png)

1. <span data-ttu-id="b5100-118">El usuario interactúa con el contenido de la página de contenido o configuración de pestañas, normalmente un botón **Iniciar** **sesión o Iniciar** sesión.</span><span class="sxs-lookup"><span data-stu-id="b5100-118">The user interacts with the content on the tab configuration or content page, commonly a **Sign in** or **Log in** button.</span></span>
2. <span data-ttu-id="b5100-119">La pestaña construye la dirección URL de su página de inicio de autenticación.</span><span class="sxs-lookup"><span data-stu-id="b5100-119">The tab constructs the URL for its auth start page.</span></span> <span data-ttu-id="b5100-120">Opcionalmente, usa información de marcadores de posición de dirección URL o llama al método SDK de cliente de Teams para `microsoftTeams.getContext()` simplificar la experiencia de autenticación del usuario.</span><span class="sxs-lookup"><span data-stu-id="b5100-120">Optionally, it uses information from URL placeholders or calls `microsoftTeams.getContext()` Teams client SDK method to streamline the authentication experience for the user.</span></span> <span data-ttu-id="b5100-121">Por ejemplo, al autenticar con AAD, si el parámetro está establecido en la dirección de correo electrónico del usuario, el usuario no tiene que iniciar sesión si lo ha hecho `login_hint` recientemente.</span><span class="sxs-lookup"><span data-stu-id="b5100-121">For example, when authenticating with AAD, if the `login_hint` parameter is set to the user's email address, the user does not have to sign in if they have done so recently.</span></span> <span data-ttu-id="b5100-122">Esto se debe a que AAD usa las credenciales almacenadas en caché del usuario.</span><span class="sxs-lookup"><span data-stu-id="b5100-122">This is because AAD uses the user's cached credentials.</span></span> <span data-ttu-id="b5100-123">La ventana emergente se muestra brevemente y, a continuación, desaparece.</span><span class="sxs-lookup"><span data-stu-id="b5100-123">The pop-up window is shown briefly and then disappears.</span></span>
3. <span data-ttu-id="b5100-124">A continuación, la pestaña llama al método `microsoftTeams.authentication.authenticate()` y registra las funciones `successCallback` y `failureCallback`.</span><span class="sxs-lookup"><span data-stu-id="b5100-124">The tab then calls the `microsoftTeams.authentication.authenticate()` method and registers the `successCallback` and `failureCallback` functions.</span></span>
4. <span data-ttu-id="b5100-125">Teams abre la página de inicio en un iframe en una ventana emergente.</span><span class="sxs-lookup"><span data-stu-id="b5100-125">Teams opens the start page in an iframe in a pop-up window.</span></span> <span data-ttu-id="b5100-126">La página de inicio genera datos aleatorios, los guarda para la validación futura y redirige al extremo del proveedor de `state` `/authorize` identidades, como Azure `https://login.microsoftonline.com/<tenant ID>/oauth2/authorize` AD.</span><span class="sxs-lookup"><span data-stu-id="b5100-126">The start page generates random `state` data, saves it for future validation, and redirects to the identity provider's `/authorize` endpoint, such as `https://login.microsoftonline.com/<tenant ID>/oauth2/authorize` for Azure AD.</span></span> <span data-ttu-id="b5100-127">Reemplace `<tenant id>` por su propio identificador de inquilino que sea context.tid.</span><span class="sxs-lookup"><span data-stu-id="b5100-127">Replace `<tenant id>` with your own tenant id that is context.tid.</span></span>
<span data-ttu-id="b5100-128">De forma similar a otros flujos de autenticación de aplicaciones en Teams, la página de inicio debe estar en un dominio que esté en su lista y en el mismo dominio que la página de redireccionamiento de inicio `validDomains` de sesión.</span><span class="sxs-lookup"><span data-stu-id="b5100-128">Similar to other application auth flows in Teams, the start page must be on a domain that is in its `validDomains` list, and on the same domain as the post sign in redirect page.</span></span>

    > [!NOTE]
    > <span data-ttu-id="b5100-129">El flujo de concesión implícito de OAuth 2.0 llama a un parámetro de la solicitud de autenticación, que contiene datos de sesión únicos para evitar un ataque de falsificación de solicitudes `state` [entre sitios.](https://en.wikipedia.org/wiki/Cross-site_request_forgery)</span><span class="sxs-lookup"><span data-stu-id="b5100-129">The OAuth 2.0 implicit grant flow calls for a `state` parameter in the authentication request, which contains unique session data to prevent a [cross-site request forgery attack](https://en.wikipedia.org/wiki/Cross-site_request_forgery).</span></span> <span data-ttu-id="b5100-130">Los ejemplos usan un GUID generado aleatoriamente para los `state` datos.</span><span class="sxs-lookup"><span data-stu-id="b5100-130">The examples use a randomly-generated GUID for the `state` data.</span></span>

5. <span data-ttu-id="b5100-131">En el sitio del proveedor, el usuario inicia sesión y concede acceso a la pestaña.</span><span class="sxs-lookup"><span data-stu-id="b5100-131">On the provider's site, the user signs in and grants access to the tab.</span></span>
6. <span data-ttu-id="b5100-132">El proveedor lleva al usuario a la página de redireccionamiento de OAuth 2.0 de la pestaña con un token de acceso.</span><span class="sxs-lookup"><span data-stu-id="b5100-132">The provider takes the user to the tab's OAuth 2.0 redirect page with an access token.</span></span>
7. <span data-ttu-id="b5100-133">La pestaña comprueba que el valor devuelto coincide con lo que se guardó anteriormente y llama a , que a su vez llama a `state` la función registrada en el paso `microsoftTeams.authentication.notifySuccess()` `successCallback` 3.</span><span class="sxs-lookup"><span data-stu-id="b5100-133">The tab checks that the returned `state` value matches what was saved earlier, and calls `microsoftTeams.authentication.notifySuccess()`, which in turn calls the `successCallback` function registered in step 3.</span></span>
8. <span data-ttu-id="b5100-134">Teams cierra la ventana emergente.</span><span class="sxs-lookup"><span data-stu-id="b5100-134">Teams closes the pop-up window.</span></span>
9. <span data-ttu-id="b5100-135">La pestaña muestra la interfaz de usuario de configuración, actualiza o vuelve a cargar el contenido de las pestañas, en función del lugar desde el que se inició el usuario.</span><span class="sxs-lookup"><span data-stu-id="b5100-135">The tab either displays configuration UI, refreshes, or reloads the tabs content, depending on where the user started from.</span></span>

## <a name="treat-tab-context-as-hints"></a><span data-ttu-id="b5100-136">Tratar el contexto de tabulación como sugerencias</span><span class="sxs-lookup"><span data-stu-id="b5100-136">Treat tab context as hints</span></span>

<span data-ttu-id="b5100-137">Aunque el contexto de pestaña proporciona información útil sobre el usuario, no use esta información para autenticar al usuario.</span><span class="sxs-lookup"><span data-stu-id="b5100-137">Although the tab context provides helpful information regarding the user, do not use this information to authenticate the user.</span></span> <span data-ttu-id="b5100-138">Autentique al usuario incluso si obtiene la información como parámetros de dirección URL en la dirección URL de contenido de la pestaña o llamando a la función en el SDK de `microsoftTeams.getContext()` cliente de Microsoft Teams.</span><span class="sxs-lookup"><span data-stu-id="b5100-138">Do authenticate the user even if you get the information as URL parameters to your tab content URL or by calling the `microsoftTeams.getContext()` function in the Microsoft Teams client SDK.</span></span> <span data-ttu-id="b5100-139">Un actor malintencionado puede invocar la dirección URL de contenido de la pestaña con sus propios parámetros.</span><span class="sxs-lookup"><span data-stu-id="b5100-139">A malicious actor can invoke your tab content URL with its own parameters.</span></span> <span data-ttu-id="b5100-140">El actor también puede invocar una página web que suplanta Microsoft Teams para cargar la dirección URL de contenido de la pestaña en un iframe y devolver sus propios datos a la `getContext()` función.</span><span class="sxs-lookup"><span data-stu-id="b5100-140">The actor can also invoke a web page impersonating Microsoft Teams to load your tab content URL in an iframe and return its own data to the `getContext()` function.</span></span> <span data-ttu-id="b5100-141">Debe tratar la información relacionada con la identidad en el contexto de la pestaña simplemente como sugerencias y validarlas antes de su uso.</span><span class="sxs-lookup"><span data-stu-id="b5100-141">You must treat the identity-related information in the tab context simply as hints and validate them before use.</span></span> <span data-ttu-id="b5100-142">Consulte las notas de [navegar a la página de autorización desde la página emergente](~/tabs/how-to/authentication/auth-tab-aad.md#navigate-to-the-authorization-page-from-your-popup-page).</span><span class="sxs-lookup"><span data-stu-id="b5100-142">Refer to the notes in [navigate to the authorization page from your pop-up page](~/tabs/how-to/authentication/auth-tab-aad.md#navigate-to-the-authorization-page-from-your-popup-page).</span></span>

## <a name="code-sample"></a><span data-ttu-id="b5100-143">Ejemplo de código</span><span class="sxs-lookup"><span data-stu-id="b5100-143">Code sample</span></span>

<span data-ttu-id="b5100-144">Código de ejemplo que muestra el proceso de autenticación de tabulación.</span><span class="sxs-lookup"><span data-stu-id="b5100-144">Sample code showing the tab authentication process.</span></span>

| <span data-ttu-id="b5100-145">**Nombre de ejemplo**</span><span class="sxs-lookup"><span data-stu-id="b5100-145">**Sample name**</span></span> | <span data-ttu-id="b5100-146">**Descripción**</span><span class="sxs-lookup"><span data-stu-id="b5100-146">**Description**</span></span> | <span data-ttu-id="b5100-147">**C#**</span><span class="sxs-lookup"><span data-stu-id="b5100-147">**C#**</span></span> | <span data-ttu-id="b5100-148">**Node.js**</span><span class="sxs-lookup"><span data-stu-id="b5100-148">**Node.js**</span></span> |
|-----------------|-----------------|-------------|------------|
| <span data-ttu-id="b5100-149">Autenticación de pestañas de Teams</span><span class="sxs-lookup"><span data-stu-id="b5100-149">Teams tab authentication</span></span> | <span data-ttu-id="b5100-150">Proceso de autenticación para pestañas con AAD.</span><span class="sxs-lookup"><span data-stu-id="b5100-150">Authentication process for tabs using AAD.</span></span> | [<span data-ttu-id="b5100-151">View</span><span class="sxs-lookup"><span data-stu-id="b5100-151">View</span></span>](https://github.com/OfficeDev/Microsoft-Teams-Samples/tree/main/samples/app-complete-sample/csharp) | [<span data-ttu-id="b5100-152">View</span><span class="sxs-lookup"><span data-stu-id="b5100-152">View</span></span>](https://github.com/OfficeDev/Microsoft-Teams-Samples/tree/main/samples/app-complete-sample/nodejs) |

## <a name="more-details"></a><span data-ttu-id="b5100-153">Más detalles</span><span class="sxs-lookup"><span data-stu-id="b5100-153">More details</span></span>

<span data-ttu-id="b5100-154">Para obtener una implementación detallada para la autenticación de pestañas mediante AAD, vea:</span><span class="sxs-lookup"><span data-stu-id="b5100-154">For a detailed implementation for tab authentication using AAD, see:</span></span>

* [<span data-ttu-id="b5100-155">Autenticar a un usuario en una pestaña de Teams</span><span class="sxs-lookup"><span data-stu-id="b5100-155">Authenticate a user in a Teams tab</span></span>](~/tabs/how-to/authentication/auth-tab-AAD.md)
* [<span data-ttu-id="b5100-156">Autenticación silenciosa</span><span class="sxs-lookup"><span data-stu-id="b5100-156">Silent authentication</span></span>](~/tabs/how-to/authentication/auth-silent-AAD.md)
